(function(define){var __define;"function"==typeof define&&define.amd&&(__define=define,define=null);
function t(t,e,r,n){Object.defineProperty(t,e,{get:r,set:n,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire1d24;r.register("2fsc0",(function(e,n){var i;i=e.exports,Object.defineProperty(i,"__esModule",{value:!0,configurable:!0}),t(e.exports,"default",(function(){return g}),(function(t){return g=t}));var s=r("lQdFb"),o=r("b7RTT"),u=r("4EYNL"),a=r("7c6Jb"),h=r("hYnBn"),p=r("amBTu"),c=r("hpTqp"),l=r("6cQM5"),f=r("7tTKx"),d=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(t){s(t)}}function u(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};class g{getWalletXpub(t){return this.changeImplIfNecessary().then((e=>e.getWalletXpub(t)))}getWalletPublicKey(t,e){let r;return arguments.length>2||"boolean"==typeof e?(console.warn("btc.getWalletPublicKey deprecated signature used. Please switch to getWalletPublicKey(path, { format, verify })"),r={verify:!!e,format:arguments[2]?"p2sh":"legacy"}):r=e||{},this.changeImplIfNecessary().then((e=>e.getWalletPublicKey(t,r)))}signMessage(t,e){return this.changeImplIfNecessary().then((r=>r.signMessage({path:t,messageHex:e})))}createPaymentTransaction(t){if(arguments.length>1)throw new Error("@ledgerhq/hw-app-btc: createPaymentTransaction multi argument signature is deprecated. please switch to named parameters.");return this.changeImplIfNecessary().then((e=>e.createPaymentTransaction(t)))}signP2SHTransaction(t){return(0,l.signP2SHTransaction)(this._transport,t)}splitTransaction(t,e=!1,r=!1,n=!1,i=[]){return(0,c.splitTransaction)(t,e,r,n,i)}serializeTransactionOutputs(t){return(0,p.serializeTransactionOutputs)(t)}getTrustedInput(t,e,r=[]){return(0,u.getTrustedInput)(this._transport,t,e,r)}getTrustedInputBIP143(t,e,r=[]){return(0,a.getTrustedInputBIP143)(this._transport,t,e,r)}changeImplIfNecessary(){return d(this,void 0,void 0,(function*(){if(this._impl instanceof o.default)return this._impl;const t=yield(0,f.getAppAndVersion)(this._transport);let e=!0;if("Bitcoin"===t.name||"Bitcoin Test"===t.name){const[r,n]=t.version.split(".");e=parseInt(r)<=1||2==parseInt(r)&&0==parseInt(n)}else"Bitcoin Legacy"===t.name||"Bitcoin Test Legacy"===t.name?e=!0:"Exchange"===t.name&&(e=yield(0,f.checkIsBtcLegacy)(this._transport));return e&&(this._impl=new(0,o.default)(this._transport)),this._impl}))}constructor({transport:t,scrambleKey:e="BTC",currency:r="bitcoin"}){this._transport=t,this._transport.decorateAppAPIMethods(this,["getWalletXpub","getWalletPublicKey","signP2SHTransaction","signMessage","createPaymentTransaction","getTrustedInput","getTrustedInputBIP143"],e),this._impl="bitcoin"===r||"bitcoin_testnet"===r?new(0,s.default)(new(0,h.AppClient)(this._transport)):new(0,o.default)(this._transport)}}})),r.register("lQdFb",(function(e,n){t(e.exports,"default",(function(){return m}),(function(t){return m=t}));var i=r("7yhlT"),s=r("noLW6"),o=r("1UYdo"),u=r("gpQhj"),a=r("4dqwp"),h=r("igter"),p=r("fmsg1"),c=r("5qLu8"),l=r("ev3OL"),f=r("amBTu"),d=r("6rT8n").Buffer,g=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(t){s(t)}}function u(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};class m{getWalletXpub({path:t,xpubVersion:e}){return g(this,void 0,void 0,(function*(){const r=(0,o.pathStringToArray)(t),n=yield this.client.getExtendedPubkey(!1,r),i=(0,o.getXpubComponents)(n);if(i.version!=e)throw new Error(`Expected xpub version ${e} doesn't match the xpub version from the device ${i.version}`);return n}))}getWalletPublicKey(t,e){var r,n;return g(this,void 0,void 0,(function*(){if(!function(t){const e=2147483648,r=(0,o.pathStringToArray)(t),n=t=>t>=e,i=t=>void 0===t||t<e,s=t=>void 0===t||0===t||1===t;return!!(r.length>=3&&r.length<=5&&[44+e,49+e,84+e,86+e].some((t=>t==r[0]))&&[0+e,1+e].some((t=>t==r[1]))&&n(r[2])&&s(r[3])&&i(r[4]))||!!(r.length>=4&&r.length<=6&&48+e==r[0]&&[0+e,1+e].some((t=>t==r[1]))&&n(r[2])&&n(r[3])&&s(r[4])&&i(r[5]))}(t))throw Error(`non-standard path: ${t}`);const i=(0,o.pathStringToArray)(t),u=yield this.client.getExtendedPubkey(!1,i),a=null!==(r=null==e?void 0:e.verify)&&void 0!==r&&r,h=yield this.getWalletAddress(i,function(t){if("legacy"==t)return"pkh(@0)";if("p2sh"==t)return"sh(wpkh(@0))";if("bech32"==t)return"wpkh(@0)";if("bech32m"==t)return"tr(@0)";throw new Error("Unsupported address format "+t)}(null!==(n=null==e?void 0:e.format)&&void 0!==n?n:"legacy"),a),p=(0,o.getXpubComponents)(u);return{publicKey:d.from((0,s.pointCompress)(p.pubkey,!1)).toString("hex"),bitcoinAddress:h,chainCode:p.chaincode.toString("hex")}}))}getWalletAddress(t,e,r){return g(this,void 0,void 0,(function*(){const n=(0,o.hardenedPathOf)(t);if(n.length+2!=t.length)return"";const i=yield this.client.getExtendedPubkey(!1,n),s=yield this.client.getMasterFingerprint(),u=new(0,h.WalletPolicy)(e,(0,h.createKey)(s,n,i)),a=t.slice(-2,t.length);return this.client.getWalletAddress(u,d.alloc(32,0),a[0],a[1],r)}))}createPaymentTransaction(t){return g(this,void 0,void 0,(function*(){const e=t.inputs.length;if(0==e)throw Error("No inputs");const r=new(0,l.PsbtV2),n=yield this.client.getMasterFingerprint(),i=function(t,e,r){return t.additionals.includes("bech32m")?new(0,a.p2tr)(e,r):t.additionals.includes("bech32")?new(0,a.p2wpkh)(e,r):t.segwit?new(0,a.p2wpkhWrapped)(e,r):new(0,a.p2pkh)(e,r)}(t,r,n);null!=t.lockTime&&r.setGlobalFallbackLocktime(t.lockTime),r.setGlobalInputCount(e),r.setGlobalPsbtVersion(2),r.setGlobalTxVersion(2);let s=0;const f=()=>{t.onDeviceStreaming&&t.onDeviceStreaming({total:2*e,index:s,progress:++s/(2*e)})};let g="",m=[];for(let s=0;s<e;s++){f();const e=(0,o.pathStringToArray)(t.associatedKeysets[s]);""==g&&(m=e.slice(0,-2),g=yield this.client.getExtendedPubkey(!1,m)),yield this.setInput(r,s,t.inputs[s],e,i,n,t.sigHashType)}const w=d.from(t.outputScriptHex,"hex"),y=new(0,u.BufferReader)(w),v=y.readVarInt();r.setGlobalOutputCount(v);const _=yield this.outputScriptAt(m,i,t.changePath);let E=!_;for(let e=0;e<v;e++){const n=Number(y.readUInt64()),s=y.readVarSlice();r.setOutputAmount(e,n),r.setOutputScript(e,s);if(_&&s.equals(null==_?void 0:_.cond.scriptPubKey)){E=!0;const r=(0,o.pathStringToArray)(t.changePath),n=_.pubkey;i.setOwnOutput(e,_.cond,[n],[r])}}if(!E)throw new Error("Change script not found among outputs! "+(null==_?void 0:_.cond.scriptPubKey.toString("hex")));const S=(0,h.createKey)(n,m,g),b=new(0,h.WalletPolicy)(i.getDescriptorTemplate(),S);t.onDeviceSignatureRequested&&t.onDeviceSignatureRequested();let I=!1;yield this.signPsbt(r,b,(()=>{I||(I=!0,t.onDeviceSignatureGranted&&t.onDeviceSignatureGranted()),f()})),(0,c.finalize)(r);return(0,p.extract)(r).toString("hex")}))}signMessage({path:t,messageHex:e}){return g(this,void 0,void 0,(function*(){const r=(0,o.pathStringToArray)(t),n=d.from(e,"hex"),i=yield this.client.signMessage(n,r),s=d.from(i,"base64");return{v:s.readUInt8()-27-4,r:s.slice(1,33).toString("hex"),s:s.slice(33,65).toString("hex")}}))}outputScriptAt(t,e,r){return g(this,void 0,void 0,(function*(){if(!r)return;const n=(0,o.pathStringToArray)(r);for(let e=0;e<t.length;e++)if(t[e]!=n[e])throw new Error(`Path ${r} not in account ${(0,o.pathArrayToString)(t)}`);const i=yield this.client.getExtendedPubkey(!1,n),s=(0,o.pubkeyFromXpub)(i);return{cond:e.spendingCondition([s]),pubkey:s}}))}setInput(t,e,r,n,s,u,a){return g(this,void 0,void 0,(function*(){const u=r[0],h=r[1],p=r[2]?d.from(r[2],"hex"):void 0,c=r[3];null!=c&&t.setInputSequence(e,c),null!=a&&t.setInputSighashType(e,a);const l=(0,f.serializeTransaction)(u,!0),g=i.crypto.hash256(l),m=yield this.client.getExtendedPubkey(!1,n),w=(0,o.pubkeyFromXpub)(m);if(!u.outputs)throw Error("Missing outputs array in transaction to sign");const y=u.outputs[h],v={cond:{scriptPubKey:y.script,redeemScript:p},amount:y.amount};s.setInput(e,l,v,[w],[n]),t.setInputPreviousTxId(e,g),t.setInputOutputIndex(e,h)}))}signPsbt(t,e,r){return g(this,void 0,void 0,(function*(){(yield this.client.signPsbt(t,e,d.alloc(32,0),r)).forEach(((e,r)=>{const n=t.getInputKeyDatas(r,l.psbtIn.BIP32_DERIVATION);let i;if(1!=n.length){if(i=t.getInputKeyDatas(r,l.psbtIn.TAP_BIP32_DERIVATION),0==i.length)throw Error(`Missing pubkey derivation for input ${r}`);t.setInputTapKeySig(r,e)}else i=n[0],t.setInputPartialSig(r,i,e)}))}))}constructor(t){this.client=t}}})),r.register("7yhlT",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("lQedB");t.exports.bip32=n;var i=r("hJRqN");t.exports.address=i;var s=r("adkaU");t.exports.crypto=s;var o=r("7W5Bi");t.exports.ECPair=o;var u=r("bwA6R");t.exports.networks=u;var a=r("4OftM");t.exports.payments=a;var h=r("gUdqP");t.exports.script=h;var p=r("dTm3q");t.exports.Block=p.Block;var c=r("6JjQf");t.exports.Psbt=c.Psbt;h=r("gUdqP");t.exports.opcodes=h.OPS;var l=r("4PM20");t.exports.Transaction=l.Transaction;var f=r("cAhvt");t.exports.TransactionBuilder=f.TransactionBuilder})),r.register("lQedB",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("6Tlr2");t.exports.fromSeed=n.fromSeed,t.exports.fromBase58=n.fromBase58,t.exports.fromPublicKey=n.fromPublicKey,t.exports.fromPrivateKey=n.fromPrivateKey})),r.register("6Tlr2",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("aBHgu"),s=r("f8pp6"),o=r("noLW6"),u=r("8DFnu"),a=r("2kT0C");const h=u.BufferN(32),p=u.compile({wif:u.UInt8,bip32:{public:u.UInt32,private:u.UInt32}}),c={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},l=2147483648,f=Math.pow(2,31)-1;function d(t){return u.String(t)&&null!==t.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}function g(t){return u.UInt32(t)&&t<=f}class m{get depth(){return this.__DEPTH}get index(){return this.__INDEX}get parentFingerprint(){return this.__PARENT_FINGERPRINT}get publicKey(){return void 0===this.__Q&&(this.__Q=o.pointFromScalar(this.__D,!0)),this.__Q}get privateKey(){return this.__D}get identifier(){return i.hash160(this.publicKey)}get fingerprint(){return this.identifier.slice(0,4)}get compressed(){return!0}isNeutered(){return void 0===this.__D}neutered(){return v(this.publicKey,this.chainCode,this.network,this.depth,this.index,this.parentFingerprint)}toBase58(){const t=this.network,e=this.isNeutered()?t.bip32.public:t.bip32.private,r=n.allocUnsafe(78);return r.writeUInt32BE(e,0),r.writeUInt8(this.depth,4),r.writeUInt32BE(this.parentFingerprint,5),r.writeUInt32BE(this.index,9),this.chainCode.copy(r,13),this.isNeutered()?this.publicKey.copy(r,45):(r.writeUInt8(0,45),this.privateKey.copy(r,46)),s.encode(r)}toWIF(){if(!this.privateKey)throw new TypeError("Missing private key");return a.encode(this.network.wif,this.privateKey,!0)}derive(t){u(u.UInt32,t);const e=t>=l,r=n.allocUnsafe(37);if(e){if(this.isNeutered())throw new TypeError("Missing private key for hardened child key");r[0]=0,this.privateKey.copy(r,1),r.writeUInt32BE(t,33)}else this.publicKey.copy(r,0),r.writeUInt32BE(t,33);const s=i.hmacSHA512(this.chainCode,r),a=s.slice(0,32),h=s.slice(32);if(!o.isPrivate(a))return this.derive(t+1);let p;if(this.isNeutered()){const e=o.pointAddScalar(this.publicKey,a,!0);if(null===e)return this.derive(t+1);p=v(e,h,this.network,this.depth+1,t,this.fingerprint.readUInt32BE(0))}else{const e=o.privateAdd(this.privateKey,a);if(null==e)return this.derive(t+1);p=y(e,h,this.network,this.depth+1,t,this.fingerprint.readUInt32BE(0))}return p}deriveHardened(t){return u(g,t),this.derive(t+l)}derivePath(t){u(d,t);let e=t.split("/");if("m"===e[0]){if(this.parentFingerprint)throw new TypeError("Expected master, got child");e=e.slice(1)}return e.reduce(((t,e)=>{let r;return"'"===e.slice(-1)?(r=parseInt(e.slice(0,-1),10),t.deriveHardened(r)):(r=parseInt(e,10),t.derive(r))}),this)}sign(t,e){if(!this.privateKey)throw new Error("Missing private key");if(void 0===e&&(e=this.lowR),!1===e)return o.sign(t,this.privateKey);{let e=o.sign(t,this.privateKey);const r=n.alloc(32,0);let i=0;for(;e[0]>127;)i++,r.writeUIntLE(i,0,6),e=o.signWithEntropy(t,this.privateKey,r);return e}}verify(t,e){return o.verify(t,this.publicKey,e)}constructor(t,e,r,n,i=0,s=0,o=0){this.__D=t,this.__Q=e,this.chainCode=r,this.network=n,this.__DEPTH=i,this.__INDEX=s,this.__PARENT_FINGERPRINT=o,u(p,n),this.lowR=!1}}function w(t,e,r){return y(t,e,r)}function y(t,e,r,n,i,s){if(u({privateKey:h,chainCode:h},{privateKey:t,chainCode:e}),r=r||c,!o.isPrivate(t))throw new TypeError("Private key not in range [1, n)");return new m(t,void 0,e,r,n,i,s)}function v(t,e,r,n,i,s){if(u({publicKey:u.BufferN(33),chainCode:h},{publicKey:t,chainCode:e}),r=r||c,!o.isPoint(t))throw new TypeError("Point is not on the curve");return new m(void 0,t,e,r,n,i,s)}t.exports.fromBase58=function(t,e){const r=s.decode(t);if(78!==r.length)throw new TypeError("Invalid buffer length");e=e||c;const n=r.readUInt32BE(0);if(n!==e.bip32.private&&n!==e.bip32.public)throw new TypeError("Invalid network version");const i=r[4],o=r.readUInt32BE(5);if(0===i&&0!==o)throw new TypeError("Invalid parent fingerprint");const u=r.readUInt32BE(9);if(0===i&&0!==u)throw new TypeError("Invalid index");const a=r.slice(13,45);let h;if(n===e.bip32.private){if(0!==r.readUInt8(45))throw new TypeError("Invalid private key");h=y(r.slice(46,78),a,e,i,u,o)}else{h=v(r.slice(45,78),a,e,i,u,o)}return h},t.exports.fromPrivateKey=w,t.exports.fromPublicKey=function(t,e,r){return v(t,e,r)},t.exports.fromSeed=function(t,e){if(u(u.Buffer,t),t.length<16)throw new TypeError("Seed should be at least 128 bits");if(t.length>64)throw new TypeError("Seed should be at most 512 bits");e=e||c;const r=i.hmacSHA512(n.from("Bitcoin seed","utf8"),t);return w(r.slice(0,32),r.slice(32),e)}})),r.register("aBHgu",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("9VkSs"),i=r("3kMyY");t.exports.hash160=function(t){const e=n("sha256").update(t).digest();try{return n("rmd160").update(e).digest()}catch(t){return n("ripemd160").update(e).digest()}},t.exports.hmacSHA512=function(t,e){return i("sha512",t).update(e).digest()}})),r.register("3kMyY",(function(t,e){var n=r("62H0u"),i=r("4TMGh"),s=r("cVCHB"),o=r("8Msk5").Buffer,u=r("en6fB"),a=r("6Zmxr"),h=r("b63zp"),p=o.alloc(128);function c(t,e){s.call(this,"digest"),"string"==typeof e&&(e=o.from(e));var r="sha512"===t||"sha384"===t?128:64;(this._alg=t,this._key=e,e.length>r)?e=("rmd160"===t?new a:h(t)).update(e).digest():e.length<r&&(e=o.concat([e,p],r));for(var n=this._ipad=o.allocUnsafe(r),i=this._opad=o.allocUnsafe(r),u=0;u<r;u++)n[u]=54^e[u],i[u]=92^e[u];this._hash="rmd160"===t?new a:h(t),this._hash.update(n)}n(c,s),c.prototype._update=function(t){this._hash.update(t)},c.prototype._final=function(){var t=this._hash.digest();return("rmd160"===this._alg?new a:h(this._alg)).update(this._opad).update(t).digest()},t.exports=function(t,e){return"rmd160"===(t=t.toLowerCase())||"ripemd160"===t?new c("rmd160",e):"md5"===t?new i(u,e):new c(t,e)}})),r.register("4TMGh",(function(t,e){var n=r("62H0u"),i=r("8Msk5").Buffer,s=r("cVCHB"),o=i.alloc(128),u=64;function a(t,e){s.call(this,"digest"),"string"==typeof e&&(e=i.from(e)),this._alg=t,this._key=e,e.length>u?e=t(e):e.length<u&&(e=i.concat([e,o],u));for(var r=this._ipad=i.allocUnsafe(u),n=this._opad=i.allocUnsafe(u),a=0;a<u;a++)r[a]=54^e[a],n[a]=92^e[a];this._hash=[r]}n(a,s),a.prototype._update=function(t){this._hash.push(t)},a.prototype._final=function(){var t=this._alg(i.concat(this._hash));return this._alg(i.concat([this._opad,t]))},t.exports=a})),r.register("f8pp6",(function(t,e){var n=r("9VkSs"),i=r("gxCQs");t.exports=i((function(t){var e=n("sha256").update(t).digest();return n("sha256").update(e).digest()}))})),r.register("gxCQs",(function(t,e){var n=r("13Nf3"),i=r("8Msk5").Buffer;t.exports=function(t){function e(e){var r=e.slice(0,-4),n=e.slice(-4),i=t(r);if(!(n[0]^i[0]|n[1]^i[1]|n[2]^i[2]|n[3]^i[3]))return r}return{encode:function(e){var r=t(e);return n.encode(i.concat([e,r],e.length+4))},decode:function(t){var r=e(n.decode(t));if(!r)throw new Error("Invalid checksum");return r},decodeUnsafe:function(t){var r=n.decodeUnsafe(t);if(r)return e(r)}}}})),r.register("noLW6",(function(t,e){var n=r("6rT8n").Buffer,i=r("iFR0t");const s=new(0,r("4xJQf").ec)("secp256k1");var o=r("2fRSN");const u=n.alloc(32,0),a=n.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),h=n.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex"),p=s.curve.n,c=p.shrn(1),l=s.curve.g,f="Expected Private",d="Expected Point",g="Expected Tweak",m="Expected Hash",w="Expected Signature",y="Expected Extra Data (32 bytes)";function v(t){return n.isBuffer(t)&&32===t.length}function _(t){return!!v(t)&&t.compare(a)<0}function E(t){if(!n.isBuffer(t))return!1;if(t.length<33)return!1;const e=t[0],r=t.slice(1,33);if(0===r.compare(u))return!1;if(r.compare(h)>=0)return!1;if((2===e||3===e)&&33===t.length){try{O(t)}catch(t){return!1}return!0}const i=t.slice(33);return 0!==i.compare(u)&&(!(i.compare(h)>=0)&&(4===e&&65===t.length))}function S(t){return 4!==t[0]}function b(t){return!!v(t)&&(t.compare(u)>0&&t.compare(a)<0)}function I(t,e){return void 0===t&&void 0!==e?S(e):void 0===t||t}function T(t){return new i(t)}function P(t){return t.toArrayLike(n,"be",32)}function O(t){return s.curve.decodePoint(t)}function M(t,e){return n.from(t._encode(e))}function x(t,e,r){if(!v(t))throw new TypeError(m);if(!b(e))throw new TypeError(f);if(void 0!==r&&!v(r))throw new TypeError(y);const i=T(e),s=T(t);let u,a;o(t,e,(function(t){const e=T(t),r=l.mul(e);return!r.isInfinity()&&(u=r.x.umod(p),0!==u.isZero()&&(a=e.invm(p).mul(s.add(i.mul(u))).umod(p),0!==a.isZero()))}),b,r),a.cmp(c)>0&&(a=p.sub(a));const h=n.allocUnsafe(64);return P(u).copy(h,0),P(a).copy(h,32),h}t.exports={isPoint:E,isPointCompressed:function(t){return!!E(t)&&S(t)},isPrivate:b,pointAdd:function(t,e,r){if(!E(t))throw new TypeError(d);if(!E(e))throw new TypeError(d);const n=O(t),i=O(e),s=n.add(i);return s.isInfinity()?null:M(s,I(r,t))},pointAddScalar:function(t,e,r){if(!E(t))throw new TypeError(d);if(!_(e))throw new TypeError(g);const n=I(r,t),i=O(t);if(0===e.compare(u))return M(i,n);const s=T(e),o=l.mul(s),a=i.add(o);return a.isInfinity()?null:M(a,n)},pointCompress:function(t,e){if(!E(t))throw new TypeError(d);const r=O(t);if(r.isInfinity())throw new TypeError(d);return M(r,I(e,t))},pointFromScalar:function(t,e){if(!b(t))throw new TypeError(f);const r=T(t),n=l.mul(r);return n.isInfinity()?null:M(n,I(e))},pointMultiply:function(t,e,r){if(!E(t))throw new TypeError(d);if(!_(e))throw new TypeError(g);const n=I(r,t),i=O(t),s=T(e),o=i.mul(s);return o.isInfinity()?null:M(o,n)},privateAdd:function(t,e){if(!b(t))throw new TypeError(f);if(!_(e))throw new TypeError(g);const r=T(t),n=T(e),i=P(r.add(n).umod(p));return b(i)?i:null},privateSub:function(t,e){if(!b(t))throw new TypeError(f);if(!_(e))throw new TypeError(g);const r=T(t),n=T(e),i=P(r.sub(n).umod(p));return b(i)?i:null},sign:function(t,e){return x(t,e)},signWithEntropy:function(t,e,r){return x(t,e,r)},verify:function(t,e,r,i){if(!v(t))throw new TypeError(m);if(!E(e))throw new TypeError(d);if(!function(t){const e=t.slice(0,32),r=t.slice(32,64);return n.isBuffer(t)&&64===t.length&&e.compare(a)<0&&r.compare(a)<0}(r))throw new TypeError(w);const s=O(e),o=T(r.slice(0,32)),u=T(r.slice(32,64));if(i&&u.cmp(c)>0)return!1;if(o.gtn(0)<=0)return!1;if(u.gtn(0)<=0)return!1;const h=T(t),f=u.invm(p),g=h.mul(f).umod(p),y=o.mul(f).umod(p),_=l.mulAdd(g,s,y);return!_.isInfinity()&&_.x.umod(p).eq(o)}}})),r.register("iFR0t",(function(t,e){!function(t,e){function n(t,e){if(!t)throw new Error(e||"Assertion failed")}function i(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}function s(t,e,r){if(s.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(r=e,e=10),this._init(t||0,e||10,r||"be"))}var o;"object"==typeof t?t.exports=s:e.BN=s,s.BN=s,s.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:r("eUijm").Buffer}catch(t){}function u(t,e){var r=t.charCodeAt(e);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function a(t,e,r){var n=u(t,r);return r-1>=e&&(n|=u(t,r-1)<<4),n}function h(t,e,r,n){for(var i=0,s=Math.min(t.length,r),o=e;o<s;o++){var u=t.charCodeAt(o)-48;i*=n,i+=u>=49?u-49+10:u>=17?u-17+10:u}return i}s.isBN=function(t){return t instanceof s||null!==t&&"object"==typeof t&&t.constructor.wordSize===s.wordSize&&Array.isArray(t.words)},s.max=function(t,e){return t.cmp(e)>0?t:e},s.min=function(t,e){return t.cmp(e)<0?t:e},s.prototype._init=function(t,e,r){if("number"==typeof t)return this._initNumber(t,e,r);if("object"==typeof t)return this._initArray(t,e,r);"hex"===e&&(e=16),n(e===(0|e)&&e>=2&&e<=36);var i=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&(i++,this.negative=1),i<t.length&&(16===e?this._parseHex(t,i,r):(this._parseBase(t,e,i),"le"===r&&this._initArray(this.toArray(),e,r)))},s.prototype._initNumber=function(t,e,r){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(n(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===r&&this._initArray(this.toArray(),e,r)},s.prototype._initArray=function(t,e,r){if(n("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var s,o,u=0;if("be"===r)for(i=t.length-1,s=0;i>=0;i-=3)o=t[i]|t[i-1]<<8|t[i-2]<<16,this.words[s]|=o<<u&67108863,this.words[s+1]=o>>>26-u&67108863,(u+=24)>=26&&(u-=26,s++);else if("le"===r)for(i=0,s=0;i<t.length;i+=3)o=t[i]|t[i+1]<<8|t[i+2]<<16,this.words[s]|=o<<u&67108863,this.words[s+1]=o>>>26-u&67108863,(u+=24)>=26&&(u-=26,s++);return this.strip()},s.prototype._parseHex=function(t,e,r){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var i,s=0,o=0;if("be"===r)for(n=t.length-1;n>=e;n-=2)i=a(t,e,n)<<s,this.words[o]|=67108863&i,s>=18?(s-=18,o+=1,this.words[o]|=i>>>26):s+=8;else for(n=(t.length-e)%2==0?e+1:e;n<t.length;n+=2)i=a(t,e,n)<<s,this.words[o]|=67108863&i,s>=18?(s-=18,o+=1,this.words[o]|=i>>>26):s+=8;this.strip()},s.prototype._parseBase=function(t,e,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=67108863;i*=e)n++;n--,i=i/e|0;for(var s=t.length-r,o=s%n,u=Math.min(s,s-o)+r,a=0,p=r;p<u;p+=n)a=h(t,p,p+n,e),this.imuln(i),this.words[0]+a<67108864?this.words[0]+=a:this._iaddn(a);if(0!==o){var c=1;for(a=h(t,p,t.length,e),p=0;p<o;p++)c*=e;this.imuln(c),this.words[0]+a<67108864?this.words[0]+=a:this._iaddn(a)}this.strip()},s.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},s.prototype.clone=function(){var t=new s(null);return this.copy(t),t},s.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var p=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],c=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],l=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(t,e,r){r.negative=e.negative^t.negative;var n=t.length+e.length|0;r.length=n,n=n-1|0;var i=0|t.words[0],s=0|e.words[0],o=i*s,u=67108863&o,a=o/67108864|0;r.words[0]=u;for(var h=1;h<n;h++){for(var p=a>>>26,c=67108863&a,l=Math.min(h,e.length-1),f=Math.max(0,h-t.length+1);f<=l;f++){var d=h-f|0;p+=(o=(i=0|t.words[d])*(s=0|e.words[f])+c)/67108864|0,c=67108863&o}r.words[h]=0|c,a=0|p}return 0!==a?r.words[h]=0|a:r.length--,r.strip()}s.prototype.toString=function(t,e){var r;if(e=0|e||1,16===(t=t||10)||"hex"===t){r="";for(var i=0,s=0,o=0;o<this.length;o++){var u=this.words[o],a=(16777215&(u<<i|s)).toString(16);r=0!==(s=u>>>24-i&16777215)||o!==this.length-1?p[6-a.length]+a+r:a+r,(i+=2)>=26&&(i-=26,o--)}for(0!==s&&(r=s.toString(16)+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(t===(0|t)&&t>=2&&t<=36){var h=c[t],f=l[t];r="";var d=this.clone();for(d.negative=0;!d.isZero();){var g=d.modn(f).toString(t);r=(d=d.idivn(f)).isZero()?g+r:p[h-g.length]+g+r}for(this.isZero()&&(r="0"+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}n(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(t,e){return n(void 0!==o),this.toArrayLike(o,t,e)},s.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)},s.prototype.toArrayLike=function(t,e,r){var i=this.byteLength(),s=r||Math.max(1,i);n(i<=s,"byte array longer than desired length"),n(s>0,"Requested array length <= 0"),this.strip();var o,u,a="le"===e,h=new t(s),p=this.clone();if(a){for(u=0;!p.isZero();u++)o=p.andln(255),p.iushrn(8),h[u]=o;for(;u<s;u++)h[u]=0}else{for(u=0;u<s-i;u++)h[u]=0;for(u=0;!p.isZero();u++)o=p.andln(255),p.iushrn(8),h[s-u-1]=o}return h},Math.clz32?s.prototype._countBits=function(t){return 32-Math.clz32(t)}:s.prototype._countBits=function(t){var e=t,r=0;return e>=4096&&(r+=13,e>>>=13),e>=64&&(r+=7,e>>>=7),e>=8&&(r+=4,e>>>=4),e>=2&&(r+=2,e>>>=2),r+e},s.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,r=0;return 0==(8191&e)&&(r+=13,e>>>=13),0==(127&e)&&(r+=7,e>>>=7),0==(15&e)&&(r+=4,e>>>=4),0==(3&e)&&(r+=2,e>>>=2),0==(1&e)&&r++,r},s.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var r=this._zeroBits(this.words[e]);if(t+=r,26!==r)break}return t},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},s.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return 0!==this.negative},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this.strip()},s.prototype.ior=function(t){return n(0==(this.negative|t.negative)),this.iuor(t)},s.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},s.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},s.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var r=0;r<e.length;r++)this.words[r]=this.words[r]&t.words[r];return this.length=e.length,this.strip()},s.prototype.iand=function(t){return n(0==(this.negative|t.negative)),this.iuand(t)},s.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},s.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},s.prototype.iuxor=function(t){var e,r;this.length>t.length?(e=this,r=t):(e=t,r=this);for(var n=0;n<r.length;n++)this.words[n]=e.words[n]^r.words[n];if(this!==e)for(;n<e.length;n++)this.words[n]=e.words[n];return this.length=e.length,this.strip()},s.prototype.ixor=function(t){return n(0==(this.negative|t.negative)),this.iuxor(t)},s.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},s.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},s.prototype.inotn=function(t){n("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),r=t%26;this._expand(e),r>0&&e--;for(var i=0;i<e;i++)this.words[i]=67108863&~this.words[i];return r>0&&(this.words[i]=~this.words[i]&67108863>>26-r),this.strip()},s.prototype.notn=function(t){return this.clone().inotn(t)},s.prototype.setn=function(t,e){n("number"==typeof t&&t>=0);var r=t/26|0,i=t%26;return this._expand(r+1),this.words[r]=e?this.words[r]|1<<i:this.words[r]&~(1<<i),this.strip()},s.prototype.iadd=function(t){var e,r,n;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(r=this,n=t):(r=t,n=this);for(var i=0,s=0;s<n.length;s++)e=(0|r.words[s])+(0|n.words[s])+i,this.words[s]=67108863&e,i=e>>>26;for(;0!==i&&s<r.length;s++)e=(0|r.words[s])+i,this.words[s]=67108863&e,i=e>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this},s.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},s.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var r,n,i=this.cmp(t);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(r=this,n=t):(r=t,n=this);for(var s=0,o=0;o<n.length;o++)s=(e=(0|r.words[o])-(0|n.words[o])+s)>>26,this.words[o]=67108863&e;for(;0!==s&&o<r.length;o++)s=(e=(0|r.words[o])+s)>>26,this.words[o]=67108863&e;if(0===s&&o<r.length&&r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=Math.max(this.length,o),r!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(t){return this.clone().isub(t)};var d=function(t,e,r){var n,i,s,o=t.words,u=e.words,a=r.words,h=0,p=0|o[0],c=8191&p,l=p>>>13,f=0|o[1],d=8191&f,g=f>>>13,m=0|o[2],w=8191&m,y=m>>>13,v=0|o[3],_=8191&v,E=v>>>13,S=0|o[4],b=8191&S,I=S>>>13,T=0|o[5],P=8191&T,O=T>>>13,M=0|o[6],x=8191&M,k=M>>>13,A=0|o[7],U=8191&A,N=A>>>13,B=0|o[8],H=8191&B,R=B>>>13,C=0|o[9],L=8191&C,D=C>>>13,K=0|u[0],q=8191&K,W=K>>>13,F=0|u[1],V=8191&F,G=F>>>13,j=0|u[2],X=8191&j,$=j>>>13,z=0|u[3],Y=8191&z,Q=z>>>13,J=0|u[4],Z=8191&J,tt=J>>>13,et=0|u[5],rt=8191&et,nt=et>>>13,it=0|u[6],st=8191&it,ot=it>>>13,ut=0|u[7],at=8191&ut,ht=ut>>>13,pt=0|u[8],ct=8191&pt,lt=pt>>>13,ft=0|u[9],dt=8191&ft,gt=ft>>>13;r.negative=t.negative^e.negative,r.length=19;var mt=(h+(n=Math.imul(c,q))|0)+((8191&(i=(i=Math.imul(c,W))+Math.imul(l,q)|0))<<13)|0;h=((s=Math.imul(l,W))+(i>>>13)|0)+(mt>>>26)|0,mt&=67108863,n=Math.imul(d,q),i=(i=Math.imul(d,W))+Math.imul(g,q)|0,s=Math.imul(g,W);var wt=(h+(n=n+Math.imul(c,V)|0)|0)+((8191&(i=(i=i+Math.imul(c,G)|0)+Math.imul(l,V)|0))<<13)|0;h=((s=s+Math.imul(l,G)|0)+(i>>>13)|0)+(wt>>>26)|0,wt&=67108863,n=Math.imul(w,q),i=(i=Math.imul(w,W))+Math.imul(y,q)|0,s=Math.imul(y,W),n=n+Math.imul(d,V)|0,i=(i=i+Math.imul(d,G)|0)+Math.imul(g,V)|0,s=s+Math.imul(g,G)|0;var yt=(h+(n=n+Math.imul(c,X)|0)|0)+((8191&(i=(i=i+Math.imul(c,$)|0)+Math.imul(l,X)|0))<<13)|0;h=((s=s+Math.imul(l,$)|0)+(i>>>13)|0)+(yt>>>26)|0,yt&=67108863,n=Math.imul(_,q),i=(i=Math.imul(_,W))+Math.imul(E,q)|0,s=Math.imul(E,W),n=n+Math.imul(w,V)|0,i=(i=i+Math.imul(w,G)|0)+Math.imul(y,V)|0,s=s+Math.imul(y,G)|0,n=n+Math.imul(d,X)|0,i=(i=i+Math.imul(d,$)|0)+Math.imul(g,X)|0,s=s+Math.imul(g,$)|0;var vt=(h+(n=n+Math.imul(c,Y)|0)|0)+((8191&(i=(i=i+Math.imul(c,Q)|0)+Math.imul(l,Y)|0))<<13)|0;h=((s=s+Math.imul(l,Q)|0)+(i>>>13)|0)+(vt>>>26)|0,vt&=67108863,n=Math.imul(b,q),i=(i=Math.imul(b,W))+Math.imul(I,q)|0,s=Math.imul(I,W),n=n+Math.imul(_,V)|0,i=(i=i+Math.imul(_,G)|0)+Math.imul(E,V)|0,s=s+Math.imul(E,G)|0,n=n+Math.imul(w,X)|0,i=(i=i+Math.imul(w,$)|0)+Math.imul(y,X)|0,s=s+Math.imul(y,$)|0,n=n+Math.imul(d,Y)|0,i=(i=i+Math.imul(d,Q)|0)+Math.imul(g,Y)|0,s=s+Math.imul(g,Q)|0;var _t=(h+(n=n+Math.imul(c,Z)|0)|0)+((8191&(i=(i=i+Math.imul(c,tt)|0)+Math.imul(l,Z)|0))<<13)|0;h=((s=s+Math.imul(l,tt)|0)+(i>>>13)|0)+(_t>>>26)|0,_t&=67108863,n=Math.imul(P,q),i=(i=Math.imul(P,W))+Math.imul(O,q)|0,s=Math.imul(O,W),n=n+Math.imul(b,V)|0,i=(i=i+Math.imul(b,G)|0)+Math.imul(I,V)|0,s=s+Math.imul(I,G)|0,n=n+Math.imul(_,X)|0,i=(i=i+Math.imul(_,$)|0)+Math.imul(E,X)|0,s=s+Math.imul(E,$)|0,n=n+Math.imul(w,Y)|0,i=(i=i+Math.imul(w,Q)|0)+Math.imul(y,Y)|0,s=s+Math.imul(y,Q)|0,n=n+Math.imul(d,Z)|0,i=(i=i+Math.imul(d,tt)|0)+Math.imul(g,Z)|0,s=s+Math.imul(g,tt)|0;var Et=(h+(n=n+Math.imul(c,rt)|0)|0)+((8191&(i=(i=i+Math.imul(c,nt)|0)+Math.imul(l,rt)|0))<<13)|0;h=((s=s+Math.imul(l,nt)|0)+(i>>>13)|0)+(Et>>>26)|0,Et&=67108863,n=Math.imul(x,q),i=(i=Math.imul(x,W))+Math.imul(k,q)|0,s=Math.imul(k,W),n=n+Math.imul(P,V)|0,i=(i=i+Math.imul(P,G)|0)+Math.imul(O,V)|0,s=s+Math.imul(O,G)|0,n=n+Math.imul(b,X)|0,i=(i=i+Math.imul(b,$)|0)+Math.imul(I,X)|0,s=s+Math.imul(I,$)|0,n=n+Math.imul(_,Y)|0,i=(i=i+Math.imul(_,Q)|0)+Math.imul(E,Y)|0,s=s+Math.imul(E,Q)|0,n=n+Math.imul(w,Z)|0,i=(i=i+Math.imul(w,tt)|0)+Math.imul(y,Z)|0,s=s+Math.imul(y,tt)|0,n=n+Math.imul(d,rt)|0,i=(i=i+Math.imul(d,nt)|0)+Math.imul(g,rt)|0,s=s+Math.imul(g,nt)|0;var St=(h+(n=n+Math.imul(c,st)|0)|0)+((8191&(i=(i=i+Math.imul(c,ot)|0)+Math.imul(l,st)|0))<<13)|0;h=((s=s+Math.imul(l,ot)|0)+(i>>>13)|0)+(St>>>26)|0,St&=67108863,n=Math.imul(U,q),i=(i=Math.imul(U,W))+Math.imul(N,q)|0,s=Math.imul(N,W),n=n+Math.imul(x,V)|0,i=(i=i+Math.imul(x,G)|0)+Math.imul(k,V)|0,s=s+Math.imul(k,G)|0,n=n+Math.imul(P,X)|0,i=(i=i+Math.imul(P,$)|0)+Math.imul(O,X)|0,s=s+Math.imul(O,$)|0,n=n+Math.imul(b,Y)|0,i=(i=i+Math.imul(b,Q)|0)+Math.imul(I,Y)|0,s=s+Math.imul(I,Q)|0,n=n+Math.imul(_,Z)|0,i=(i=i+Math.imul(_,tt)|0)+Math.imul(E,Z)|0,s=s+Math.imul(E,tt)|0,n=n+Math.imul(w,rt)|0,i=(i=i+Math.imul(w,nt)|0)+Math.imul(y,rt)|0,s=s+Math.imul(y,nt)|0,n=n+Math.imul(d,st)|0,i=(i=i+Math.imul(d,ot)|0)+Math.imul(g,st)|0,s=s+Math.imul(g,ot)|0;var bt=(h+(n=n+Math.imul(c,at)|0)|0)+((8191&(i=(i=i+Math.imul(c,ht)|0)+Math.imul(l,at)|0))<<13)|0;h=((s=s+Math.imul(l,ht)|0)+(i>>>13)|0)+(bt>>>26)|0,bt&=67108863,n=Math.imul(H,q),i=(i=Math.imul(H,W))+Math.imul(R,q)|0,s=Math.imul(R,W),n=n+Math.imul(U,V)|0,i=(i=i+Math.imul(U,G)|0)+Math.imul(N,V)|0,s=s+Math.imul(N,G)|0,n=n+Math.imul(x,X)|0,i=(i=i+Math.imul(x,$)|0)+Math.imul(k,X)|0,s=s+Math.imul(k,$)|0,n=n+Math.imul(P,Y)|0,i=(i=i+Math.imul(P,Q)|0)+Math.imul(O,Y)|0,s=s+Math.imul(O,Q)|0,n=n+Math.imul(b,Z)|0,i=(i=i+Math.imul(b,tt)|0)+Math.imul(I,Z)|0,s=s+Math.imul(I,tt)|0,n=n+Math.imul(_,rt)|0,i=(i=i+Math.imul(_,nt)|0)+Math.imul(E,rt)|0,s=s+Math.imul(E,nt)|0,n=n+Math.imul(w,st)|0,i=(i=i+Math.imul(w,ot)|0)+Math.imul(y,st)|0,s=s+Math.imul(y,ot)|0,n=n+Math.imul(d,at)|0,i=(i=i+Math.imul(d,ht)|0)+Math.imul(g,at)|0,s=s+Math.imul(g,ht)|0;var It=(h+(n=n+Math.imul(c,ct)|0)|0)+((8191&(i=(i=i+Math.imul(c,lt)|0)+Math.imul(l,ct)|0))<<13)|0;h=((s=s+Math.imul(l,lt)|0)+(i>>>13)|0)+(It>>>26)|0,It&=67108863,n=Math.imul(L,q),i=(i=Math.imul(L,W))+Math.imul(D,q)|0,s=Math.imul(D,W),n=n+Math.imul(H,V)|0,i=(i=i+Math.imul(H,G)|0)+Math.imul(R,V)|0,s=s+Math.imul(R,G)|0,n=n+Math.imul(U,X)|0,i=(i=i+Math.imul(U,$)|0)+Math.imul(N,X)|0,s=s+Math.imul(N,$)|0,n=n+Math.imul(x,Y)|0,i=(i=i+Math.imul(x,Q)|0)+Math.imul(k,Y)|0,s=s+Math.imul(k,Q)|0,n=n+Math.imul(P,Z)|0,i=(i=i+Math.imul(P,tt)|0)+Math.imul(O,Z)|0,s=s+Math.imul(O,tt)|0,n=n+Math.imul(b,rt)|0,i=(i=i+Math.imul(b,nt)|0)+Math.imul(I,rt)|0,s=s+Math.imul(I,nt)|0,n=n+Math.imul(_,st)|0,i=(i=i+Math.imul(_,ot)|0)+Math.imul(E,st)|0,s=s+Math.imul(E,ot)|0,n=n+Math.imul(w,at)|0,i=(i=i+Math.imul(w,ht)|0)+Math.imul(y,at)|0,s=s+Math.imul(y,ht)|0,n=n+Math.imul(d,ct)|0,i=(i=i+Math.imul(d,lt)|0)+Math.imul(g,ct)|0,s=s+Math.imul(g,lt)|0;var Tt=(h+(n=n+Math.imul(c,dt)|0)|0)+((8191&(i=(i=i+Math.imul(c,gt)|0)+Math.imul(l,dt)|0))<<13)|0;h=((s=s+Math.imul(l,gt)|0)+(i>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,n=Math.imul(L,V),i=(i=Math.imul(L,G))+Math.imul(D,V)|0,s=Math.imul(D,G),n=n+Math.imul(H,X)|0,i=(i=i+Math.imul(H,$)|0)+Math.imul(R,X)|0,s=s+Math.imul(R,$)|0,n=n+Math.imul(U,Y)|0,i=(i=i+Math.imul(U,Q)|0)+Math.imul(N,Y)|0,s=s+Math.imul(N,Q)|0,n=n+Math.imul(x,Z)|0,i=(i=i+Math.imul(x,tt)|0)+Math.imul(k,Z)|0,s=s+Math.imul(k,tt)|0,n=n+Math.imul(P,rt)|0,i=(i=i+Math.imul(P,nt)|0)+Math.imul(O,rt)|0,s=s+Math.imul(O,nt)|0,n=n+Math.imul(b,st)|0,i=(i=i+Math.imul(b,ot)|0)+Math.imul(I,st)|0,s=s+Math.imul(I,ot)|0,n=n+Math.imul(_,at)|0,i=(i=i+Math.imul(_,ht)|0)+Math.imul(E,at)|0,s=s+Math.imul(E,ht)|0,n=n+Math.imul(w,ct)|0,i=(i=i+Math.imul(w,lt)|0)+Math.imul(y,ct)|0,s=s+Math.imul(y,lt)|0;var Pt=(h+(n=n+Math.imul(d,dt)|0)|0)+((8191&(i=(i=i+Math.imul(d,gt)|0)+Math.imul(g,dt)|0))<<13)|0;h=((s=s+Math.imul(g,gt)|0)+(i>>>13)|0)+(Pt>>>26)|0,Pt&=67108863,n=Math.imul(L,X),i=(i=Math.imul(L,$))+Math.imul(D,X)|0,s=Math.imul(D,$),n=n+Math.imul(H,Y)|0,i=(i=i+Math.imul(H,Q)|0)+Math.imul(R,Y)|0,s=s+Math.imul(R,Q)|0,n=n+Math.imul(U,Z)|0,i=(i=i+Math.imul(U,tt)|0)+Math.imul(N,Z)|0,s=s+Math.imul(N,tt)|0,n=n+Math.imul(x,rt)|0,i=(i=i+Math.imul(x,nt)|0)+Math.imul(k,rt)|0,s=s+Math.imul(k,nt)|0,n=n+Math.imul(P,st)|0,i=(i=i+Math.imul(P,ot)|0)+Math.imul(O,st)|0,s=s+Math.imul(O,ot)|0,n=n+Math.imul(b,at)|0,i=(i=i+Math.imul(b,ht)|0)+Math.imul(I,at)|0,s=s+Math.imul(I,ht)|0,n=n+Math.imul(_,ct)|0,i=(i=i+Math.imul(_,lt)|0)+Math.imul(E,ct)|0,s=s+Math.imul(E,lt)|0;var Ot=(h+(n=n+Math.imul(w,dt)|0)|0)+((8191&(i=(i=i+Math.imul(w,gt)|0)+Math.imul(y,dt)|0))<<13)|0;h=((s=s+Math.imul(y,gt)|0)+(i>>>13)|0)+(Ot>>>26)|0,Ot&=67108863,n=Math.imul(L,Y),i=(i=Math.imul(L,Q))+Math.imul(D,Y)|0,s=Math.imul(D,Q),n=n+Math.imul(H,Z)|0,i=(i=i+Math.imul(H,tt)|0)+Math.imul(R,Z)|0,s=s+Math.imul(R,tt)|0,n=n+Math.imul(U,rt)|0,i=(i=i+Math.imul(U,nt)|0)+Math.imul(N,rt)|0,s=s+Math.imul(N,nt)|0,n=n+Math.imul(x,st)|0,i=(i=i+Math.imul(x,ot)|0)+Math.imul(k,st)|0,s=s+Math.imul(k,ot)|0,n=n+Math.imul(P,at)|0,i=(i=i+Math.imul(P,ht)|0)+Math.imul(O,at)|0,s=s+Math.imul(O,ht)|0,n=n+Math.imul(b,ct)|0,i=(i=i+Math.imul(b,lt)|0)+Math.imul(I,ct)|0,s=s+Math.imul(I,lt)|0;var Mt=(h+(n=n+Math.imul(_,dt)|0)|0)+((8191&(i=(i=i+Math.imul(_,gt)|0)+Math.imul(E,dt)|0))<<13)|0;h=((s=s+Math.imul(E,gt)|0)+(i>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,n=Math.imul(L,Z),i=(i=Math.imul(L,tt))+Math.imul(D,Z)|0,s=Math.imul(D,tt),n=n+Math.imul(H,rt)|0,i=(i=i+Math.imul(H,nt)|0)+Math.imul(R,rt)|0,s=s+Math.imul(R,nt)|0,n=n+Math.imul(U,st)|0,i=(i=i+Math.imul(U,ot)|0)+Math.imul(N,st)|0,s=s+Math.imul(N,ot)|0,n=n+Math.imul(x,at)|0,i=(i=i+Math.imul(x,ht)|0)+Math.imul(k,at)|0,s=s+Math.imul(k,ht)|0,n=n+Math.imul(P,ct)|0,i=(i=i+Math.imul(P,lt)|0)+Math.imul(O,ct)|0,s=s+Math.imul(O,lt)|0;var xt=(h+(n=n+Math.imul(b,dt)|0)|0)+((8191&(i=(i=i+Math.imul(b,gt)|0)+Math.imul(I,dt)|0))<<13)|0;h=((s=s+Math.imul(I,gt)|0)+(i>>>13)|0)+(xt>>>26)|0,xt&=67108863,n=Math.imul(L,rt),i=(i=Math.imul(L,nt))+Math.imul(D,rt)|0,s=Math.imul(D,nt),n=n+Math.imul(H,st)|0,i=(i=i+Math.imul(H,ot)|0)+Math.imul(R,st)|0,s=s+Math.imul(R,ot)|0,n=n+Math.imul(U,at)|0,i=(i=i+Math.imul(U,ht)|0)+Math.imul(N,at)|0,s=s+Math.imul(N,ht)|0,n=n+Math.imul(x,ct)|0,i=(i=i+Math.imul(x,lt)|0)+Math.imul(k,ct)|0,s=s+Math.imul(k,lt)|0;var kt=(h+(n=n+Math.imul(P,dt)|0)|0)+((8191&(i=(i=i+Math.imul(P,gt)|0)+Math.imul(O,dt)|0))<<13)|0;h=((s=s+Math.imul(O,gt)|0)+(i>>>13)|0)+(kt>>>26)|0,kt&=67108863,n=Math.imul(L,st),i=(i=Math.imul(L,ot))+Math.imul(D,st)|0,s=Math.imul(D,ot),n=n+Math.imul(H,at)|0,i=(i=i+Math.imul(H,ht)|0)+Math.imul(R,at)|0,s=s+Math.imul(R,ht)|0,n=n+Math.imul(U,ct)|0,i=(i=i+Math.imul(U,lt)|0)+Math.imul(N,ct)|0,s=s+Math.imul(N,lt)|0;var At=(h+(n=n+Math.imul(x,dt)|0)|0)+((8191&(i=(i=i+Math.imul(x,gt)|0)+Math.imul(k,dt)|0))<<13)|0;h=((s=s+Math.imul(k,gt)|0)+(i>>>13)|0)+(At>>>26)|0,At&=67108863,n=Math.imul(L,at),i=(i=Math.imul(L,ht))+Math.imul(D,at)|0,s=Math.imul(D,ht),n=n+Math.imul(H,ct)|0,i=(i=i+Math.imul(H,lt)|0)+Math.imul(R,ct)|0,s=s+Math.imul(R,lt)|0;var Ut=(h+(n=n+Math.imul(U,dt)|0)|0)+((8191&(i=(i=i+Math.imul(U,gt)|0)+Math.imul(N,dt)|0))<<13)|0;h=((s=s+Math.imul(N,gt)|0)+(i>>>13)|0)+(Ut>>>26)|0,Ut&=67108863,n=Math.imul(L,ct),i=(i=Math.imul(L,lt))+Math.imul(D,ct)|0,s=Math.imul(D,lt);var Nt=(h+(n=n+Math.imul(H,dt)|0)|0)+((8191&(i=(i=i+Math.imul(H,gt)|0)+Math.imul(R,dt)|0))<<13)|0;h=((s=s+Math.imul(R,gt)|0)+(i>>>13)|0)+(Nt>>>26)|0,Nt&=67108863;var Bt=(h+(n=Math.imul(L,dt))|0)+((8191&(i=(i=Math.imul(L,gt))+Math.imul(D,dt)|0))<<13)|0;return h=((s=Math.imul(D,gt))+(i>>>13)|0)+(Bt>>>26)|0,Bt&=67108863,a[0]=mt,a[1]=wt,a[2]=yt,a[3]=vt,a[4]=_t,a[5]=Et,a[6]=St,a[7]=bt,a[8]=It,a[9]=Tt,a[10]=Pt,a[11]=Ot,a[12]=Mt,a[13]=xt,a[14]=kt,a[15]=At,a[16]=Ut,a[17]=Nt,a[18]=Bt,0!==h&&(a[19]=h,r.length++),r};function g(t,e,r){return(new m).mulp(t,e,r)}function m(t,e){this.x=t,this.y=e}Math.imul||(d=f),s.prototype.mulTo=function(t,e){var r,n=this.length+t.length;return r=10===this.length&&10===t.length?d(this,t,e):n<63?f(this,t,e):n<1024?function(t,e,r){r.negative=e.negative^t.negative,r.length=t.length+e.length;for(var n=0,i=0,s=0;s<r.length-1;s++){var o=i;i=0;for(var u=67108863&n,a=Math.min(s,e.length-1),h=Math.max(0,s-t.length+1);h<=a;h++){var p=s-h,c=(0|t.words[p])*(0|e.words[h]),l=67108863&c;u=67108863&(l=l+u|0),i+=(o=(o=o+(c/67108864|0)|0)+(l>>>26)|0)>>>26,o&=67108863}r.words[s]=u,n=o,o=i}return 0!==n?r.words[s]=n:r.length--,r.strip()}(this,t,e):g(this,t,e),r},m.prototype.makeRBT=function(t){for(var e=new Array(t),r=s.prototype._countBits(t)-1,n=0;n<t;n++)e[n]=this.revBin(n,r,t);return e},m.prototype.revBin=function(t,e,r){if(0===t||t===r-1)return t;for(var n=0,i=0;i<e;i++)n|=(1&t)<<e-i-1,t>>=1;return n},m.prototype.permute=function(t,e,r,n,i,s){for(var o=0;o<s;o++)n[o]=e[t[o]],i[o]=r[t[o]]},m.prototype.transform=function(t,e,r,n,i,s){this.permute(s,t,e,r,n,i);for(var o=1;o<i;o<<=1)for(var u=o<<1,a=Math.cos(2*Math.PI/u),h=Math.sin(2*Math.PI/u),p=0;p<i;p+=u)for(var c=a,l=h,f=0;f<o;f++){var d=r[p+f],g=n[p+f],m=r[p+f+o],w=n[p+f+o],y=c*m-l*w;w=c*w+l*m,m=y,r[p+f]=d+m,n[p+f]=g+w,r[p+f+o]=d-m,n[p+f+o]=g-w,f!==u&&(y=a*c-h*l,l=a*l+h*c,c=y)}},m.prototype.guessLen13b=function(t,e){var r=1|Math.max(e,t),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},m.prototype.conjugate=function(t,e,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=t[n];t[n]=t[r-n-1],t[r-n-1]=i,i=e[n],e[n]=-e[r-n-1],e[r-n-1]=-i}},m.prototype.normalize13b=function(t,e){for(var r=0,n=0;n<e/2;n++){var i=8192*Math.round(t[2*n+1]/e)+Math.round(t[2*n]/e)+r;t[n]=67108863&i,r=i<67108864?0:i/67108864|0}return t},m.prototype.convert13b=function(t,e,r,i){for(var s=0,o=0;o<e;o++)s+=0|t[o],r[2*o]=8191&s,s>>>=13,r[2*o+1]=8191&s,s>>>=13;for(o=2*e;o<i;++o)r[o]=0;n(0===s),n(0==(-8192&s))},m.prototype.stub=function(t){for(var e=new Array(t),r=0;r<t;r++)e[r]=0;return e},m.prototype.mulp=function(t,e,r){var n=2*this.guessLen13b(t.length,e.length),i=this.makeRBT(n),s=this.stub(n),o=new Array(n),u=new Array(n),a=new Array(n),h=new Array(n),p=new Array(n),c=new Array(n),l=r.words;l.length=n,this.convert13b(t.words,t.length,o,n),this.convert13b(e.words,e.length,h,n),this.transform(o,s,u,a,n,i),this.transform(h,s,p,c,n,i);for(var f=0;f<n;f++){var d=u[f]*p[f]-a[f]*c[f];a[f]=u[f]*c[f]+a[f]*p[f],u[f]=d}return this.conjugate(u,a,n),this.transform(u,a,l,s,n,i),this.conjugate(l,s,n),this.normalize13b(l,n),r.negative=t.negative^e.negative,r.length=t.length+e.length,r.strip()},s.prototype.mul=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},s.prototype.mulf=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),g(this,t,e)},s.prototype.imul=function(t){return this.clone().mulTo(t,this)},s.prototype.imuln=function(t){n("number"==typeof t),n(t<67108864);for(var e=0,r=0;r<this.length;r++){var i=(0|this.words[r])*t,s=(67108863&i)+(67108863&e);e>>=26,e+=i/67108864|0,e+=s>>>26,this.words[r]=67108863&s}return 0!==e&&(this.words[r]=e,this.length++),this},s.prototype.muln=function(t){return this.clone().imuln(t)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),r=0;r<e.length;r++){var n=r/26|0,i=r%26;e[r]=(t.words[n]&1<<i)>>>i}return e}(t);if(0===e.length)return new s(1);for(var r=this,n=0;n<e.length&&0===e[n];n++,r=r.sqr());if(++n<e.length)for(var i=r.sqr();n<e.length;n++,i=i.sqr())0!==e[n]&&(r=r.mul(i));return r},s.prototype.iushln=function(t){n("number"==typeof t&&t>=0);var e,r=t%26,i=(t-r)/26,s=67108863>>>26-r<<26-r;if(0!==r){var o=0;for(e=0;e<this.length;e++){var u=this.words[e]&s,a=(0|this.words[e])-u<<r;this.words[e]=a|o,o=u>>>26-r}o&&(this.words[e]=o,this.length++)}if(0!==i){for(e=this.length-1;e>=0;e--)this.words[e+i]=this.words[e];for(e=0;e<i;e++)this.words[e]=0;this.length+=i}return this.strip()},s.prototype.ishln=function(t){return n(0===this.negative),this.iushln(t)},s.prototype.iushrn=function(t,e,r){var i;n("number"==typeof t&&t>=0),i=e?(e-e%26)/26:0;var s=t%26,o=Math.min((t-s)/26,this.length),u=67108863^67108863>>>s<<s,a=r;if(i-=o,i=Math.max(0,i),a){for(var h=0;h<o;h++)a.words[h]=this.words[h];a.length=o}if(0===o);else if(this.length>o)for(this.length-=o,h=0;h<this.length;h++)this.words[h]=this.words[h+o];else this.words[0]=0,this.length=1;var p=0;for(h=this.length-1;h>=0&&(0!==p||h>=i);h--){var c=0|this.words[h];this.words[h]=p<<26-s|c>>>s,p=c&u}return a&&0!==p&&(a.words[a.length++]=p),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(t,e,r){return n(0===this.negative),this.iushrn(t,e,r)},s.prototype.shln=function(t){return this.clone().ishln(t)},s.prototype.ushln=function(t){return this.clone().iushln(t)},s.prototype.shrn=function(t){return this.clone().ishrn(t)},s.prototype.ushrn=function(t){return this.clone().iushrn(t)},s.prototype.testn=function(t){n("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26,i=1<<e;return!(this.length<=r)&&!!(this.words[r]&i)},s.prototype.imaskn=function(t){n("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26;if(n(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==e&&r++,this.length=Math.min(r,this.length),0!==e){var i=67108863^67108863>>>e<<e;this.words[this.length-1]&=i}return this.strip()},s.prototype.maskn=function(t){return this.clone().imaskn(t)},s.prototype.iaddn=function(t){return n("number"==typeof t),n(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},s.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},s.prototype.isubn=function(t){if(n("number"==typeof t),n(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this.strip()},s.prototype.addn=function(t){return this.clone().iaddn(t)},s.prototype.subn=function(t){return this.clone().isubn(t)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(t,e,r){var i,s,o=t.length+r;this._expand(o);var u=0;for(i=0;i<t.length;i++){s=(0|this.words[i+r])+u;var a=(0|t.words[i])*e;u=((s-=67108863&a)>>26)-(a/67108864|0),this.words[i+r]=67108863&s}for(;i<this.length-r;i++)u=(s=(0|this.words[i+r])+u)>>26,this.words[i+r]=67108863&s;if(0===u)return this.strip();for(n(-1===u),u=0,i=0;i<this.length;i++)u=(s=-(0|this.words[i])+u)>>26,this.words[i]=67108863&s;return this.negative=1,this.strip()},s.prototype._wordDiv=function(t,e){var r=(this.length,t.length),n=this.clone(),i=t,o=0|i.words[i.length-1];0!==(r=26-this._countBits(o))&&(i=i.ushln(r),n.iushln(r),o=0|i.words[i.length-1]);var u,a=n.length-i.length;if("mod"!==e){(u=new s(null)).length=a+1,u.words=new Array(u.length);for(var h=0;h<u.length;h++)u.words[h]=0}var p=n.clone()._ishlnsubmul(i,1,a);0===p.negative&&(n=p,u&&(u.words[a]=1));for(var c=a-1;c>=0;c--){var l=67108864*(0|n.words[i.length+c])+(0|n.words[i.length+c-1]);for(l=Math.min(l/o|0,67108863),n._ishlnsubmul(i,l,c);0!==n.negative;)l--,n.negative=0,n._ishlnsubmul(i,1,c),n.isZero()||(n.negative^=1);u&&(u.words[c]=l)}return u&&u.strip(),n.strip(),"div"!==e&&0!==r&&n.iushrn(r),{div:u||null,mod:n}},s.prototype.divmod=function(t,e,r){return n(!t.isZero()),this.isZero()?{div:new s(0),mod:new s(0)}:0!==this.negative&&0===t.negative?(u=this.neg().divmod(t,e),"mod"!==e&&(i=u.div.neg()),"div"!==e&&(o=u.mod.neg(),r&&0!==o.negative&&o.iadd(t)),{div:i,mod:o}):0===this.negative&&0!==t.negative?(u=this.divmod(t.neg(),e),"mod"!==e&&(i=u.div.neg()),{div:i,mod:u.mod}):0!=(this.negative&t.negative)?(u=this.neg().divmod(t.neg(),e),"div"!==e&&(o=u.mod.neg(),r&&0!==o.negative&&o.isub(t)),{div:u.div,mod:o}):t.length>this.length||this.cmp(t)<0?{div:new s(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new s(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new s(this.modn(t.words[0]))}:this._wordDiv(t,e);var i,o,u},s.prototype.div=function(t){return this.divmod(t,"div",!1).div},s.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},s.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},s.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var r=0!==e.div.negative?e.mod.isub(t):e.mod,n=t.ushrn(1),i=t.andln(1),s=r.cmp(n);return s<0||1===i&&0===s?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},s.prototype.modn=function(t){n(t<=67108863);for(var e=67108864%t,r=0,i=this.length-1;i>=0;i--)r=(e*r+(0|this.words[i]))%t;return r},s.prototype.idivn=function(t){n(t<=67108863);for(var e=0,r=this.length-1;r>=0;r--){var i=(0|this.words[r])+67108864*e;this.words[r]=i/t|0,e=i%t}return this.strip()},s.prototype.divn=function(t){return this.clone().idivn(t)},s.prototype.egcd=function(t){n(0===t.negative),n(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var i=new s(1),o=new s(0),u=new s(0),a=new s(1),h=0;e.isEven()&&r.isEven();)e.iushrn(1),r.iushrn(1),++h;for(var p=r.clone(),c=e.clone();!e.isZero();){for(var l=0,f=1;0==(e.words[0]&f)&&l<26;++l,f<<=1);if(l>0)for(e.iushrn(l);l-- >0;)(i.isOdd()||o.isOdd())&&(i.iadd(p),o.isub(c)),i.iushrn(1),o.iushrn(1);for(var d=0,g=1;0==(r.words[0]&g)&&d<26;++d,g<<=1);if(d>0)for(r.iushrn(d);d-- >0;)(u.isOdd()||a.isOdd())&&(u.iadd(p),a.isub(c)),u.iushrn(1),a.iushrn(1);e.cmp(r)>=0?(e.isub(r),i.isub(u),o.isub(a)):(r.isub(e),u.isub(i),a.isub(o))}return{a:u,b:a,gcd:r.iushln(h)}},s.prototype._invmp=function(t){n(0===t.negative),n(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var i,o=new s(1),u=new s(0),a=r.clone();e.cmpn(1)>0&&r.cmpn(1)>0;){for(var h=0,p=1;0==(e.words[0]&p)&&h<26;++h,p<<=1);if(h>0)for(e.iushrn(h);h-- >0;)o.isOdd()&&o.iadd(a),o.iushrn(1);for(var c=0,l=1;0==(r.words[0]&l)&&c<26;++c,l<<=1);if(c>0)for(r.iushrn(c);c-- >0;)u.isOdd()&&u.iadd(a),u.iushrn(1);e.cmp(r)>=0?(e.isub(r),o.isub(u)):(r.isub(e),u.isub(o))}return(i=0===e.cmpn(1)?o:u).cmpn(0)<0&&i.iadd(t),i},s.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),r=t.clone();e.negative=0,r.negative=0;for(var n=0;e.isEven()&&r.isEven();n++)e.iushrn(1),r.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=e.cmp(r);if(i<0){var s=e;e=r,r=s}else if(0===i||0===r.cmpn(1))break;e.isub(r)}return r.iushln(n)},s.prototype.invm=function(t){return this.egcd(t).a.umod(t)},s.prototype.isEven=function(){return 0==(1&this.words[0])},s.prototype.isOdd=function(){return 1==(1&this.words[0])},s.prototype.andln=function(t){return this.words[0]&t},s.prototype.bincn=function(t){n("number"==typeof t);var e=t%26,r=(t-e)/26,i=1<<e;if(this.length<=r)return this._expand(r+1),this.words[r]|=i,this;for(var s=i,o=r;0!==s&&o<this.length;o++){var u=0|this.words[o];s=(u+=s)>>>26,u&=67108863,this.words[o]=u}return 0!==s&&(this.words[o]=s,this.length++),this},s.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},s.prototype.cmpn=function(t){var e,r=t<0;if(0!==this.negative&&!r)return-1;if(0===this.negative&&r)return 1;if(this.strip(),this.length>1)e=1;else{r&&(t=-t),n(t<=67108863,"Number is too big");var i=0|this.words[0];e=i===t?0:i<t?-1:1}return 0!==this.negative?0|-e:e},s.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},s.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|t.words[r];if(n!==i){n<i?e=-1:n>i&&(e=1);break}}return e},s.prototype.gtn=function(t){return 1===this.cmpn(t)},s.prototype.gt=function(t){return 1===this.cmp(t)},s.prototype.gten=function(t){return this.cmpn(t)>=0},s.prototype.gte=function(t){return this.cmp(t)>=0},s.prototype.ltn=function(t){return-1===this.cmpn(t)},s.prototype.lt=function(t){return-1===this.cmp(t)},s.prototype.lten=function(t){return this.cmpn(t)<=0},s.prototype.lte=function(t){return this.cmp(t)<=0},s.prototype.eqn=function(t){return 0===this.cmpn(t)},s.prototype.eq=function(t){return 0===this.cmp(t)},s.red=function(t){return new b(t)},s.prototype.toRed=function(t){return n(!this.red,"Already a number in reduction context"),n(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},s.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(t){return this.red=t,this},s.prototype.forceRed=function(t){return n(!this.red,"Already a number in reduction context"),this._forceRed(t)},s.prototype.redAdd=function(t){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},s.prototype.redIAdd=function(t){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},s.prototype.redSub=function(t){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},s.prototype.redISub=function(t){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},s.prototype.redShl=function(t){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},s.prototype.redMul=function(t){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},s.prototype.redIMul=function(t){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},s.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(t){return n(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var w={k256:null,p224:null,p192:null,p25519:null};function y(t,e){this.name=t,this.p=new s(e,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function _(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function E(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function b(t){if("string"==typeof t){var e=s._prime(t);this.m=e.p,this.prime=e}else n(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function I(t){b.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var t=new s(null);return t.words=new Array(Math.ceil(this.n/13)),t},y.prototype.ireduce=function(t){var e,r=t;do{this.split(r,this.tmp),e=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(e>this.n);var n=e<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(t,e){t.iushrn(this.n,0,e)},y.prototype.imulK=function(t){return t.imul(this.k)},i(v,y),v.prototype.split=function(t,e){for(var r=4194303,n=Math.min(t.length,9),i=0;i<n;i++)e.words[i]=t.words[i];if(e.length=n,t.length<=9)return t.words[0]=0,void(t.length=1);var s=t.words[9];for(e.words[e.length++]=s&r,i=10;i<t.length;i++){var o=0|t.words[i];t.words[i-10]=(o&r)<<4|s>>>22,s=o}s>>>=22,t.words[i-10]=s,0===s&&t.length>10?t.length-=10:t.length-=9},v.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,r=0;r<t.length;r++){var n=0|t.words[r];e+=977*n,t.words[r]=67108863&e,e=64*n+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},i(_,y),i(E,y),i(S,y),S.prototype.imulK=function(t){for(var e=0,r=0;r<t.length;r++){var n=19*(0|t.words[r])+e,i=67108863&n;n>>>=26,t.words[r]=i,e=n}return 0!==e&&(t.words[t.length++]=e),t},s._prime=function(t){if(w[t])return w[t];var e;if("k256"===t)e=new v;else if("p224"===t)e=new _;else if("p192"===t)e=new E;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new S}return w[t]=e,e},b.prototype._verify1=function(t){n(0===t.negative,"red works only with positives"),n(t.red,"red works only with red numbers")},b.prototype._verify2=function(t,e){n(0==(t.negative|e.negative),"red works only with positives"),n(t.red&&t.red===e.red,"red works only with red numbers")},b.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},b.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},b.prototype.add=function(t,e){this._verify2(t,e);var r=t.add(e);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},b.prototype.iadd=function(t,e){this._verify2(t,e);var r=t.iadd(e);return r.cmp(this.m)>=0&&r.isub(this.m),r},b.prototype.sub=function(t,e){this._verify2(t,e);var r=t.sub(e);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},b.prototype.isub=function(t,e){this._verify2(t,e);var r=t.isub(e);return r.cmpn(0)<0&&r.iadd(this.m),r},b.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},b.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},b.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},b.prototype.isqr=function(t){return this.imul(t,t.clone())},b.prototype.sqr=function(t){return this.mul(t,t)},b.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(n(e%2==1),3===e){var r=this.m.add(new s(1)).iushrn(2);return this.pow(t,r)}for(var i=this.m.subn(1),o=0;!i.isZero()&&0===i.andln(1);)o++,i.iushrn(1);n(!i.isZero());var u=new s(1).toRed(this),a=u.redNeg(),h=this.m.subn(1).iushrn(1),p=this.m.bitLength();for(p=new s(2*p*p).toRed(this);0!==this.pow(p,h).cmp(a);)p.redIAdd(a);for(var c=this.pow(p,i),l=this.pow(t,i.addn(1).iushrn(1)),f=this.pow(t,i),d=o;0!==f.cmp(u);){for(var g=f,m=0;0!==g.cmp(u);m++)g=g.redSqr();n(m<d);var w=this.pow(c,new s(1).iushln(d-m-1));l=l.redMul(w),c=w.redSqr(),f=f.redMul(c),d=m}return l},b.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},b.prototype.pow=function(t,e){if(e.isZero())return new s(1).toRed(this);if(0===e.cmpn(1))return t.clone();var r=new Array(16);r[0]=new s(1).toRed(this),r[1]=t;for(var n=2;n<r.length;n++)r[n]=this.mul(r[n-1],t);var i=r[0],o=0,u=0,a=e.bitLength()%26;for(0===a&&(a=26),n=e.length-1;n>=0;n--){for(var h=e.words[n],p=a-1;p>=0;p--){var c=h>>p&1;i!==r[0]&&(i=this.sqr(i)),0!==c||0!==o?(o<<=1,o|=c,(4===++u||0===n&&0===p)&&(i=this.mul(i,r[o]),u=0,o=0)):u=0}a=26}return i},b.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},b.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},s.mont=function(t){return new I(t)},i(I,b),I.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},I.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},I.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var r=t.imul(e),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),s=i;return i.cmp(this.m)>=0?s=i.isub(this.m):i.cmpn(0)<0&&(s=i.iadd(this.m)),s._forceRed(this)},I.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new s(0)._forceRed(this);var r=t.mul(e),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),o=i;return i.cmp(this.m)>=0?o=i.isub(this.m):i.cmpn(0)<0&&(o=i.iadd(this.m)),o._forceRed(this)},I.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(t,this)})),r.register("2fRSN",(function(t,e){var n=r("6rT8n").Buffer,i=r("3kMyY");const s=n.alloc(1,1),o=n.alloc(1,0);t.exports=function(t,e,r,u,a){let h=n.alloc(32,0),p=n.alloc(32,1);h=i("sha256",h).update(p).update(o).update(e).update(t).update(a||"").digest(),p=i("sha256",h).update(p).digest(),h=i("sha256",h).update(p).update(s).update(e).update(t).update(a||"").digest(),p=i("sha256",h).update(p).digest(),p=i("sha256",h).update(p).digest();let c=p;for(;!u(c)||!r(c);)h=i("sha256",h).update(p).update(o).digest(),p=i("sha256",h).update(p).digest(),p=i("sha256",h).update(p).digest(),c=p;return c}})),r.register("2kT0C",(function(t,e){var n=r("6rT8n").Buffer,i=r("f8pp6");function s(t,e){if(void 0!==e&&t[0]!==e)throw new Error("Invalid network version");if(33===t.length)return{version:t[0],privateKey:t.slice(1,33),compressed:!1};if(34!==t.length)throw new Error("Invalid WIF length");if(1!==t[33])throw new Error("Invalid compression flag");return{version:t[0],privateKey:t.slice(1,33),compressed:!0}}function o(t,e,r){var i=new n(r?34:33);return i.writeUInt8(t,0),e.copy(i,1),r&&(i[33]=1),i}t.exports={decode:function(t,e){return s(i.decode(t),e)},decodeRaw:s,encode:function(t,e,r){return"number"==typeof t?i.encode(o(t,e,r)):i.encode(o(t.version,t.privateKey,t.compressed))},encodeRaw:o}})),r.register("hJRqN",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("bwA6R"),s=r("4OftM"),o=r("gUdqP"),u=r("hJyAm"),a=r("lNNEE"),h=r("f8pp6"),p=r("8DFnu");function c(t){const e=h.decode(t);if(e.length<21)throw new TypeError(t+" is too short");if(e.length>21)throw new TypeError(t+" is too long");return{version:e.readUInt8(0),hash:e.slice(1)}}function l(t){const e=a.decode(t),r=a.fromWords(e.words.slice(1));return{version:e.words[0],prefix:e.prefix,data:n.from(r)}}t.exports.fromBase58Check=c,t.exports.fromBech32=l,t.exports.toBase58Check=function(t,e){p(u.tuple(u.Hash160bit,u.UInt8),arguments);const r=n.allocUnsafe(21);return r.writeUInt8(e,0),t.copy(r,1),h.encode(r)},t.exports.toBech32=function(t,e,r){const n=a.toWords(t);return n.unshift(e),a.encode(r,n)},t.exports.fromOutputScript=function(t,e){e=e||i.bitcoin;try{return s.p2pkh({output:t,network:e}).address}catch(t){}try{return s.p2sh({output:t,network:e}).address}catch(t){}try{return s.p2wpkh({output:t,network:e}).address}catch(t){}try{return s.p2wsh({output:t,network:e}).address}catch(t){}throw new Error(o.toASM(t)+" has no matching Address")},t.exports.toOutputScript=function(t,e){let r,n;e=e||i.bitcoin;try{r=c(t)}catch(t){}if(r){if(r.version===e.pubKeyHash)return s.p2pkh({hash:r.hash}).output;if(r.version===e.scriptHash)return s.p2sh({hash:r.hash}).output}else{try{n=l(t)}catch(t){}if(n){if(n.prefix!==e.bech32)throw new Error(t+" has an invalid prefix");if(0===n.version){if(20===n.data.length)return s.p2wpkh({hash:n.data}).output;if(32===n.data.length)return s.p2wsh({hash:n.data}).output}}}throw new Error(t+" has no matching Script")}})),r.register("bwA6R",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0}),t.exports.bitcoin={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},t.exports.regtest={messagePrefix:"Bitcoin Signed Message:\n",bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239},t.exports.testnet={messagePrefix:"Bitcoin Signed Message:\n",bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239}})),r.register("4OftM",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("3XfcS");t.exports.embed=n.p2data;var i=r("2LWcY");t.exports.p2ms=i.p2ms;var s=r("8d74P");t.exports.p2pk=s.p2pk;var o=r("7EvnJ");t.exports.p2pkh=o.p2pkh;var u=r("elhTQ");t.exports.p2sh=u.p2sh;var a=r("2RjGy");t.exports.p2wpkh=a.p2wpkh;var h=r("jRD9w");t.exports.p2wsh=h.p2wsh})),r.register("3XfcS",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("bwA6R"),i=r("gUdqP"),s=r("lVAUK"),o=r("8DFnu");const u=i.OPS;t.exports.p2data=function(t,e){if(!t.data&&!t.output)throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),o({network:o.maybe(o.Object),output:o.maybe(o.Buffer),data:o.maybe(o.arrayOf(o.Buffer))},t);const r={name:"embed",network:t.network||n.bitcoin};if(s.prop(r,"output",(()=>{if(t.data)return i.compile([u.OP_RETURN].concat(t.data))})),s.prop(r,"data",(()=>{if(t.output)return i.decompile(t.output).slice(1)})),e.validate&&t.output){const e=i.decompile(t.output);if(e[0]!==u.OP_RETURN)throw new TypeError("Output is invalid");if(!e.slice(1).every(o.Buffer))throw new TypeError("Output is invalid");if(t.data&&!function(t,e){return t.length===e.length&&t.every(((t,r)=>t.equals(e[r])))}(t.data,r.data))throw new TypeError("Data mismatch")}return Object.assign(r,t)}})),r.register("gUdqP",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("3zHUP"),s=r("6SfkD"),o=r("hJyAm"),u=r("jGi7V"),a=r("noLW6"),h=r("7jQ4i"),p=r("8DFnu");t.exports.OPS=r("iDl8A");var c=r("c9GkJ");const l=t.exports.OPS.OP_RESERVED;function f(e){return o.Buffer(e)||function(e){return o.Number(e)&&(e===t.exports.OPS.OP_0||e>=t.exports.OPS.OP_1&&e<=t.exports.OPS.OP_16||e===t.exports.OPS.OP_1NEGATE)}(e)}function d(t){return o.Array(t)&&t.every(f)}function g(e){return 0===e.length?t.exports.OPS.OP_0:1===e.length?e[0]>=1&&e[0]<=16?l+e[0]:129===e[0]?t.exports.OPS.OP_1NEGATE:void 0:void 0}function m(t){return n.isBuffer(t)}function w(t){return n.isBuffer(t)}function y(t){if(m(t))return t;p(o.Array,t);const e=t.reduce(((t,e)=>w(e)?1===e.length&&void 0!==g(e)?t+1:t+h.encodingLength(e.length)+e.length:t+1),0),r=n.allocUnsafe(e);let i=0;if(t.forEach((t=>{if(w(t)){const e=g(t);if(void 0!==e)return r.writeUInt8(e,i),void(i+=1);i+=h.encode(r,t.length,i),t.copy(r,i),i+=t.length}else r.writeUInt8(t,i),i+=1})),i!==r.length)throw new Error("Could not decode chunks");return r}function v(e){if(r=e,o.Array(r))return e;var r;p(o.Buffer,e);const n=[];let i=0;for(;i<e.length;){const r=e[i];if(r>t.exports.OPS.OP_0&&r<=t.exports.OPS.OP_PUSHDATA4){const t=h.decode(e,i);if(null===t)return null;if(i+=t.size,i+t.number>e.length)return null;const r=e.slice(i,i+t.number);i+=t.number;const s=g(r);void 0!==s?n.push(s):n.push(r)}else n.push(r),i+=1}return n}function _(t){const e=-129&t;return e>0&&e<4}t.exports.isPushOnly=d,t.exports.compile=y,t.exports.decompile=v,t.exports.toASM=function(t){return m(t)&&(t=v(t)),t.map((t=>{if(w(t)){const e=g(t);if(void 0===e)return t.toString("hex");t=e}return c[t]})).join(" ")},t.exports.fromASM=function(e){return p(o.String,e),y(e.split(" ").map((e=>void 0!==t.exports.OPS[e]?t.exports.OPS[e]:(p(o.Hex,e),n.from(e,"hex")))))},t.exports.toStack=function(e){return e=v(e),p(d,e),e.map((e=>w(e)?e:e===t.exports.OPS.OP_0?n.allocUnsafe(0):i.encode(e-l)))},t.exports.isCanonicalPubKey=function(t){return a.isPoint(t)},t.exports.isDefinedHashType=_,t.exports.isCanonicalScriptSignature=function(t){return!!n.isBuffer(t)&&(!!_(t[t.length-1])&&u.check(t.slice(0,-1)))},t.exports.number=i,t.exports.signature=s})),r.register("3zHUP",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0}),t.exports.decode=function(t,e,r){e=e||4,r=void 0===r||r;const n=t.length;if(0===n)return 0;if(n>e)throw new TypeError("Script number overflow");if(r&&0==(127&t[n-1])&&(n<=1||0==(128&t[n-2])))throw new Error("Non-minimally encoded script number");if(5===n){const e=t.readUInt32LE(0),r=t.readUInt8(4);return 128&r?-(4294967296*(-129&r)+e):4294967296*r+e}let i=0;for(let e=0;e<n;++e)i|=t[e]<<8*e;return 128&t[n-1]?-(i&~(128<<8*(n-1))):i},t.exports.encode=function(t){let e=Math.abs(t);const r=(i=e)>2147483647?5:i>8388607?4:i>32767?3:i>127?2:i>0?1:0;var i;const s=n.allocUnsafe(r),o=t<0;for(let t=0;t<r;++t)s.writeUInt8(255&e,t),e>>=8;return 128&s[r-1]?s.writeUInt8(o?128:0,r-1):o&&(s[r-1]|=128),s}})),r.register("6SfkD",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("hJyAm"),s=r("jGi7V"),o=r("8DFnu");const u=n.alloc(1,0);function a(t){let e=0;for(;0===t[e];)++e;return e===t.length?u:128&(t=t.slice(e))[0]?n.concat([u,t],1+t.length):t}function h(t){0===t[0]&&(t=t.slice(1));const e=n.alloc(32,0),r=Math.max(0,32-t.length);return t.copy(e,r),e}t.exports.decode=function(t){const e=t.readUInt8(t.length-1),r=-129&e;if(r<=0||r>=4)throw new Error("Invalid hashType "+e);const i=s.decode(t.slice(0,-1)),o=h(i.r),u=h(i.s);return{signature:n.concat([o,u],64),hashType:e}},t.exports.encode=function(t,e){o({signature:i.BufferN(64),hashType:i.UInt8},{signature:t,hashType:e});const r=-129&e;if(r<=0||r>=4)throw new Error("Invalid hashType "+e);const u=n.allocUnsafe(1);u.writeUInt8(e,0);const h=a(t.slice(0,32)),p=a(t.slice(32,64));return n.concat([s.encode(h,p),u])}})),r.register("hJyAm",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("8DFnu");const i=Math.pow(2,31)-1;function s(t){return n.String(t)&&!!t.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}t.exports.UInt31=function(t){return n.UInt32(t)&&t<=i},t.exports.BIP32Path=s,s.toJSON=()=>"BIP32 derivation path",t.exports.Signer=function(t){return(n.Buffer(t.publicKey)||"function"==typeof t.getPublicKey)&&"function"==typeof t.sign};const o=21e14;t.exports.Satoshi=function(t){return n.UInt53(t)&&t<=o},t.exports.ECPoint=n.quacksLike("Point"),t.exports.Network=n.compile({messagePrefix:n.oneOf(n.Buffer,n.String),bip32:{public:n.UInt32,private:n.UInt32},pubKeyHash:n.UInt8,scriptHash:n.UInt8,wif:n.UInt8}),t.exports.Buffer256bit=n.BufferN(32),t.exports.Hash160bit=n.BufferN(20),t.exports.Hash256bit=n.BufferN(32),t.exports.Number=n.Number,t.exports.Array=n.Array,t.exports.Boolean=n.Boolean,t.exports.String=n.String,t.exports.Buffer=n.Buffer,t.exports.Hex=n.Hex,t.exports.maybe=n.maybe,t.exports.tuple=n.tuple,t.exports.UInt8=n.UInt8,t.exports.UInt32=n.UInt32,t.exports.Function=n.Function,t.exports.BufferN=n.BufferN,t.exports.Null=n.Null,t.exports.oneOf=n.oneOf})),r.register("jGi7V",(function(t,e){var n=r("8Msk5").Buffer;t.exports={check:function(t){if(t.length<8)return!1;if(t.length>72)return!1;if(48!==t[0])return!1;if(t[1]!==t.length-2)return!1;if(2!==t[2])return!1;var e=t[3];if(0===e)return!1;if(5+e>=t.length)return!1;if(2!==t[4+e])return!1;var r=t[5+e];return 0!==r&&(6+e+r===t.length&&(!(128&t[4])&&(!(e>1&&0===t[4]&&!(128&t[5]))&&(!(128&t[e+6])&&!(r>1&&0===t[e+6]&&!(128&t[e+7]))))))},decode:function(t){if(t.length<8)throw new Error("DER sequence length is too short");if(t.length>72)throw new Error("DER sequence length is too long");if(48!==t[0])throw new Error("Expected DER sequence");if(t[1]!==t.length-2)throw new Error("DER sequence length is invalid");if(2!==t[2])throw new Error("Expected DER integer");var e=t[3];if(0===e)throw new Error("R length is zero");if(5+e>=t.length)throw new Error("R length is too long");if(2!==t[4+e])throw new Error("Expected DER integer (2)");var r=t[5+e];if(0===r)throw new Error("S length is zero");if(6+e+r!==t.length)throw new Error("S length is invalid");if(128&t[4])throw new Error("R value is negative");if(e>1&&0===t[4]&&!(128&t[5]))throw new Error("R value excessively padded");if(128&t[e+6])throw new Error("S value is negative");if(r>1&&0===t[e+6]&&!(128&t[e+7]))throw new Error("S value excessively padded");return{r:t.slice(4,4+e),s:t.slice(6+e)}},encode:function(t,e){var r=t.length,i=e.length;if(0===r)throw new Error("R length is zero");if(0===i)throw new Error("S length is zero");if(r>33)throw new Error("R length is too long");if(i>33)throw new Error("S length is too long");if(128&t[0])throw new Error("R value is negative");if(128&e[0])throw new Error("S value is negative");if(r>1&&0===t[0]&&!(128&t[1]))throw new Error("R value excessively padded");if(i>1&&0===e[0]&&!(128&e[1]))throw new Error("S value excessively padded");var s=n.allocUnsafe(6+r+i);return s[0]=48,s[1]=s.length-2,s[2]=2,s[3]=t.length,t.copy(s,4),s[4+r]=2,s[5+r]=e.length,e.copy(s,6+r),s}}})),r.register("7jQ4i",(function(t,e){var n=r("iDl8A");function i(t){return t<n.OP_PUSHDATA1?1:t<=255?2:t<=65535?3:5}t.exports={encodingLength:i,encode:function(t,e,r){var s=i(e);return 1===s?t.writeUInt8(e,r):2===s?(t.writeUInt8(n.OP_PUSHDATA1,r),t.writeUInt8(e,r+1)):3===s?(t.writeUInt8(n.OP_PUSHDATA2,r),t.writeUInt16LE(e,r+1)):(t.writeUInt8(n.OP_PUSHDATA4,r),t.writeUInt32LE(e,r+1)),s},decode:function(t,e){var r,i,s=t.readUInt8(e);if(s<n.OP_PUSHDATA1)r=s,i=1;else if(s===n.OP_PUSHDATA1){if(e+2>t.length)return null;r=t.readUInt8(e+1),i=2}else if(s===n.OP_PUSHDATA2){if(e+3>t.length)return null;r=t.readUInt16LE(e+1),i=3}else{if(e+5>t.length)return null;if(s!==n.OP_PUSHDATA4)throw new Error("Unexpected opcode");r=t.readUInt32LE(e+1),i=5}return{opcode:s,number:r,size:i}}}})),r.register("iDl8A",(function(t,e){t.exports=JSON.parse('{"OP_FALSE":0,"OP_0":0,"OP_PUSHDATA1":76,"OP_PUSHDATA2":77,"OP_PUSHDATA4":78,"OP_1NEGATE":79,"OP_RESERVED":80,"OP_TRUE":81,"OP_1":81,"OP_2":82,"OP_3":83,"OP_4":84,"OP_5":85,"OP_6":86,"OP_7":87,"OP_8":88,"OP_9":89,"OP_10":90,"OP_11":91,"OP_12":92,"OP_13":93,"OP_14":94,"OP_15":95,"OP_16":96,"OP_NOP":97,"OP_VER":98,"OP_IF":99,"OP_NOTIF":100,"OP_VERIF":101,"OP_VERNOTIF":102,"OP_ELSE":103,"OP_ENDIF":104,"OP_VERIFY":105,"OP_RETURN":106,"OP_TOALTSTACK":107,"OP_FROMALTSTACK":108,"OP_2DROP":109,"OP_2DUP":110,"OP_3DUP":111,"OP_2OVER":112,"OP_2ROT":113,"OP_2SWAP":114,"OP_IFDUP":115,"OP_DEPTH":116,"OP_DROP":117,"OP_DUP":118,"OP_NIP":119,"OP_OVER":120,"OP_PICK":121,"OP_ROLL":122,"OP_ROT":123,"OP_SWAP":124,"OP_TUCK":125,"OP_CAT":126,"OP_SUBSTR":127,"OP_LEFT":128,"OP_RIGHT":129,"OP_SIZE":130,"OP_INVERT":131,"OP_AND":132,"OP_OR":133,"OP_XOR":134,"OP_EQUAL":135,"OP_EQUALVERIFY":136,"OP_RESERVED1":137,"OP_RESERVED2":138,"OP_1ADD":139,"OP_1SUB":140,"OP_2MUL":141,"OP_2DIV":142,"OP_NEGATE":143,"OP_ABS":144,"OP_NOT":145,"OP_0NOTEQUAL":146,"OP_ADD":147,"OP_SUB":148,"OP_MUL":149,"OP_DIV":150,"OP_MOD":151,"OP_LSHIFT":152,"OP_RSHIFT":153,"OP_BOOLAND":154,"OP_BOOLOR":155,"OP_NUMEQUAL":156,"OP_NUMEQUALVERIFY":157,"OP_NUMNOTEQUAL":158,"OP_LESSTHAN":159,"OP_GREATERTHAN":160,"OP_LESSTHANOREQUAL":161,"OP_GREATERTHANOREQUAL":162,"OP_MIN":163,"OP_MAX":164,"OP_WITHIN":165,"OP_RIPEMD160":166,"OP_SHA1":167,"OP_SHA256":168,"OP_HASH160":169,"OP_HASH256":170,"OP_CODESEPARATOR":171,"OP_CHECKSIG":172,"OP_CHECKSIGVERIFY":173,"OP_CHECKMULTISIG":174,"OP_CHECKMULTISIGVERIFY":175,"OP_NOP1":176,"OP_NOP2":177,"OP_CHECKLOCKTIMEVERIFY":177,"OP_NOP3":178,"OP_CHECKSEQUENCEVERIFY":178,"OP_NOP4":179,"OP_NOP5":180,"OP_NOP6":181,"OP_NOP7":182,"OP_NOP8":183,"OP_NOP9":184,"OP_NOP10":185,"OP_PUBKEYHASH":253,"OP_PUBKEY":254,"OP_INVALIDOPCODE":255}')})),r.register("c9GkJ",(function(t,e){var n=r("iDl8A"),i={};for(var s in n){i[n[s]]=s}t.exports=i})),r.register("lVAUK",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0}),t.exports.prop=function(t,e,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get(){const t=r.call(this);return this[e]=t,t},set(t){Object.defineProperty(this,e,{configurable:!0,enumerable:!0,value:t,writable:!0})}})},t.exports.value=function(t){let e;return()=>(void 0!==e||(e=t()),e)}})),r.register("2LWcY",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("bwA6R"),i=r("gUdqP"),s=r("lVAUK");const o=i.OPS;var u=r("8DFnu"),a=r("noLW6");const h=o.OP_RESERVED;function p(t,e){return t.length===e.length&&t.every(((t,r)=>t.equals(e[r])))}t.exports.p2ms=function(t,e){if(!(t.input||t.output||t.pubkeys&&void 0!==t.m||t.signatures))throw new TypeError("Not enough data");function r(t){return i.isCanonicalScriptSignature(t)||void 0!==(e.allowIncomplete&&t===o.OP_0)}e=Object.assign({validate:!0},e||{}),u({network:u.maybe(u.Object),m:u.maybe(u.Number),n:u.maybe(u.Number),output:u.maybe(u.Buffer),pubkeys:u.maybe(u.arrayOf(a.isPoint)),signatures:u.maybe(u.arrayOf(r)),input:u.maybe(u.Buffer)},t);const c={network:t.network||n.bitcoin};let l=[],f=!1;function d(t){f||(f=!0,l=i.decompile(t),c.m=l[0]-h,c.n=l[l.length-2]-h,c.pubkeys=l.slice(1,-2))}if(s.prop(c,"output",(()=>{if(t.m&&c.n&&t.pubkeys)return i.compile([].concat(h+t.m,t.pubkeys,h+c.n,o.OP_CHECKMULTISIG))})),s.prop(c,"m",(()=>{if(c.output)return d(c.output),c.m})),s.prop(c,"n",(()=>{if(c.pubkeys)return c.pubkeys.length})),s.prop(c,"pubkeys",(()=>{if(t.output)return d(t.output),c.pubkeys})),s.prop(c,"signatures",(()=>{if(t.input)return i.decompile(t.input).slice(1)})),s.prop(c,"input",(()=>{if(t.signatures)return i.compile([o.OP_0].concat(t.signatures))})),s.prop(c,"witness",(()=>{if(c.input)return[]})),s.prop(c,"name",(()=>{if(c.m&&c.n)return`p2ms(${c.m} of ${c.n})`})),e.validate){if(t.output){if(d(t.output),!u.Number(l[0]))throw new TypeError("Output is invalid");if(!u.Number(l[l.length-2]))throw new TypeError("Output is invalid");if(l[l.length-1]!==o.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(c.m<=0||c.n>16||c.m>c.n||c.n!==l.length-3)throw new TypeError("Output is invalid");if(!c.pubkeys.every((t=>a.isPoint(t))))throw new TypeError("Output is invalid");if(void 0!==t.m&&t.m!==c.m)throw new TypeError("m mismatch");if(void 0!==t.n&&t.n!==c.n)throw new TypeError("n mismatch");if(t.pubkeys&&!p(t.pubkeys,c.pubkeys))throw new TypeError("Pubkeys mismatch")}if(t.pubkeys){if(void 0!==t.n&&t.n!==t.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(c.n=t.pubkeys.length,c.n<c.m)throw new TypeError("Pubkey count cannot be less than m")}if(t.signatures){if(t.signatures.length<c.m)throw new TypeError("Not enough signatures provided");if(t.signatures.length>c.m)throw new TypeError("Too many signatures provided")}if(t.input){if(t.input[0]!==o.OP_0)throw new TypeError("Input is invalid");if(0===c.signatures.length||!c.signatures.every(r))throw new TypeError("Input has invalid signature(s)");if(t.signatures&&!p(t.signatures,c.signatures))throw new TypeError("Signature mismatch");if(void 0!==t.m&&t.m!==t.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(c,t)}})),r.register("8d74P",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("bwA6R"),i=r("gUdqP"),s=r("lVAUK"),o=r("8DFnu");const u=i.OPS;var a=r("noLW6");t.exports.p2pk=function(t,e){if(!(t.input||t.output||t.pubkey||t.input||t.signature))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),o({network:o.maybe(o.Object),output:o.maybe(o.Buffer),pubkey:o.maybe(a.isPoint),signature:o.maybe(i.isCanonicalScriptSignature),input:o.maybe(o.Buffer)},t);const r=s.value((()=>i.decompile(t.input))),h={name:"p2pk",network:t.network||n.bitcoin};if(s.prop(h,"output",(()=>{if(t.pubkey)return i.compile([t.pubkey,u.OP_CHECKSIG])})),s.prop(h,"pubkey",(()=>{if(t.output)return t.output.slice(1,-1)})),s.prop(h,"signature",(()=>{if(t.input)return r()[0]})),s.prop(h,"input",(()=>{if(t.signature)return i.compile([t.signature])})),s.prop(h,"witness",(()=>{if(h.input)return[]})),e.validate){if(t.output){if(t.output[t.output.length-1]!==u.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!a.isPoint(h.pubkey))throw new TypeError("Output pubkey is invalid");if(t.pubkey&&!t.pubkey.equals(h.pubkey))throw new TypeError("Pubkey mismatch")}if(t.signature&&t.input&&!t.input.equals(h.input))throw new TypeError("Signature mismatch");if(t.input){if(1!==r().length)throw new TypeError("Input is invalid");if(!i.isCanonicalScriptSignature(h.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(h,t)}})),r.register("7EvnJ",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("adkaU"),s=r("bwA6R"),o=r("gUdqP"),u=r("lVAUK"),a=r("8DFnu");const h=o.OPS;var p=r("noLW6"),c=r("f8pp6");t.exports.p2pkh=function(t,e){if(!(t.address||t.hash||t.output||t.pubkey||t.input))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),a({network:a.maybe(a.Object),address:a.maybe(a.String),hash:a.maybe(a.BufferN(20)),output:a.maybe(a.BufferN(25)),pubkey:a.maybe(p.isPoint),signature:a.maybe(o.isCanonicalScriptSignature),input:a.maybe(a.Buffer)},t);const r=u.value((()=>{const e=c.decode(t.address);return{version:e.readUInt8(0),hash:e.slice(1)}})),l=u.value((()=>o.decompile(t.input))),f=t.network||s.bitcoin,d={name:"p2pkh",network:f};if(u.prop(d,"address",(()=>{if(!d.hash)return;const t=n.allocUnsafe(21);return t.writeUInt8(f.pubKeyHash,0),d.hash.copy(t,1),c.encode(t)})),u.prop(d,"hash",(()=>t.output?t.output.slice(3,23):t.address?r().hash:t.pubkey||d.pubkey?i.hash160(t.pubkey||d.pubkey):void 0)),u.prop(d,"output",(()=>{if(d.hash)return o.compile([h.OP_DUP,h.OP_HASH160,d.hash,h.OP_EQUALVERIFY,h.OP_CHECKSIG])})),u.prop(d,"pubkey",(()=>{if(t.input)return l()[1]})),u.prop(d,"signature",(()=>{if(t.input)return l()[0]})),u.prop(d,"input",(()=>{if(t.pubkey&&t.signature)return o.compile([t.signature,t.pubkey])})),u.prop(d,"witness",(()=>{if(d.input)return[]})),e.validate){let e=n.from([]);if(t.address){if(r().version!==f.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(20!==r().hash.length)throw new TypeError("Invalid address");e=r().hash}if(t.hash){if(e.length>0&&!e.equals(t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(25!==t.output.length||t.output[0]!==h.OP_DUP||t.output[1]!==h.OP_HASH160||20!==t.output[2]||t.output[23]!==h.OP_EQUALVERIFY||t.output[24]!==h.OP_CHECKSIG)throw new TypeError("Output is invalid");const r=t.output.slice(3,23);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}if(t.pubkey){const r=i.hash160(t.pubkey);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}if(t.input){const r=l();if(2!==r.length)throw new TypeError("Input is invalid");if(!o.isCanonicalScriptSignature(r[0]))throw new TypeError("Input has invalid signature");if(!p.isPoint(r[1]))throw new TypeError("Input has invalid pubkey");if(t.signature&&!t.signature.equals(r[0]))throw new TypeError("Signature mismatch");if(t.pubkey&&!t.pubkey.equals(r[1]))throw new TypeError("Pubkey mismatch");const n=i.hash160(r[1]);if(e.length>0&&!e.equals(n))throw new TypeError("Hash mismatch")}}return Object.assign(d,t)}})),r.register("adkaU",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("9VkSs");function i(t){try{return n("rmd160").update(t).digest()}catch(e){return n("ripemd160").update(t).digest()}}function s(t){return n("sha256").update(t).digest()}t.exports.ripemd160=i,t.exports.sha1=function(t){return n("sha1").update(t).digest()},t.exports.sha256=s,t.exports.hash160=function(t){return i(s(t))},t.exports.hash256=function(t){return s(s(t))}})),r.register("elhTQ",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("adkaU"),s=r("bwA6R"),o=r("gUdqP"),u=r("lVAUK"),a=r("8DFnu");const h=o.OPS;var p=r("f8pp6");t.exports.p2sh=function(t,e){if(!(t.address||t.hash||t.output||t.redeem||t.input))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),a({network:a.maybe(a.Object),address:a.maybe(a.String),hash:a.maybe(a.BufferN(20)),output:a.maybe(a.BufferN(23)),redeem:a.maybe({network:a.maybe(a.Object),output:a.maybe(a.Buffer),input:a.maybe(a.Buffer),witness:a.maybe(a.arrayOf(a.Buffer))}),input:a.maybe(a.Buffer),witness:a.maybe(a.arrayOf(a.Buffer))},t);let r=t.network;r||(r=t.redeem&&t.redeem.network||s.bitcoin);const c={network:r},l=u.value((()=>{const e=p.decode(t.address);return{version:e.readUInt8(0),hash:e.slice(1)}})),f=u.value((()=>o.decompile(t.input))),d=u.value((()=>{const e=f();return{network:r,output:e[e.length-1],input:o.compile(e.slice(0,-1)),witness:t.witness||[]}}));if(u.prop(c,"address",(()=>{if(!c.hash)return;const t=n.allocUnsafe(21);return t.writeUInt8(c.network.scriptHash,0),c.hash.copy(t,1),p.encode(t)})),u.prop(c,"hash",(()=>t.output?t.output.slice(2,22):t.address?l().hash:c.redeem&&c.redeem.output?i.hash160(c.redeem.output):void 0)),u.prop(c,"output",(()=>{if(c.hash)return o.compile([h.OP_HASH160,c.hash,h.OP_EQUAL])})),u.prop(c,"redeem",(()=>{if(t.input)return d()})),u.prop(c,"input",(()=>{if(t.redeem&&t.redeem.input&&t.redeem.output)return o.compile([].concat(o.decompile(t.redeem.input),t.redeem.output))})),u.prop(c,"witness",(()=>c.redeem&&c.redeem.witness?c.redeem.witness:c.input?[]:void 0)),u.prop(c,"name",(()=>{const t=["p2sh"];return void 0!==c.redeem&&t.push(c.redeem.name),t.join("-")})),e.validate){let e=n.from([]);if(t.address){if(l().version!==r.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(20!==l().hash.length)throw new TypeError("Invalid address");e=l().hash}if(t.hash){if(e.length>0&&!e.equals(t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(23!==t.output.length||t.output[0]!==h.OP_HASH160||20!==t.output[1]||t.output[22]!==h.OP_EQUAL)throw new TypeError("Output is invalid");const r=t.output.slice(2,22);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}const s=t=>{if(t.output){const r=o.decompile(t.output);if(!r||r.length<1)throw new TypeError("Redeem.output too short");const n=i.hash160(t.output);if(e.length>0&&!e.equals(n))throw new TypeError("Hash mismatch");e=n}if(t.input){const e=t.input.length>0,r=t.witness&&t.witness.length>0;if(!e&&!r)throw new TypeError("Empty input");if(e&&r)throw new TypeError("Input and witness provided");if(e){const e=o.decompile(t.input);if(!o.isPushOnly(e))throw new TypeError("Non push-only scriptSig")}}};if(t.input){const t=f();if(!t||t.length<1)throw new TypeError("Input too short");if(!n.isBuffer(d().output))throw new TypeError("Input is invalid");s(d())}if(t.redeem){if(t.redeem.network&&t.redeem.network!==r)throw new TypeError("Network mismatch");if(t.input){const e=d();if(t.redeem.output&&!t.redeem.output.equals(e.output))throw new TypeError("Redeem.output mismatch");if(t.redeem.input&&!t.redeem.input.equals(e.input))throw new TypeError("Redeem.input mismatch")}s(t.redeem)}if(t.witness&&t.redeem&&t.redeem.witness&&!function(t,e){return t.length===e.length&&t.every(((t,r)=>t.equals(e[r])))}(t.redeem.witness,t.witness))throw new TypeError("Witness and redeem.witness mismatch")}return Object.assign(c,t)}})),r.register("2RjGy",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("adkaU"),s=r("bwA6R"),o=r("gUdqP"),u=r("lVAUK"),a=r("8DFnu");const h=o.OPS;var p=r("noLW6"),c=r("lNNEE");const l=n.alloc(0);t.exports.p2wpkh=function(t,e){if(!(t.address||t.hash||t.output||t.pubkey||t.witness))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),a({address:a.maybe(a.String),hash:a.maybe(a.BufferN(20)),input:a.maybe(a.BufferN(0)),network:a.maybe(a.Object),output:a.maybe(a.BufferN(22)),pubkey:a.maybe(p.isPoint),signature:a.maybe(o.isCanonicalScriptSignature),witness:a.maybe(a.arrayOf(a.Buffer))},t);const r=u.value((()=>{const e=c.decode(t.address),r=e.words.shift(),i=c.fromWords(e.words);return{version:r,prefix:e.prefix,data:n.from(i)}})),f=t.network||s.bitcoin,d={name:"p2wpkh",network:f};if(u.prop(d,"address",(()=>{if(!d.hash)return;const t=c.toWords(d.hash);return t.unshift(0),c.encode(f.bech32,t)})),u.prop(d,"hash",(()=>t.output?t.output.slice(2,22):t.address?r().data:t.pubkey||d.pubkey?i.hash160(t.pubkey||d.pubkey):void 0)),u.prop(d,"output",(()=>{if(d.hash)return o.compile([h.OP_0,d.hash])})),u.prop(d,"pubkey",(()=>t.pubkey?t.pubkey:t.witness?t.witness[1]:void 0)),u.prop(d,"signature",(()=>{if(t.witness)return t.witness[0]})),u.prop(d,"input",(()=>{if(d.witness)return l})),u.prop(d,"witness",(()=>{if(t.pubkey&&t.signature)return[t.signature,t.pubkey]})),e.validate){let e=n.from([]);if(t.address){if(f&&f.bech32!==r().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(20!==r().data.length)throw new TypeError("Invalid address data");e=r().data}if(t.hash){if(e.length>0&&!e.equals(t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(22!==t.output.length||t.output[0]!==h.OP_0||20!==t.output[1])throw new TypeError("Output is invalid");if(e.length>0&&!e.equals(t.output.slice(2)))throw new TypeError("Hash mismatch");e=t.output.slice(2)}if(t.pubkey){const r=i.hash160(t.pubkey);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");if(e=r,!p.isPoint(t.pubkey)||33!==t.pubkey.length)throw new TypeError("Invalid pubkey for p2wpkh")}if(t.witness){if(2!==t.witness.length)throw new TypeError("Witness is invalid");if(!o.isCanonicalScriptSignature(t.witness[0]))throw new TypeError("Witness has invalid signature");if(!p.isPoint(t.witness[1])||33!==t.witness[1].length)throw new TypeError("Witness has invalid pubkey");if(t.signature&&!t.signature.equals(t.witness[0]))throw new TypeError("Signature mismatch");if(t.pubkey&&!t.pubkey.equals(t.witness[1]))throw new TypeError("Pubkey mismatch");const r=i.hash160(t.witness[1]);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch")}}return Object.assign(d,t)}})),r.register("jRD9w",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("adkaU"),s=r("bwA6R"),o=r("gUdqP"),u=r("lVAUK"),a=r("8DFnu");const h=o.OPS;var p=r("noLW6"),c=r("lNNEE");const l=n.alloc(0);function f(t){return!(!n.isBuffer(t)||65!==t.length||4!==t[0]||!p.isPoint(t))}t.exports.p2wsh=function(t,e){if(!(t.address||t.hash||t.output||t.redeem||t.witness))throw new TypeError("Not enough data");e=Object.assign({validate:!0},e||{}),a({network:a.maybe(a.Object),address:a.maybe(a.String),hash:a.maybe(a.BufferN(32)),output:a.maybe(a.BufferN(34)),redeem:a.maybe({input:a.maybe(a.Buffer),network:a.maybe(a.Object),output:a.maybe(a.Buffer),witness:a.maybe(a.arrayOf(a.Buffer))}),input:a.maybe(a.BufferN(0)),witness:a.maybe(a.arrayOf(a.Buffer))},t);const r=u.value((()=>{const e=c.decode(t.address),r=e.words.shift(),i=c.fromWords(e.words);return{version:r,prefix:e.prefix,data:n.from(i)}})),p=u.value((()=>o.decompile(t.redeem.input)));let d=t.network;d||(d=t.redeem&&t.redeem.network||s.bitcoin);const g={network:d};if(u.prop(g,"address",(()=>{if(!g.hash)return;const t=c.toWords(g.hash);return t.unshift(0),c.encode(d.bech32,t)})),u.prop(g,"hash",(()=>t.output?t.output.slice(2):t.address?r().data:g.redeem&&g.redeem.output?i.sha256(g.redeem.output):void 0)),u.prop(g,"output",(()=>{if(g.hash)return o.compile([h.OP_0,g.hash])})),u.prop(g,"redeem",(()=>{if(t.witness)return{output:t.witness[t.witness.length-1],input:l,witness:t.witness.slice(0,-1)}})),u.prop(g,"input",(()=>{if(g.witness)return l})),u.prop(g,"witness",(()=>{if(t.redeem&&t.redeem.input&&t.redeem.input.length>0&&t.redeem.output&&t.redeem.output.length>0){const e=o.toStack(p());return g.redeem=Object.assign({witness:e},t.redeem),g.redeem.input=l,[].concat(e,t.redeem.output)}if(t.redeem&&t.redeem.output&&t.redeem.witness)return[].concat(t.redeem.witness,t.redeem.output)})),u.prop(g,"name",(()=>{const t=["p2wsh"];return void 0!==g.redeem&&t.push(g.redeem.name),t.join("-")})),e.validate){let e=n.from([]);if(t.address){if(r().prefix!==d.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(0!==r().version)throw new TypeError("Invalid address version");if(32!==r().data.length)throw new TypeError("Invalid address data");e=r().data}if(t.hash){if(e.length>0&&!e.equals(t.hash))throw new TypeError("Hash mismatch");e=t.hash}if(t.output){if(34!==t.output.length||t.output[0]!==h.OP_0||32!==t.output[1])throw new TypeError("Output is invalid");const r=t.output.slice(2);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}if(t.redeem){if(t.redeem.network&&t.redeem.network!==d)throw new TypeError("Network mismatch");if(t.redeem.input&&t.redeem.input.length>0&&t.redeem.witness&&t.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(t.redeem.output){if(0===o.decompile(t.redeem.output).length)throw new TypeError("Redeem.output is invalid");const r=i.sha256(t.redeem.output);if(e.length>0&&!e.equals(r))throw new TypeError("Hash mismatch");e=r}if(t.redeem.input&&!o.isPushOnly(p()))throw new TypeError("Non push-only scriptSig");if(t.witness&&t.redeem.witness&&!function(t,e){return t.length===e.length&&t.every(((t,r)=>t.equals(e[r])))}(t.witness,t.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(t.redeem.input&&p().some(f)||t.redeem.output&&(o.decompile(t.redeem.output)||[]).some(f))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(t.witness&&t.witness.length>0){const e=t.witness[t.witness.length-1];if(t.redeem&&t.redeem.output&&!t.redeem.output.equals(e))throw new TypeError("Witness and redeem.output mismatch");if(t.witness.some(f)||(o.decompile(e)||[]).some(f))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(g,t)}})),r.register("7W5Bi",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("bwA6R"),s=r("hJyAm"),o=r("noLW6"),u=r("5Kr9A"),a=r("8DFnu"),h=r("2kT0C");const p=a.maybe(a.compile({compressed:s.maybe(s.Boolean),network:s.maybe(s.Network)}));class c{get privateKey(){return this.__D}get publicKey(){return this.__Q||(this.__Q=o.pointFromScalar(this.__D,this.compressed)),this.__Q}toWIF(){if(!this.__D)throw new Error("Missing private key");return h.encode(this.network.wif,this.__D,this.compressed)}sign(t,e){if(!this.__D)throw new Error("Missing private key");if(void 0===e&&(e=this.lowR),!1===e)return o.sign(t,this.__D);{let e=o.sign(t,this.__D);const r=n.alloc(32,0);let i=0;for(;e[0]>127;)i++,r.writeUIntLE(i,0,6),e=o.signWithEntropy(t,this.__D,r);return e}}verify(t,e){return o.verify(t,this.publicKey,e)}constructor(t,e,r){this.__D=t,this.__Q=e,this.lowR=!1,void 0===r&&(r={}),this.compressed=void 0===r.compressed||r.compressed,this.network=r.network||i.bitcoin,void 0!==e&&(this.__Q=o.pointCompress(e,this.compressed))}}function l(t,e){if(a(s.Buffer256bit,t),!o.isPrivate(t))throw new TypeError("Private key not in range [1, n)");return a(p,e),new c(t,void 0,e)}t.exports.fromPrivateKey=l,t.exports.fromPublicKey=function(t,e){return a(o.isPoint,t),a(p,e),new c(void 0,t,e)},t.exports.fromWIF=function(t,e){const r=h.decode(t),n=r.version;if(s.Array(e)){if(!(e=e.filter((t=>n===t.wif)).pop()))throw new Error("Unknown network version")}else if(e=e||i.bitcoin,n!==e.wif)throw new Error("Invalid network version");return l(r.privateKey,{compressed:r.compressed,network:e})},t.exports.makeRandom=function(t){a(p,t),void 0===t&&(t={});const e=t.rng||u;let r;do{r=e(32),a(s.Buffer256bit,r)}while(!o.isPrivate(r));return l(r,t)}})),r.register("dTm3q",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("jsMFQ"),s=r("adkaU"),o=r("4PM20"),u=r("hJyAm"),a=r("8pzK3"),h=r("8DFnu"),p=r("jGIJA");const c=new TypeError("Cannot compute merkle root for zero transactions"),l=new TypeError("Cannot compute witness commit for non-segwit block");class f{static fromBuffer(t){if(t.length<80)throw new Error("Buffer too small (< 80 bytes)");const e=new i.BufferReader(t),r=new f;if(r.version=e.readInt32(),r.prevHash=e.readSlice(32),r.merkleRoot=e.readSlice(32),r.timestamp=e.readUInt32(),r.bits=e.readUInt32(),r.nonce=e.readUInt32(),80===t.length)return r;const n=()=>{const t=o.Transaction.fromBuffer(e.buffer.slice(e.offset),!0);return e.offset+=t.byteLength(),t},s=e.readVarInt();r.transactions=[];for(let t=0;t<s;++t){const t=n();r.transactions.push(t)}const u=r.getWitnessCommit();return u&&(r.witnessCommit=u),r}static fromHex(t){return f.fromBuffer(n.from(t,"hex"))}static calculateTarget(t){const e=((4278190080&t)>>24)-3,r=8388607&t,i=n.alloc(32,0);return i.writeUIntBE(r,29-e,3),i}static calculateMerkleRoot(t,e){if(h([{getHash:u.Function}],t),0===t.length)throw c;if(e&&!d(t))throw l;const r=t.map((t=>t.getHash(e))),i=a(r,s.hash256);return e?s.hash256(n.concat([i,t[0].ins[0].witness[0]])):i}getWitnessCommit(){if(!d(this.transactions))return null;const t=this.transactions[0].outs.filter((t=>t.script.slice(0,6).equals(n.from("6a24aa21a9ed","hex")))).map((t=>t.script.slice(6,38)));if(0===t.length)return null;const e=t[t.length-1];return e instanceof n&&32===e.length?e:null}hasWitnessCommit(){return this.witnessCommit instanceof n&&32===this.witnessCommit.length||null!==this.getWitnessCommit()}hasWitness(){return(t=this.transactions)instanceof Array&&t.some((t=>"object"==typeof t&&t.ins instanceof Array&&t.ins.some((t=>"object"==typeof t&&t.witness instanceof Array&&t.witness.length>0))));var t}weight(){return 3*this.byteLength(!1,!1)+this.byteLength(!1,!0)}byteLength(t,e=!0){return t||!this.transactions?80:80+p.encodingLength(this.transactions.length)+this.transactions.reduce(((t,r)=>t+r.byteLength(e)),0)}getHash(){return s.hash256(this.toBuffer(!0))}getId(){return i.reverseBuffer(this.getHash()).toString("hex")}getUTCDate(){const t=new Date(0);return t.setUTCSeconds(this.timestamp),t}toBuffer(t){const e=n.allocUnsafe(this.byteLength(t)),r=new i.BufferWriter(e);return r.writeInt32(this.version),r.writeSlice(this.prevHash),r.writeSlice(this.merkleRoot),r.writeUInt32(this.timestamp),r.writeUInt32(this.bits),r.writeUInt32(this.nonce),t||!this.transactions||(p.encode(this.transactions.length,e,r.offset),r.offset+=p.encode.bytes,this.transactions.forEach((t=>{const n=t.byteLength();t.toBuffer(e,r.offset),r.offset+=n}))),e}toHex(t){return this.toBuffer(t).toString("hex")}checkTxRoots(){const t=this.hasWitnessCommit();return!(!t&&this.hasWitness())&&(this.__checkMerkleRoot()&&(!t||this.__checkWitnessCommit()))}checkProofOfWork(){const t=i.reverseBuffer(this.getHash()),e=f.calculateTarget(this.bits);return t.compare(e)<=0}__checkMerkleRoot(){if(!this.transactions)throw c;const t=f.calculateMerkleRoot(this.transactions);return 0===this.merkleRoot.compare(t)}__checkWitnessCommit(){if(!this.transactions)throw c;if(!this.hasWitnessCommit())throw l;const t=f.calculateMerkleRoot(this.transactions,!0);return 0===this.witnessCommit.compare(t)}constructor(){this.version=1,this.prevHash=void 0,this.merkleRoot=void 0,this.timestamp=0,this.witnessCommit=void 0,this.bits=0,this.nonce=0,this.transactions=void 0}}function d(t){return t instanceof Array&&t[0]&&t[0].ins&&t[0].ins instanceof Array&&t[0].ins[0]&&t[0].ins[0].witness&&t[0].ins[0].witness instanceof Array&&t[0].ins[0].witness.length>0}t.exports.Block=f})),r.register("jsMFQ",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("hJyAm"),s=r("8DFnu"),o=r("jGIJA");function u(t,e){if("number"!=typeof t)throw new Error("cannot write a non-number as a number");if(t<0)throw new Error("specified a negative value for writing an unsigned value");if(t>e)throw new Error("RangeError: value out of range");if(Math.floor(t)!==t)throw new Error("value has a fractional component")}function a(t,e){const r=t.readUInt32LE(e);let n=t.readUInt32LE(e+4);return n*=4294967296,u(n+r,9007199254740991),n+r}function h(t,e,r){return u(e,9007199254740991),t.writeInt32LE(-1&e,r),t.writeUInt32LE(Math.floor(e/4294967296),r+4),r+8}t.exports.readUInt64LE=a,t.exports.writeUInt64LE=h,t.exports.reverseBuffer=function(t){if(t.length<1)return t;let e=t.length-1,r=0;for(let n=0;n<t.length/2;n++)r=t[n],t[n]=t[e],t[e]=r,e--;return t},t.exports.cloneBuffer=function(t){const e=n.allocUnsafe(t.length);return t.copy(e),e};t.exports.BufferWriter=class{writeUInt8(t){this.offset=this.buffer.writeUInt8(t,this.offset)}writeInt32(t){this.offset=this.buffer.writeInt32LE(t,this.offset)}writeUInt32(t){this.offset=this.buffer.writeUInt32LE(t,this.offset)}writeUInt64(t){this.offset=h(this.buffer,t,this.offset)}writeVarInt(t){o.encode(t,this.buffer,this.offset),this.offset+=o.encode.bytes}writeSlice(t){if(this.buffer.length<this.offset+t.length)throw new Error("Cannot write slice out of bounds");this.offset+=t.copy(this.buffer,this.offset)}writeVarSlice(t){this.writeVarInt(t.length),this.writeSlice(t)}writeVector(t){this.writeVarInt(t.length),t.forEach((t=>this.writeVarSlice(t)))}constructor(t,e=0){this.buffer=t,this.offset=e,s(i.tuple(i.Buffer,i.UInt32),[t,e])}};t.exports.BufferReader=class{readUInt8(){const t=this.buffer.readUInt8(this.offset);return this.offset++,t}readInt32(){const t=this.buffer.readInt32LE(this.offset);return this.offset+=4,t}readUInt32(){const t=this.buffer.readUInt32LE(this.offset);return this.offset+=4,t}readUInt64(){const t=a(this.buffer,this.offset);return this.offset+=8,t}readVarInt(){const t=o.decode(this.buffer,this.offset);return this.offset+=o.decode.bytes,t}readSlice(t){if(this.buffer.length<this.offset+t)throw new Error("Cannot read slice out of bounds");const e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const t=this.readVarInt(),e=[];for(let r=0;r<t;r++)e.push(this.readVarSlice());return e}constructor(t,e=0){this.buffer=t,this.offset=e,s(i.tuple(i.Buffer,i.UInt32),[t,e])}}})),r.register("4PM20",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("jsMFQ"),s=r("adkaU"),o=r("gUdqP"),u=(o=r("gUdqP"),r("hJyAm")),a=r("8DFnu"),h=r("jGIJA");function p(t){const e=t.length;return h.encodingLength(e)+e}const c=n.allocUnsafe(0),l=[],f=n.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),d=n.from("0000000000000000000000000000000000000000000000000000000000000001","hex"),g=n.from("ffffffffffffffff","hex"),m={script:c,valueBuffer:g};class w{static fromBuffer(t,e){const r=new i.BufferReader(t),n=new w;n.version=r.readInt32();const s=r.readUInt8(),o=r.readUInt8();let u=!1;s===w.ADVANCED_TRANSACTION_MARKER&&o===w.ADVANCED_TRANSACTION_FLAG?u=!0:r.offset-=2;const a=r.readVarInt();for(let t=0;t<a;++t)n.ins.push({hash:r.readSlice(32),index:r.readUInt32(),script:r.readVarSlice(),sequence:r.readUInt32(),witness:l});const h=r.readVarInt();for(let t=0;t<h;++t)n.outs.push({value:r.readUInt64(),script:r.readVarSlice()});if(u){for(let t=0;t<a;++t)n.ins[t].witness=r.readVector();if(!n.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(n.locktime=r.readUInt32(),e)return n;if(r.offset!==t.length)throw new Error("Transaction has unexpected data");return n}static fromHex(t){return w.fromBuffer(n.from(t,"hex"),!1)}static isCoinbaseHash(t){a(u.Hash256bit,t);for(let e=0;e<32;++e)if(0!==t[e])return!1;return!0}isCoinbase(){return 1===this.ins.length&&w.isCoinbaseHash(this.ins[0].hash)}addInput(t,e,r,n){return a(u.tuple(u.Hash256bit,u.UInt32,u.maybe(u.UInt32),u.maybe(u.Buffer)),arguments),u.Null(r)&&(r=w.DEFAULT_SEQUENCE),this.ins.push({hash:t,index:e,script:n||c,sequence:r,witness:l})-1}addOutput(t,e){return a(u.tuple(u.Buffer,u.Satoshi),arguments),this.outs.push({script:t,value:e})-1}hasWitnesses(){return this.ins.some((t=>0!==t.witness.length))}weight(){return 3*this.byteLength(!1)+this.byteLength(!0)}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(t=!0){const e=t&&this.hasWitnesses();return(e?10:8)+h.encodingLength(this.ins.length)+h.encodingLength(this.outs.length)+this.ins.reduce(((t,e)=>t+40+p(e.script)),0)+this.outs.reduce(((t,e)=>t+8+p(e.script)),0)+(e?this.ins.reduce(((t,e)=>t+function(t){const e=t.length;return h.encodingLength(e)+t.reduce(((t,e)=>t+p(e)),0)}(e.witness)),0):0)}clone(){const t=new w;return t.version=this.version,t.locktime=this.locktime,t.ins=this.ins.map((t=>({hash:t.hash,index:t.index,script:t.script,sequence:t.sequence,witness:t.witness}))),t.outs=this.outs.map((t=>({script:t.script,value:t.value}))),t}hashForSignature(t,e,r){if(a(u.tuple(u.UInt32,u.Buffer,u.Number),arguments),t>=this.ins.length)return d;const i=o.compile(o.decompile(e).filter((t=>t!==o.OPS.OP_CODESEPARATOR))),h=this.clone();if((31&r)===w.SIGHASH_NONE)h.outs=[],h.ins.forEach(((e,r)=>{r!==t&&(e.sequence=0)}));else if((31&r)===w.SIGHASH_SINGLE){if(t>=this.outs.length)return d;h.outs.length=t+1;for(let e=0;e<t;e++)h.outs[e]=m;h.ins.forEach(((e,r)=>{r!==t&&(e.sequence=0)}))}r&w.SIGHASH_ANYONECANPAY?(h.ins=[h.ins[t]],h.ins[0].script=i):(h.ins.forEach((t=>{t.script=c})),h.ins[t].script=i);const p=n.allocUnsafe(h.byteLength(!1)+4);return p.writeInt32LE(r,p.length-4),h.__toBuffer(p,0,!1),s.hash256(p)}hashForWitnessV0(t,e,r,o){a(u.tuple(u.UInt32,u.Buffer,u.Satoshi,u.UInt32),arguments);let h,c=n.from([]),l=f,d=f,g=f;if(o&w.SIGHASH_ANYONECANPAY||(c=n.allocUnsafe(36*this.ins.length),h=new i.BufferWriter(c,0),this.ins.forEach((t=>{h.writeSlice(t.hash),h.writeUInt32(t.index)})),d=s.hash256(c)),o&w.SIGHASH_ANYONECANPAY||(31&o)===w.SIGHASH_SINGLE||(31&o)===w.SIGHASH_NONE||(c=n.allocUnsafe(4*this.ins.length),h=new i.BufferWriter(c,0),this.ins.forEach((t=>{h.writeUInt32(t.sequence)})),g=s.hash256(c)),(31&o)!==w.SIGHASH_SINGLE&&(31&o)!==w.SIGHASH_NONE){const t=this.outs.reduce(((t,e)=>t+8+p(e.script)),0);c=n.allocUnsafe(t),h=new i.BufferWriter(c,0),this.outs.forEach((t=>{h.writeUInt64(t.value),h.writeVarSlice(t.script)})),l=s.hash256(c)}else if((31&o)===w.SIGHASH_SINGLE&&t<this.outs.length){const e=this.outs[t];c=n.allocUnsafe(8+p(e.script)),h=new i.BufferWriter(c,0),h.writeUInt64(e.value),h.writeVarSlice(e.script),l=s.hash256(c)}c=n.allocUnsafe(156+p(e)),h=new i.BufferWriter(c,0);const m=this.ins[t];return h.writeUInt32(this.version),h.writeSlice(d),h.writeSlice(g),h.writeSlice(m.hash),h.writeUInt32(m.index),h.writeVarSlice(e),h.writeUInt64(r),h.writeUInt32(m.sequence),h.writeSlice(l),h.writeUInt32(this.locktime),h.writeUInt32(o),s.hash256(c)}getHash(t){return t&&this.isCoinbase()?n.alloc(32,0):s.hash256(this.__toBuffer(void 0,void 0,t))}getId(){return i.reverseBuffer(this.getHash(!1)).toString("hex")}toBuffer(t,e){return this.__toBuffer(t,e,!0)}toHex(){return this.toBuffer(void 0,void 0).toString("hex")}setInputScript(t,e){a(u.tuple(u.Number,u.Buffer),arguments),this.ins[t].script=e}setWitness(t,e){a(u.tuple(u.Number,[u.Buffer]),arguments),this.ins[t].witness=e}__toBuffer(t,e,r=!1){t||(t=n.allocUnsafe(this.byteLength(r)));const s=new i.BufferWriter(t,e||0);s.writeInt32(this.version);const o=r&&this.hasWitnesses();return o&&(s.writeUInt8(w.ADVANCED_TRANSACTION_MARKER),s.writeUInt8(w.ADVANCED_TRANSACTION_FLAG)),s.writeVarInt(this.ins.length),this.ins.forEach((t=>{s.writeSlice(t.hash),s.writeUInt32(t.index),s.writeVarSlice(t.script),s.writeUInt32(t.sequence)})),s.writeVarInt(this.outs.length),this.outs.forEach((t=>{void 0!==t.value?s.writeUInt64(t.value):s.writeSlice(t.valueBuffer),s.writeVarSlice(t.script)})),o&&this.ins.forEach((t=>{s.writeVector(t.witness)})),s.writeUInt32(this.locktime),void 0!==e?t.slice(e,s.offset):t}constructor(){this.version=1,this.locktime=0,this.ins=[],this.outs=[]}}w.DEFAULT_SEQUENCE=4294967295,w.SIGHASH_ALL=1,w.SIGHASH_NONE=2,w.SIGHASH_SINGLE=3,w.SIGHASH_ANYONECANPAY=128,w.ADVANCED_TRANSACTION_MARKER=0,w.ADVANCED_TRANSACTION_FLAG=1,t.exports.Transaction=w})),r.register("8pzK3",(function(t,e){var n=r("6rT8n").Buffer;t.exports=function(t,e){if(!Array.isArray(t))throw TypeError("Expected values Array");if("function"!=typeof e)throw TypeError("Expected digest Function");for(var r=t.length,i=t.concat();r>1;){for(var s=0,o=0;o<r;o+=2,++s){var u=i[o],a=o+1===r?u:i[o+1],h=n.concat([u,a]);i[s]=e(h)}r=s}return i[0]}})),r.register("6JjQf",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("2UJUd"),s=r("jpkw1"),o=r("h5rlH"),u=r("hJRqN"),a=r("jsMFQ"),h=r("adkaU"),p=r("7W5Bi"),c=r("bwA6R"),l=r("4OftM"),f=r("gUdqP"),d=r("4PM20");const g={network:c.bitcoin,maximumFeeRate:5e3};class m{static fromBase64(t,e={}){const r=n.from(t,"base64");return this.fromBuffer(r,e)}static fromHex(t,e={}){const r=n.from(t,"hex");return this.fromBuffer(r,e)}static fromBuffer(t,e={}){const r=i.Psbt.fromBuffer(t,w),n=new m(e,r);var s,o;return s=n.__CACHE.__TX,o=n.__CACHE,s.ins.forEach((t=>{N(o,t)})),n}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(t){this.setVersion(t)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(t){this.setLocktime(t)}get txInputs(){return this.__CACHE.__TX.ins.map((t=>({hash:a.cloneBuffer(t.hash),index:t.index,sequence:t.sequence})))}get txOutputs(){return this.__CACHE.__TX.outs.map((t=>{let e;try{e=u.fromOutputScript(t.script,this.opts.network)}catch(t){}return{script:a.cloneBuffer(t.script),value:t.value,address:e}}))}combine(...t){return this.data.combine(...t.map((t=>t.data))),this}clone(){const t=m.fromBuffer(this.data.toBuffer());return t.opts=JSON.parse(JSON.stringify(this.opts)),t}setMaximumFeeRate(t){k(t),this.opts.maximumFeeRate=t}setVersion(t){k(t),A(this.data.inputs,"setVersion");const e=this.__CACHE;return e.__TX.version=t,e.__EXTRACTED_TX=void 0,this}setLocktime(t){k(t),A(this.data.inputs,"setLocktime");const e=this.__CACHE;return e.__TX.locktime=t,e.__EXTRACTED_TX=void 0,this}setInputSequence(t,e){k(e),A(this.data.inputs,"setInputSequence");const r=this.__CACHE;if(r.__TX.ins.length<=t)throw new Error("Input index too high");return r.__TX.ins[t].sequence=e,r.__EXTRACTED_TX=void 0,this}addInputs(t){return t.forEach((t=>this.addInput(t))),this}addInput(t){if(arguments.length>1||!t||void 0===t.hash||void 0===t.index)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");A(this.data.inputs,"addInput"),t.witnessScript&&Y(t.witnessScript);const e=this.__CACHE;this.data.addInput(t);N(e,e.__TX.ins[e.__TX.ins.length-1]);const r=this.data.inputs.length-1,n=this.data.inputs[r];return n.nonWitnessUtxo&&V(this.__CACHE,n,r),e.__FEE=void 0,e.__FEE_RATE=void 0,e.__EXTRACTED_TX=void 0,this}addOutputs(t){return t.forEach((t=>this.addOutput(t))),this}addOutput(t){if(arguments.length>1||!t||void 0===t.value||void 0===t.address&&void 0===t.script)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");A(this.data.inputs,"addOutput");const{address:e}=t;if("string"==typeof e){const{network:r}=this.opts,n=u.toOutputScript(e,r);t=Object.assign(t,{script:n})}const r=this.__CACHE;return this.data.addOutput(t),r.__FEE=void 0,r.__FEE_RATE=void 0,r.__EXTRACTED_TX=void 0,this}extractTransaction(t){if(!this.data.inputs.every(E))throw new Error("Not finalized");const e=this.__CACHE;if(t||function(t,e,r){const n=e.__FEE_RATE||t.getFeeRate(),i=e.__EXTRACTED_TX.virtualSize(),s=n*i;if(n>=r.maximumFeeRate)throw new Error(`Warning: You are paying around ${(s/1e8).toFixed(8)} in fees, which is ${n} satoshi per byte for a transaction with a VSize of ${i} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}(this,e,this.opts),e.__EXTRACTED_TX)return e.__EXTRACTED_TX;const r=e.__TX.clone();return G(this.data.inputs,r,e,!0),r}getFeeRate(){return C("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return C("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return o.checkForInput(this.data.inputs,0),Z(this.data.inputs.length).forEach((t=>this.finalizeInput(t))),this}finalizeInput(t,e=L){const r=o.checkForInput(this.data.inputs,t),{script:n,isP2SH:i,isP2WSH:s,isSegwit:u}=function(t,e,r){const n=r.__TX,i={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(i.isP2SH=!!e.redeemScript,i.isP2WSH=!!e.witnessScript,e.witnessScript)i.script=e.witnessScript;else if(e.redeemScript)i.script=e.redeemScript;else if(e.nonWitnessUtxo){const s=j(r,e,t),o=n.ins[t].index;i.script=s.outs[o].script}else e.witnessUtxo&&(i.script=e.witnessUtxo.script);(e.witnessScript||P(i.script))&&(i.isSegwit=!0);return i}(t,r,this.__CACHE);if(!n)throw new Error(`No script found for input #${t}`);!function(t){if(!t.sighashType||!t.partialSig)return;const{partialSig:e,sighashType:r}=t;e.forEach((t=>{const{hashType:e}=f.signature.decode(t.signature);if(r!==e)throw new Error("Signature sighash does not match input sighash type")}))}(r);const{finalScriptSig:a,finalScriptWitness:h}=e(t,r,n,u,i,s);if(a&&this.data.updateInput(t,{finalScriptSig:a}),h&&this.data.updateInput(t,{finalScriptWitness:h}),!a&&!h)throw new Error(`Unknown error finalizing input #${t}`);return this.data.clearFinalizedInput(t),this}getInputType(t){const e=o.checkForInput(this.data.inputs,t),r=z(X(t,e,this.__CACHE),t,"input",e.redeemScript||function(t){if(!t)return;const e=f.decompile(t);if(!e)return;const r=e[e.length-1];if(!n.isBuffer(r)||$(r)||(i=r,f.isCanonicalScriptSignature(i)))return;var i;if(!f.decompile(r))return;return r}(e.finalScriptSig),e.witnessScript||function(t){if(!t)return;const e=W(t),r=e[e.length-1];if($(r))return;if(!f.decompile(r))return;return r}(e.finalScriptWitness));return("raw"===r.type?"":r.type+"-")+J(r.meaningfulScript)}inputHasPubkey(t,e){return function(t,e,r,n){const i=X(r,e,n),{meaningfulScript:s}=z(i,r,"input",e.redeemScript,e.witnessScript);return Q(t,s)}(e,o.checkForInput(this.data.inputs,t),t,this.__CACHE)}inputHasHDKey(t,e){const r=o.checkForInput(this.data.inputs,t),n=x(e);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}outputHasPubkey(t,e){return function(t,e,r,n){const i=n.__TX.outs[r].script,{meaningfulScript:s}=z(i,r,"output",e.redeemScript,e.witnessScript);return Q(t,s)}(e,o.checkForOutput(this.data.outputs,t),t,this.__CACHE)}outputHasHDKey(t,e){const r=o.checkForOutput(this.data.outputs,t),n=x(e);return!!r.bip32Derivation&&r.bip32Derivation.some(n)}validateSignaturesOfAllInputs(){o.checkForInput(this.data.inputs,0);return Z(this.data.inputs.length).map((t=>this.validateSignaturesOfInput(t))).reduce(((t,e)=>!0===e&&t),!0)}validateSignaturesOfInput(t,e){const r=this.data.inputs[t],n=(r||{}).partialSig;if(!r||!n||n.length<1)throw new Error("No signatures to validate");const i=e?n.filter((t=>t.pubkey.equals(e))):n;if(i.length<1)throw new Error("No signatures for this pubkey");const s=[];let o,u,a;for(const e of i){const n=f.signature.decode(e.signature),{hash:i,script:h}=a!==n.hashType?K(t,Object.assign({},r,{sighashType:n.hashType}),this.__CACHE,!0):{hash:o,script:u};a=n.hashType,o=i,u=h,U(e.pubkey,h,"verify");const c=p.fromPublicKey(e.pubkey);s.push(c.verify(i,n.signature))}return s.every((t=>!0===t))}signAllInputsHD(t,e=[d.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey||!t.fingerprint)throw new Error("Need HDSigner to sign input");const r=[];for(const n of Z(this.data.inputs.length))try{this.signInputHD(n,t,e),r.push(!0)}catch(t){r.push(!1)}if(r.every((t=>!1===t)))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(t,e=[d.Transaction.SIGHASH_ALL]){return new Promise(((r,n)=>{if(!t||!t.publicKey||!t.fingerprint)return n(new Error("Need HDSigner to sign input"));const i=[],s=[];for(const r of Z(this.data.inputs.length))s.push(this.signInputHDAsync(r,t,e).then((()=>{i.push(!0)}),(()=>{i.push(!1)})));return Promise.all(s).then((()=>{if(i.every((t=>!1===t)))return n(new Error("No inputs were signed"));r()}))}))}signInputHD(t,e,r=[d.Transaction.SIGHASH_ALL]){if(!e||!e.publicKey||!e.fingerprint)throw new Error("Need HDSigner to sign input");return q(t,this.data.inputs,e).forEach((e=>this.signInput(t,e,r))),this}signInputHDAsync(t,e,r=[d.Transaction.SIGHASH_ALL]){return new Promise(((n,i)=>{if(!e||!e.publicKey||!e.fingerprint)return i(new Error("Need HDSigner to sign input"));const s=q(t,this.data.inputs,e).map((e=>this.signInputAsync(t,e,r)));return Promise.all(s).then((()=>{n()})).catch(i)}))}signAllInputs(t,e=[d.Transaction.SIGHASH_ALL]){if(!t||!t.publicKey)throw new Error("Need Signer to sign input");const r=[];for(const n of Z(this.data.inputs.length))try{this.signInput(n,t,e),r.push(!0)}catch(t){r.push(!1)}if(r.every((t=>!1===t)))throw new Error("No inputs were signed");return this}signAllInputsAsync(t,e=[d.Transaction.SIGHASH_ALL]){return new Promise(((r,n)=>{if(!t||!t.publicKey)return n(new Error("Need Signer to sign input"));const i=[],s=[];for(const[r]of this.data.inputs.entries())s.push(this.signInputAsync(r,t,e).then((()=>{i.push(!0)}),(()=>{i.push(!1)})));return Promise.all(s).then((()=>{if(i.every((t=>!1===t)))return n(new Error("No inputs were signed"));r()}))}))}signInput(t,e,r=[d.Transaction.SIGHASH_ALL]){if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const{hash:n,sighashType:i}=D(this.data.inputs,t,e.publicKey,this.__CACHE,r),s=[{pubkey:e.publicKey,signature:f.signature.encode(e.sign(n),i)}];return this.data.updateInput(t,{partialSig:s}),this}signInputAsync(t,e,r=[d.Transaction.SIGHASH_ALL]){return Promise.resolve().then((()=>{if(!e||!e.publicKey)throw new Error("Need Signer to sign input");const{hash:n,sighashType:i}=D(this.data.inputs,t,e.publicKey,this.__CACHE,r);return Promise.resolve(e.sign(n)).then((r=>{const n=[{pubkey:e.publicKey,signature:f.signature.encode(r,i)}];this.data.updateInput(t,{partialSig:n})}))}))}toBuffer(){return v(this.__CACHE),this.data.toBuffer()}toHex(){return v(this.__CACHE),this.data.toHex()}toBase64(){return v(this.__CACHE),this.data.toBase64()}updateGlobal(t){return this.data.updateGlobal(t),this}updateInput(t,e){return e.witnessScript&&Y(e.witnessScript),this.data.updateInput(t,e),e.nonWitnessUtxo&&V(this.__CACHE,this.data.inputs[t],t),this}updateOutput(t,e){return this.data.updateOutput(t,e),this}addUnknownKeyValToGlobal(t){return this.data.addUnknownKeyValToGlobal(t),this}addUnknownKeyValToInput(t,e){return this.data.addUnknownKeyValToInput(t,e),this}addUnknownKeyValToOutput(t,e){return this.data.addUnknownKeyValToOutput(t,e),this}clearFinalizedInput(t){return this.data.clearFinalizedInput(t),this}constructor(t={},e=new i.Psbt(new y)){this.data=e,this.opts=Object.assign({},g,t),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},0===this.data.inputs.length&&this.setVersion(2);const r=(t,e,r,n)=>Object.defineProperty(t,e,{enumerable:r,writable:n});r(this,"__CACHE",!1,!0),r(this,"opts",!1,!0)}}t.exports.Psbt=m;const w=t=>new y(t);class y{getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(t){if(void 0===t.hash||void 0===t.index||!n.isBuffer(t.hash)&&"string"!=typeof t.hash||"number"!=typeof t.index)throw new Error("Error adding input.");const e="string"==typeof t.hash?a.reverseBuffer(n.from(t.hash,"hex")):t.hash;this.tx.addInput(e,t.index,t.sequence)}addOutput(t){if(void 0===t.script||void 0===t.value||!n.isBuffer(t.script)||"number"!=typeof t.value)throw new Error("Error adding output.");this.tx.addOutput(t.script,t.value)}toBuffer(){return this.tx.toBuffer()}constructor(t=n.from([2,0,0,0,0,0,0,0,0,0])){this.tx=d.Transaction.fromBuffer(t),function(t){if(!t.ins.every((t=>t.script&&0===t.script.length&&t.witness&&0===t.witness.length)))throw new Error("Format Error: Transaction ScriptSigs are not empty")}(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}}function v(t){if(!1!==t.__UNSAFE_SIGN_NONSEGWIT)throw new Error("Not BIP174 compliant, can not export")}function _(t,e,r){if(!e)return!1;let n;if(n=r?r.map((t=>{const r=p.fromPublicKey(t,{compressed:!0}).publicKey;return e.find((t=>t.pubkey.equals(r)))})).filter((t=>!!t)):e,n.length>t)throw new Error("Too many signatures");return n.length===t}function E(t){return!!t.finalScriptSig||!!t.finalScriptWitness}function S(t){return e=>{try{return t({output:e}),!0}catch(t){return!1}}}const b=S(l.p2ms),I=S(l.p2pk),T=S(l.p2pkh),P=S(l.p2wpkh),O=S(l.p2wsh),M=S(l.p2sh);function x(t){return e=>!!e.masterFingerprint.equals(t.fingerprint)&&!!t.derivePath(e.path).publicKey.equals(e.pubkey)}function k(t){if("number"!=typeof t||t!==Math.floor(t)||t>4294967295||t<0)throw new Error("Invalid 32 bit integer")}function A(t,e){t.forEach((t=>{let r=!1,i=[];if(0===(t.partialSig||[]).length){if(!t.finalScriptSig&&!t.finalScriptWitness)return;i=function(t){const e=t.finalScriptSig&&f.decompile(t.finalScriptSig)||[],r=t.finalScriptWitness&&f.decompile(t.finalScriptWitness)||[];return e.concat(r).filter((t=>n.isBuffer(t)&&f.isCanonicalScriptSignature(t))).map((t=>({signature:t})))}(t)}else i=t.partialSig;if(i.forEach((t=>{const{hashType:n}=f.signature.decode(t.signature),i=[];n&d.Transaction.SIGHASH_ANYONECANPAY&&i.push("addInput");switch(31&n){case d.Transaction.SIGHASH_ALL:break;case d.Transaction.SIGHASH_SINGLE:case d.Transaction.SIGHASH_NONE:i.push("addOutput"),i.push("setInputSequence")}-1===i.indexOf(e)&&(r=!0)})),r)throw new Error("Can not modify transaction, signatures exist.")}))}function U(t,e,r){if(!Q(t,e))throw new Error(`Can not ${r} for this input with the key ${t.toString("hex")}`)}function N(t,e){const r=a.reverseBuffer(n.from(e.hash)).toString("hex")+":"+e.index;if(t.__TX_IN_CACHE[r])throw new Error("Duplicate input detected.");t.__TX_IN_CACHE[r]=1}function B(t,e){return(r,n,i,s)=>{const o=t({redeem:{output:i}}).output;if(!n.equals(o))throw new Error(`${e} for ${s} #${r} doesn't match the scriptPubKey in the prevout`)}}const H=B(l.p2sh,"Redeem script"),R=B(l.p2wsh,"Witness script");function C(t,e,r,n){if(!r.every(E))throw new Error(`PSBT must be finalized to calculate ${e}`);if("__FEE_RATE"===t&&n.__FEE_RATE)return n.__FEE_RATE;if("__FEE"===t&&n.__FEE)return n.__FEE;let i,s=!0;return n.__EXTRACTED_TX?(i=n.__EXTRACTED_TX,s=!1):i=n.__TX.clone(),G(r,i,n,s),"__FEE_RATE"===t?n.__FEE_RATE:"__FEE"===t?n.__FEE:void 0}function L(t,e,r,n,i,s){const o=J(r);if(!function(t,e,r){switch(r){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return _(1,t.partialSig);case"multisig":const r=l.p2ms({output:e});return _(r.m,t.partialSig,r.pubkeys);default:return!1}}(e,r,o))throw new Error(`Can not finalize input #${t}`);return function(t,e,r,n,i,s){let o,u;const a=function(t,e,r){let n;switch(e){case"multisig":const e=function(t,e){const r=l.p2ms({output:t});return r.pubkeys.map((t=>(e.filter((e=>e.pubkey.equals(t)))[0]||{}).signature)).filter((t=>!!t))}(t,r);n=l.p2ms({output:t,signatures:e});break;case"pubkey":n=l.p2pk({output:t,signature:r[0].signature});break;case"pubkeyhash":n=l.p2pkh({output:t,pubkey:r[0].pubkey,signature:r[0].signature});break;case"witnesspubkeyhash":n=l.p2wpkh({output:t,pubkey:r[0].pubkey,signature:r[0].signature})}return n}(t,e,r),h=s?l.p2wsh({redeem:a}):null,p=i?l.p2sh({redeem:h||a}):null;n?(u=F(h?h.witness:a.witness),p&&(o=p.input)):o=p?p.input:a.input;return{finalScriptSig:o,finalScriptWitness:u}}(r,o,e.partialSig,n,i,s)}function D(t,e,r,n,i){const s=o.checkForInput(t,e),{hash:u,sighashType:a,script:h}=K(e,s,n,!1,i);return U(r,h,"sign"),{hash:u,sighashType:a}}function K(t,e,r,n,i){const s=r.__TX,o=e.sighashType||d.Transaction.SIGHASH_ALL;if(i&&i.indexOf(o)<0){const t=function(t){let e=t&d.Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(31&t){case d.Transaction.SIGHASH_ALL:e+="SIGHASH_ALL";break;case d.Transaction.SIGHASH_SINGLE:e+="SIGHASH_SINGLE";break;case d.Transaction.SIGHASH_NONE:e+="SIGHASH_NONE"}return e}(o);throw new Error(`Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: ${t}`)}let u,a;if(e.nonWitnessUtxo){const n=j(r,e,t),i=s.ins[t].hash,o=n.getHash();if(!i.equals(o))throw new Error(`Non-witness UTXO hash for input #${t} doesn't match the hash specified in the prevout`);const u=s.ins[t].index;a=n.outs[u]}else{if(!e.witnessUtxo)throw new Error("Need a Utxo input item for signing");a=e.witnessUtxo}const{meaningfulScript:h,type:p}=z(a.script,t,"input",e.redeemScript,e.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(p)>=0)u=s.hashForWitnessV0(t,h,a.value,o);else if(P(h)){const e=l.p2pkh({hash:h.slice(2)}).output;u=s.hashForWitnessV0(t,e,a.value,o)}else{if(void 0===e.nonWitnessUtxo&&!1===r.__UNSAFE_SIGN_NONSEGWIT)throw new Error(`Input #${t} has witnessUtxo but non-segwit script: ${h.toString("hex")}`);n||!1===r.__UNSAFE_SIGN_NONSEGWIT||console.warn("Warning: Signing non-segwit inputs without the full parent transaction means there is a chance that a miner could feed you incorrect information to trick you into paying large fees. This behavior is the same as the old TransactionBuilder class when signing non-segwit scripts. You are not able to export this Psbt with toBuffer|toBase64|toHex since it is not BIP174 compliant.\n*********************\nPROCEED WITH CAUTION!\n*********************"),u=s.hashForSignature(t,h,o)}return{script:h,sighashType:o,hash:u}}function q(t,e,r){const n=o.checkForInput(e,t);if(!n.bip32Derivation||0===n.bip32Derivation.length)throw new Error("Need bip32Derivation to sign with HD");const i=n.bip32Derivation.map((t=>t.masterFingerprint.equals(r.fingerprint)?t:void 0)).filter((t=>!!t));if(0===i.length)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return i.map((t=>{const e=r.derivePath(t.path);if(!t.pubkey.equals(e.publicKey))throw new Error("pubkey did not match bip32Derivation");return e}))}function W(t){let e=0;function r(){const r=s.decode(t,e);return e+=s.decode.bytes,r}function n(){return n=r(),e+=n,t.slice(e-n,e);var n}return function(){const t=r(),e=[];for(let r=0;r<t;r++)e.push(n());return e}()}function F(t){let e=n.allocUnsafe(0);function r(t){const r=e.length,i=s.encodingLength(t);e=n.concat([e,n.allocUnsafe(i)]),s.encode(t,e,r)}function i(t){r(t.length),function(t){e=n.concat([e,n.from(t)])}(t)}var o;return r((o=t).length),o.forEach(i),e}function V(t,e,r){t.__NON_WITNESS_UTXO_BUF_CACHE[r]=e.nonWitnessUtxo;const n=d.Transaction.fromBuffer(e.nonWitnessUtxo);t.__NON_WITNESS_UTXO_TX_CACHE[r]=n;const i=t,s=r;delete e.nonWitnessUtxo,Object.defineProperty(e,"nonWitnessUtxo",{enumerable:!0,get(){const t=i.__NON_WITNESS_UTXO_BUF_CACHE[s],e=i.__NON_WITNESS_UTXO_TX_CACHE[s];if(void 0!==t)return t;{const t=e.toBuffer();return i.__NON_WITNESS_UTXO_BUF_CACHE[s]=t,t}},set(t){i.__NON_WITNESS_UTXO_BUF_CACHE[s]=t}})}function G(t,e,r,n){let i=0;t.forEach(((t,s)=>{if(n&&t.finalScriptSig&&(e.ins[s].script=t.finalScriptSig),n&&t.finalScriptWitness&&(e.ins[s].witness=W(t.finalScriptWitness)),t.witnessUtxo)i+=t.witnessUtxo.value;else if(t.nonWitnessUtxo){const n=j(r,t,s),o=e.ins[s].index,u=n.outs[o];i+=u.value}}));const s=e.outs.reduce(((t,e)=>t+e.value),0),o=i-s;if(o<0)throw new Error("Outputs are spending more than Inputs");const u=e.virtualSize();r.__FEE=o,r.__EXTRACTED_TX=e,r.__FEE_RATE=Math.floor(o/u)}function j(t,e,r){const n=t.__NON_WITNESS_UTXO_TX_CACHE;return n[r]||V(t,e,r),n[r]}function X(t,e,r){if(void 0!==e.witnessUtxo)return e.witnessUtxo.script;if(void 0!==e.nonWitnessUtxo){return j(r,e,t).outs[r.__TX.ins[t].index].script}throw new Error("Can't find pubkey in input without Utxo data")}function $(t){return 33===t.length&&f.isCanonicalPubKey(t)}function z(t,e,r,n,i){const s=M(t),o=s&&n&&O(n),u=O(t);if(s&&void 0===n)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((u||o)&&void 0===i)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let a;return o?(a=i,H(e,t,n,r),R(e,n,i,r),Y(a)):u?(a=i,R(e,t,i,r),Y(a)):s?(a=n,H(e,t,n,r)):a=t,{meaningfulScript:a,type:o?"p2sh-p2wsh":s?"p2sh":u?"p2wsh":"raw"}}function Y(t){if(P(t)||M(t))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function Q(t,e){const r=h.hash160(t),n=f.decompile(e);if(null===n)throw new Error("Unknown script error");return n.some((e=>"number"!=typeof e&&(e.equals(t)||e.equals(r))))}function J(t){return P(t)?"witnesspubkeyhash":T(t)?"pubkeyhash":b(t)?"multisig":I(t)?"pubkey":"nonstandard"}function Z(t){return[...Array(t).keys()]}})),r.register("cAhvt",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("hJRqN"),s=r("jsMFQ"),o=r("cUiwP"),u=r("adkaU"),a=r("7W5Bi"),h=r("bwA6R"),p=r("4OftM"),c=r("gUdqP"),l=(c=r("gUdqP"),r("4PM20")),f=r("hJyAm"),d=r("8DFnu");const g=o.types,m=new Set(["p2pkh","p2pk","p2wpkh","p2ms","p2sh-p2pkh","p2sh-p2pk","p2sh-p2wpkh","p2sh-p2ms","p2wsh-p2pkh","p2wsh-p2pk","p2wsh-p2ms","p2sh-p2wsh-p2pkh","p2sh-p2wsh-p2pk","p2sh-p2wsh-p2ms"]);function w(t,e,r){try{d(t,e)}catch(t){throw new Error(r)}}class y{static fromTransaction(t,e){const r=new y(e);return r.setVersion(t.version),r.setLockTime(t.locktime),t.outs.forEach((t=>{r.addOutput(t.script,t.value)})),t.ins.forEach((t=>{r.__addInputUnsafe(t.hash,t.index,{sequence:t.sequence,script:t.script,witness:t.witness})})),r.__INPUTS.forEach(((e,r)=>{!function(t,e,r){if(t.redeemScriptType!==g.P2MS||!t.redeemScript)return;if(t.pubkeys.length===t.signatures.length)return;const n=t.signatures.concat();t.signatures=t.pubkeys.map((i=>{const s=a.fromPublicKey(i);let o;return n.some(((i,u)=>{if(!i)return!1;const a=c.signature.decode(i),h=e.hashForSignature(r,t.redeemScript,a.hashType);return!!s.verify(h,a.signature)&&(n[u]=void 0,o=i,!0)})),o}))}(e,t,r)})),r}setLowR(t){return d(d.maybe(d.Boolean),t),void 0===t&&(t=!0),this.__USE_LOW_R=t,t}setLockTime(t){if(d(f.UInt32,t),this.__INPUTS.some((t=>!!t.signatures&&t.signatures.some((t=>void 0!==t)))))throw new Error("No, this would invalidate signatures");this.__TX.locktime=t}setVersion(t){d(f.UInt32,t),this.__TX.version=t}addInput(t,e,r,i){if(!this.__canModifyInputs())throw new Error("No, this would invalidate signatures");let o;if("string"==typeof(u=t)||u instanceof String)t=s.reverseBuffer(n.from(t,"hex"));else if(function(t){return t instanceof l.Transaction}(t)){const r=t.outs[e];i=r.script,o=r.value,t=t.getHash(!1)}var u;return this.__addInputUnsafe(t,e,{sequence:r,prevOutScript:i,value:o})}addOutput(t,e){if(!this.__canModifyOutputs())throw new Error("No, this would invalidate signatures");return"string"==typeof t&&(t=i.toOutputScript(t,this.network)),this.__TX.addOutput(t,e)}build(){return this.__build(!1)}buildIncomplete(){return this.__build(!0)}sign(t,e,r,n,i,s){!function({input:t,ourPubKey:e,keyPair:r,signatureHash:n,hashType:i,useLowR:s}){let o=!1;for(const[u,a]of t.pubkeys.entries()){if(!e.equals(a))continue;if(t.signatures[u])throw new Error("Signature already exists");if(33!==e.length&&t.hasWitness)throw new Error("BIP143 rejects uncompressed public keys in P2WPKH or P2WSH");const h=r.sign(n,s);t.signatures[u]=c.signature.encode(h,i),o=!0}if(!o)throw new Error("Key pair cannot sign for this input")}(function(t,e,r,n,i,s,o,u,a,h,y){let v;if("number"==typeof i)console.warn("DEPRECATED: TransactionBuilder sign method arguments will change in v6, please use the TxbSignArg interface"),v=i;else{if("object"!=typeof i)throw new TypeError("TransactionBuilder sign first arg must be TxbSignArg or number");!function(t,e){if(!m.has(e.prevOutScriptType))throw new TypeError(`Unknown prevOutScriptType "${e.prevOutScriptType}"`);w(d.Number,e.vin,"sign must include vin parameter as Number (input index)"),w(f.Signer,e.keyPair,"sign must include keyPair parameter as Signer interface"),w(d.maybe(d.Number),e.hashType,"sign hashType parameter must be a number");const r=(t[e.vin]||[]).prevOutType,n=e.prevOutScriptType;switch(n){case"p2pkh":if(r&&"pubkeyhash"!==r)throw new TypeError(`input #${e.vin} is not of type p2pkh: ${r}`);w(d.value(void 0),e.witnessScript,`${n} requires NO witnessScript`),w(d.value(void 0),e.redeemScript,`${n} requires NO redeemScript`),w(d.value(void 0),e.witnessValue,`${n} requires NO witnessValue`);break;case"p2pk":if(r&&"pubkey"!==r)throw new TypeError(`input #${e.vin} is not of type p2pk: ${r}`);w(d.value(void 0),e.witnessScript,`${n} requires NO witnessScript`),w(d.value(void 0),e.redeemScript,`${n} requires NO redeemScript`),w(d.value(void 0),e.witnessValue,`${n} requires NO witnessValue`);break;case"p2wpkh":if(r&&"witnesspubkeyhash"!==r)throw new TypeError(`input #${e.vin} is not of type p2wpkh: ${r}`);w(d.value(void 0),e.witnessScript,`${n} requires NO witnessScript`),w(d.value(void 0),e.redeemScript,`${n} requires NO redeemScript`),w(f.Satoshi,e.witnessValue,`${n} requires witnessValue`);break;case"p2ms":if(r&&"multisig"!==r)throw new TypeError(`input #${e.vin} is not of type p2ms: ${r}`);w(d.value(void 0),e.witnessScript,`${n} requires NO witnessScript`),w(d.value(void 0),e.redeemScript,`${n} requires NO redeemScript`),w(d.value(void 0),e.witnessValue,`${n} requires NO witnessValue`);break;case"p2sh-p2wpkh":if(r&&"scripthash"!==r)throw new TypeError(`input #${e.vin} is not of type p2sh-p2wpkh: ${r}`);w(d.value(void 0),e.witnessScript,`${n} requires NO witnessScript`),w(d.Buffer,e.redeemScript,`${n} requires redeemScript`),w(f.Satoshi,e.witnessValue,`${n} requires witnessValue`);break;case"p2sh-p2ms":case"p2sh-p2pk":case"p2sh-p2pkh":if(r&&"scripthash"!==r)throw new TypeError(`input #${e.vin} is not of type ${n}: ${r}`);w(d.value(void 0),e.witnessScript,`${n} requires NO witnessScript`),w(d.Buffer,e.redeemScript,`${n} requires redeemScript`),w(d.value(void 0),e.witnessValue,`${n} requires NO witnessValue`);break;case"p2wsh-p2ms":case"p2wsh-p2pk":case"p2wsh-p2pkh":if(r&&"witnessscripthash"!==r)throw new TypeError(`input #${e.vin} is not of type ${n}: ${r}`);w(d.Buffer,e.witnessScript,`${n} requires witnessScript`),w(d.value(void 0),e.redeemScript,`${n} requires NO redeemScript`),w(f.Satoshi,e.witnessValue,`${n} requires witnessValue`);break;case"p2sh-p2wsh-p2ms":case"p2sh-p2wsh-p2pk":case"p2sh-p2wsh-p2pkh":if(r&&"scripthash"!==r)throw new TypeError(`input #${e.vin} is not of type ${n}: ${r}`);w(d.Buffer,e.witnessScript,`${n} requires witnessScript`),w(d.Buffer,e.redeemScript,`${n} requires witnessScript`),w(f.Satoshi,e.witnessValue,`${n} requires witnessScript`)}}(e,i),({vin:v,keyPair:s,redeemScript:o,hashType:u,witnessValue:a,witnessScript:h}=i)}if(void 0===s)throw new Error("sign requires keypair");if(s.network&&s.network!==t)throw new TypeError("Inconsistent network");if(!e[v])throw new Error("No input at index: "+v);if(u=u||l.Transaction.SIGHASH_ALL,r(u))throw new Error("Transaction needs outputs");const E=e[v];if(void 0!==E.redeemScript&&o&&!E.redeemScript.equals(o))throw new Error("Inconsistent redeemScript");const b=s.publicKey||s.getPublicKey&&s.getPublicKey();if(!S(E)){if(void 0!==a){if(void 0!==E.value&&E.value!==a)throw new Error("Input did not match witnessValue");d(f.Satoshi,a),E.value=a}if(!S(E)){const t=function(t,e,r,n){if(r&&n){const i=p.p2wsh({redeem:{output:n}}),s=p.p2wsh({output:r}),o=p.p2sh({redeem:{output:r}}),u=p.p2sh({redeem:i});if(!i.hash.equals(s.hash))throw new Error("Witness script inconsistent with prevOutScript");if(!o.hash.equals(u.hash))throw new Error("Redeem script inconsistent with prevOutScript");const a=_(i.redeem.output,e);if(!a.pubkeys)throw new Error(a.type+" not supported as witnessScript ("+c.toASM(n)+")");t.signatures&&t.signatures.some((t=>void 0!==t))&&(a.signatures=t.signatures);const h=n;if(a.type===g.P2WPKH)throw new Error("P2SH(P2WSH(P2WPKH)) is a consensus failure");return{redeemScript:r,redeemScriptType:g.P2WSH,witnessScript:n,witnessScriptType:a.type,prevOutType:g.P2SH,prevOutScript:o.output,hasWitness:!0,signScript:h,signType:a.type,pubkeys:a.pubkeys,signatures:a.signatures,maxSignatures:a.maxSignatures}}if(r){const n=p.p2sh({redeem:{output:r}});if(t.prevOutScript){let e;try{e=p.p2sh({output:t.prevOutScript})}catch(t){throw new Error("PrevOutScript must be P2SH")}if(!n.hash.equals(e.hash))throw new Error("Redeem script inconsistent with prevOutScript")}const i=_(n.redeem.output,e);if(!i.pubkeys)throw new Error(i.type+" not supported as redeemScript ("+c.toASM(r)+")");t.signatures&&t.signatures.some((t=>void 0!==t))&&(i.signatures=t.signatures);let s=r;return i.type===g.P2WPKH&&(s=p.p2pkh({pubkey:i.pubkeys[0]}).output),{redeemScript:r,redeemScriptType:i.type,prevOutType:g.P2SH,prevOutScript:n.output,hasWitness:i.type===g.P2WPKH,signScript:s,signType:i.type,pubkeys:i.pubkeys,signatures:i.signatures,maxSignatures:i.maxSignatures}}if(n){const r=p.p2wsh({redeem:{output:n}});if(t.prevOutScript){const e=p.p2wsh({output:t.prevOutScript});if(!r.hash.equals(e.hash))throw new Error("Witness script inconsistent with prevOutScript")}const i=_(r.redeem.output,e);if(!i.pubkeys)throw new Error(i.type+" not supported as witnessScript ("+c.toASM(n)+")");t.signatures&&t.signatures.some((t=>void 0!==t))&&(i.signatures=t.signatures);const s=n;if(i.type===g.P2WPKH)throw new Error("P2WSH(P2WPKH) is a consensus failure");return{witnessScript:n,witnessScriptType:i.type,prevOutType:g.P2WSH,prevOutScript:r.output,hasWitness:!0,signScript:s,signType:i.type,pubkeys:i.pubkeys,signatures:i.signatures,maxSignatures:i.maxSignatures}}if(t.prevOutType&&t.prevOutScript){if(t.prevOutType===g.P2SH)throw new Error("PrevOutScript is "+t.prevOutType+", requires redeemScript");if(t.prevOutType===g.P2WSH)throw new Error("PrevOutScript is "+t.prevOutType+", requires witnessScript");if(!t.prevOutScript)throw new Error("PrevOutScript is missing");const r=_(t.prevOutScript,e);if(!r.pubkeys)throw new Error(r.type+" not supported ("+c.toASM(t.prevOutScript)+")");t.signatures&&t.signatures.some((t=>void 0!==t))&&(r.signatures=t.signatures);let n=t.prevOutScript;return r.type===g.P2WPKH&&(n=p.p2pkh({pubkey:r.pubkeys[0]}).output),{prevOutType:r.type,prevOutScript:t.prevOutScript,hasWitness:r.type===g.P2WPKH,signScript:n,signType:r.type,pubkeys:r.pubkeys,signatures:r.signatures,maxSignatures:r.maxSignatures}}const i=p.p2pkh({pubkey:e}).output;return{prevOutType:g.P2PKH,prevOutScript:i,hasWitness:!1,signScript:i,signType:g.P2PKH,pubkeys:[e],signatures:[void 0]}}(E,b,o,h);Object.assign(E,t)}if(!S(E))throw Error(E.prevOutType+" not supported")}let I;I=E.hasWitness?n.hashForWitnessV0(v,E.signScript,E.value,u):n.hashForSignature(v,E.signScript,u);return{input:E,ourPubKey:b,keyPair:s,signatureHash:I,hashType:u,useLowR:!!y}}(this.network,this.__INPUTS,this.__needsOutputs.bind(this),this.__TX,t,e,r,n,i,s,this.__USE_LOW_R))}__addInputUnsafe(t,e,r){if(l.Transaction.isCoinbaseHash(t))throw new Error("coinbase inputs not supported");const n=t.toString("hex")+":"+e;if(void 0!==this.__PREV_TX_SET[n])throw new Error("Duplicate TxOut: "+n);let i={};if(void 0!==r.script&&(i=v(r.script,r.witness||[])),void 0!==r.value&&(i.value=r.value),!i.prevOutScript&&r.prevOutScript){let t;if(!i.pubkeys&&!i.signatures){const e=_(r.prevOutScript);e.pubkeys&&(i.pubkeys=e.pubkeys,i.signatures=e.signatures),t=e.type}i.prevOutScript=r.prevOutScript,i.prevOutType=t||o.output(r.prevOutScript)}const s=this.__TX.addInput(t,e,r.sequence,r.scriptSig);return this.__INPUTS[s]=i,this.__PREV_TX_SET[n]=!0,s}__build(t){if(!t){if(!this.__TX.ins.length)throw new Error("Transaction has no inputs");if(!this.__TX.outs.length)throw new Error("Transaction has no outputs")}const e=this.__TX.clone();if(this.__INPUTS.forEach(((r,n)=>{if(!r.prevOutType&&!t)throw new Error("Transaction is not complete");const i=E(r.prevOutType,r,t);if(i)e.setInputScript(n,i.input),e.setWitness(n,i.witness);else{if(!t&&r.prevOutType===g.NONSTANDARD)throw new Error("Unknown input type");if(!t)throw new Error("Not enough information")}})),!t&&this.__overMaximumFees(e.virtualSize()))throw new Error("Transaction has absurd fees");return e}__canModifyInputs(){return this.__INPUTS.every((t=>!t.signatures||t.signatures.every((t=>{if(!t)return!0;return 0!=(b(t)&l.Transaction.SIGHASH_ANYONECANPAY)}))))}__needsOutputs(t){return t===l.Transaction.SIGHASH_ALL?0===this.__TX.outs.length:0===this.__TX.outs.length&&this.__INPUTS.some((t=>!!t.signatures&&t.signatures.some((t=>{if(!t)return!1;return!(b(t)&l.Transaction.SIGHASH_NONE)}))))}__canModifyOutputs(){const t=this.__TX.ins.length,e=this.__TX.outs.length;return this.__INPUTS.every((r=>void 0===r.signatures||r.signatures.every((r=>{if(!r)return!0;const n=31&b(r);return n===l.Transaction.SIGHASH_NONE||n===l.Transaction.SIGHASH_SINGLE&&t<=e}))))}__overMaximumFees(t){return(this.__INPUTS.reduce(((t,e)=>t+(e.value>>>0)),0)-this.__TX.outs.reduce(((t,e)=>t+e.value),0))/t>this.maximumFeeRate}constructor(t=h.bitcoin,e=2500){this.network=t,this.maximumFeeRate=e,this.__PREV_TX_SET={},this.__INPUTS=[],this.__TX=new l.Transaction,this.__TX.version=2,this.__USE_LOW_R=!1,console.warn("Deprecation Warning: TransactionBuilder will be removed in the future. (v6.x.x or later) Please use the Psbt class instead. Examples of usage are available in the transactions-psbt.js integration test file on our Github. A high level explanation is available in the psbt.ts and psbt.js files as well.")}}function v(t,e,r,n){if(0===t.length&&0===e.length)return{};if(!r){let n=o.input(t,!0),i=o.witness(e,!0);n===g.NONSTANDARD&&(n=void 0),i===g.NONSTANDARD&&(i=void 0),r=n||i}switch(r){case g.P2WPKH:{const{output:t,pubkey:r,signature:n}=p.p2wpkh({witness:e});return{prevOutScript:t,prevOutType:g.P2WPKH,pubkeys:[r],signatures:[n]}}case g.P2PKH:{const{output:e,pubkey:r,signature:n}=p.p2pkh({input:t});return{prevOutScript:e,prevOutType:g.P2PKH,pubkeys:[r],signatures:[n]}}case g.P2PK:{const{signature:e}=p.p2pk({input:t});return{prevOutType:g.P2PK,pubkeys:[void 0],signatures:[e]}}case g.P2MS:{const{m:e,pubkeys:r,signatures:i}=p.p2ms({input:t,output:n},{allowIncomplete:!0});return{prevOutType:g.P2MS,pubkeys:r,signatures:i,maxSignatures:e}}}if(r===g.P2SH){const{output:r,redeem:n}=p.p2sh({input:t,witness:e}),i=o.output(n.output),s=v(n.input,n.witness,i,n.output);return s.prevOutType?{prevOutScript:r,prevOutType:g.P2SH,redeemScript:n.output,redeemScriptType:s.prevOutType,witnessScript:s.witnessScript,witnessScriptType:s.witnessScriptType,pubkeys:s.pubkeys,signatures:s.signatures}:{}}if(r===g.P2WSH){const{output:r,redeem:n}=p.p2wsh({input:t,witness:e}),i=o.output(n.output);let s;return s=i===g.P2WPKH?v(n.input,n.witness,i):v(c.compile(n.witness),[],i,n.output),s.prevOutType?{prevOutScript:r,prevOutType:g.P2WSH,witnessScript:n.output,witnessScriptType:s.prevOutType,pubkeys:s.pubkeys,signatures:s.signatures}:{}}return{prevOutType:g.NONSTANDARD,prevOutScript:t}}function _(t,e){d(f.Buffer,t);const r=o.output(t);switch(r){case g.P2PKH:{if(!e)return{type:r};const n=p.p2pkh({output:t}).hash,i=u.hash160(e);return n.equals(i)?{type:r,pubkeys:[e],signatures:[void 0]}:{type:r}}case g.P2WPKH:{if(!e)return{type:r};const n=p.p2wpkh({output:t}).hash,i=u.hash160(e);return n.equals(i)?{type:r,pubkeys:[e],signatures:[void 0]}:{type:r}}case g.P2PK:return{type:r,pubkeys:[p.p2pk({output:t}).pubkey],signatures:[void 0]};case g.P2MS:{const e=p.p2ms({output:t});return{type:r,pubkeys:e.pubkeys,signatures:e.pubkeys.map((()=>{})),maxSignatures:e.m}}}return{type:r}}function E(t,e,r){const n=e.pubkeys||[];let i=e.signatures||[];switch(t){case g.P2PKH:if(0===n.length)break;if(0===i.length)break;return p.p2pkh({pubkey:n[0],signature:i[0]});case g.P2WPKH:if(0===n.length)break;if(0===i.length)break;return p.p2wpkh({pubkey:n[0],signature:i[0]});case g.P2PK:if(0===n.length)break;if(0===i.length)break;return p.p2pk({signature:i[0]});case g.P2MS:{const t=e.maxSignatures;i=r?i.map((t=>t||c.OPS.OP_0)):i.filter((t=>t));const s=!r||t===i.length;return p.p2ms({m:t,pubkeys:n,signatures:i},{allowIncomplete:r,validate:s})}case g.P2SH:{const t=E(e.redeemScriptType,e,r);if(!t)return;return p.p2sh({redeem:{output:t.output||e.redeemScript,input:t.input,witness:t.witness}})}case g.P2WSH:{const t=E(e.witnessScriptType,e,r);if(!t)return;return p.p2wsh({redeem:{output:e.witnessScript,input:t.input,witness:t.witness}})}}}function S(t){return void 0!==t.signScript&&void 0!==t.signType&&void 0!==t.pubkeys&&void 0!==t.signatures&&t.signatures.length===t.pubkeys.length&&t.pubkeys.length>0&&(!1===t.hasWitness||void 0!==t.value)}function b(t){return t.readUInt8(t.length-1)}t.exports.TransactionBuilder=y})),r.register("cUiwP",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("gUdqP"),i=r("3peYp"),s=r("46O1T"),o=r("9kzc9"),u=r("b9v3v"),a=r("f3706"),h=r("eNYn9"),p=r("4Gr9b"),c=r("jTT0D");const l={P2MS:"multisig",NONSTANDARD:"nonstandard",NULLDATA:"nulldata",P2PK:"pubkey",P2PKH:"pubkeyhash",P2SH:"scripthash",P2WPKH:"witnesspubkeyhash",P2WSH:"witnessscripthash",WITNESS_COMMITMENT:"witnesscommitment"};t.exports.types=l,t.exports.output=function(t){if(p.output.check(t))return l.P2WPKH;if(c.output.check(t))return l.P2WSH;if(u.output.check(t))return l.P2PKH;if(a.output.check(t))return l.P2SH;const e=n.decompile(t);if(!e)throw new TypeError("Invalid script");return i.output.check(e)?l.P2MS:o.output.check(e)?l.P2PK:h.output.check(e)?l.WITNESS_COMMITMENT:s.output.check(e)?l.NULLDATA:l.NONSTANDARD},t.exports.input=function(t,e){const r=n.decompile(t);if(!r)throw new TypeError("Invalid script");return u.input.check(r)?l.P2PKH:a.input.check(r,e)?l.P2SH:i.input.check(r,e)?l.P2MS:o.input.check(r)?l.P2PK:l.NONSTANDARD},t.exports.witness=function(t,e){const r=n.decompile(t);if(!r)throw new TypeError("Invalid script");return p.input.check(r)?l.P2WPKH:c.input.check(r,e)?l.P2WSH:l.NONSTANDARD}})),r.register("3peYp",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("4pxhF");t.exports.input=n;var i=r("izs5G");t.exports.output=i})),r.register("4pxhF",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("gUdqP");n=r("gUdqP");function i(t){return t===n.OPS.OP_0||n.isCanonicalScriptSignature(t)}function s(t,e){const r=n.decompile(t);return!(r.length<2)&&(r[0]===n.OPS.OP_0&&(e?r.slice(1).every(i):r.slice(1).every(n.isCanonicalScriptSignature)))}t.exports.check=s,s.toJSON=()=>"multisig input"})),r.register("izs5G",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("gUdqP"),i=(n=r("gUdqP"),r("hJyAm"));const s=n.OPS.OP_RESERVED;function o(t,e){const r=n.decompile(t);if(r.length<4)return!1;if(r[r.length-1]!==n.OPS.OP_CHECKMULTISIG)return!1;if(!i.Number(r[0]))return!1;if(!i.Number(r[r.length-2]))return!1;const o=r[0]-s,u=r[r.length-2]-s;if(o<=0)return!1;if(u>16)return!1;if(o>u)return!1;if(u!==r.length-3)return!1;if(e)return!0;return r.slice(1,-2).every(n.isCanonicalPubKey)}t.exports.check=o,o.toJSON=()=>"multi-sig output"})),r.register("46O1T",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("gUdqP");const i=n.OPS;function s(t){const e=n.compile(t);return e.length>1&&e[0]===i.OP_RETURN}t.exports.check=s,s.toJSON=()=>"null data output";const o={check:s};t.exports.output=o})),r.register("9kzc9",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("lGkVx");t.exports.input=n;var i=r("6VsFo");t.exports.output=i})),r.register("lGkVx",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("gUdqP");function i(t){const e=n.decompile(t);return 1===e.length&&n.isCanonicalScriptSignature(e[0])}t.exports.check=i,i.toJSON=()=>"pubKey input"})),r.register("6VsFo",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("gUdqP");n=r("gUdqP");function i(t){const e=n.decompile(t);return 2===e.length&&n.isCanonicalPubKey(e[0])&&e[1]===n.OPS.OP_CHECKSIG}t.exports.check=i,i.toJSON=()=>"pubKey output"})),r.register("b9v3v",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("dQS6I");t.exports.input=n;var i=r("aqzuF");t.exports.output=i})),r.register("dQS6I",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("gUdqP");function i(t){const e=n.decompile(t);return 2===e.length&&n.isCanonicalScriptSignature(e[0])&&n.isCanonicalPubKey(e[1])}t.exports.check=i,i.toJSON=()=>"pubKeyHash input"})),r.register("aqzuF",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("gUdqP");n=r("gUdqP");function i(t){const e=n.compile(t);return 25===e.length&&e[0]===n.OPS.OP_DUP&&e[1]===n.OPS.OP_HASH160&&20===e[2]&&e[23]===n.OPS.OP_EQUALVERIFY&&e[24]===n.OPS.OP_CHECKSIG}t.exports.check=i,i.toJSON=()=>"pubKeyHash output"})),r.register("f3706",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("au8m1");t.exports.input=n;var i=r("j3ntU");t.exports.output=i})),r.register("au8m1",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("gUdqP"),s=r("3peYp"),o=r("9kzc9"),u=r("b9v3v"),a=r("bO7LL"),h=r("4aKNH");function p(t,e){const r=i.decompile(t);if(r.length<1)return!1;const p=r[r.length-1];if(!n.isBuffer(p))return!1;const c=i.decompile(i.compile(r.slice(0,-1))),l=i.decompile(p);return!!l&&(!!i.isPushOnly(c)&&(1===r.length?h.check(l)||a.check(l):!(!u.input.check(c)||!u.output.check(l))||(!(!s.input.check(c,e)||!s.output.check(l))||!(!o.input.check(c)||!o.output.check(l)))))}t.exports.check=p,p.toJSON=()=>"scriptHash input"})),r.register("bO7LL",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("gUdqP");n=r("gUdqP");function i(t){const e=n.compile(t);return 22===e.length&&e[0]===n.OPS.OP_0&&20===e[1]}t.exports.check=i,i.toJSON=()=>"Witness pubKeyHash output"})),r.register("4aKNH",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("gUdqP");n=r("gUdqP");function i(t){const e=n.compile(t);return 34===e.length&&e[0]===n.OPS.OP_0&&32===e[1]}t.exports.check=i,i.toJSON=()=>"Witness scriptHash output"})),r.register("j3ntU",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("gUdqP");n=r("gUdqP");function i(t){const e=n.compile(t);return 23===e.length&&e[0]===n.OPS.OP_HASH160&&20===e[1]&&e[22]===n.OPS.OP_EQUAL}t.exports.check=i,i.toJSON=()=>"scriptHash output"})),r.register("eNYn9",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("44EHP");t.exports.output=n})),r.register("44EHP",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("gUdqP"),s=(i=r("gUdqP"),r("hJyAm")),o=r("8DFnu");const u=n.from("aa21a9ed","hex");function a(t){const e=i.compile(t);return e.length>37&&e[0]===i.OPS.OP_RETURN&&36===e[1]&&e.slice(2,6).equals(u)}t.exports.check=a,a.toJSON=()=>"Witness commitment output",t.exports.encode=function(t){o(s.Hash256bit,t);const e=n.allocUnsafe(36);return u.copy(e,0),t.copy(e,4),i.compile([i.OPS.OP_RETURN,e])},t.exports.decode=function(t){return o(a,t),i.decompile(t)[1].slice(4,36)}})),r.register("4Gr9b",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("kMae9");t.exports.input=n;var i=r("bO7LL");t.exports.output=i})),r.register("kMae9",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("gUdqP");function i(t){const e=n.decompile(t);return 2===e.length&&n.isCanonicalScriptSignature(e[0])&&(r=e[1],n.isCanonicalPubKey(r)&&33===r.length);var r}t.exports.check=i,i.toJSON=()=>"witnessPubKeyHash input"})),r.register("jTT0D",(function(t,e){Object.defineProperty(t.exports,"__esModule",{value:!0});var n=r("2Lq1D");t.exports.input=n;var i=r("4aKNH");t.exports.output=i})),r.register("2Lq1D",(function(t,e){var n=r("6rT8n").Buffer;Object.defineProperty(t.exports,"__esModule",{value:!0});var i=r("gUdqP"),s=r("8DFnu"),o=r("3peYp"),u=r("9kzc9"),a=r("b9v3v");function h(t,e){if(s(s.Array,t),t.length<1)return!1;const r=t[t.length-1];if(!n.isBuffer(r))return!1;const h=i.decompile(r);if(!h||0===h.length)return!1;const p=i.compile(t.slice(0,-1));return!(!a.input.check(p)||!a.output.check(h))||(!(!o.input.check(p,e)||!o.output.check(h))||!(!u.input.check(p)||!u.output.check(h)))}t.exports.check=h,h.toJSON=()=>"witnessScriptHash input"})),r.register("1UYdo",(function(n,i){t(n.exports,"pathElementsToBuffer",(function(){return a})),t(n.exports,"bip32asBuffer",(function(){return h})),t(n.exports,"pathStringToArray",(function(){return c})),t(n.exports,"pathArrayToString",(function(){return p})),t(n.exports,"pubkeyFromXpub",(function(){return l})),t(n.exports,"getXpubComponents",(function(){return f})),t(n.exports,"hardenedPathOf",(function(){return d}));var s=r("9UXyL"),o=r("f8pp6"),u=r("6rT8n").Buffer;function a(t){const e=u.alloc(1+4*t.length);return e[0]=t.length,t.forEach(((t,r)=>{e.writeUInt32BE(t,1+4*r)})),e}function h(t){return a(t?c(t):[])}function p(t){return e(s).fromPathArray(t).toString()}function c(t){return e(s).fromString(t).toPathArray()}function l(t){const r=e(o).decode(t);return r.slice(r.length-33)}function f(t){const r=e(o).decode(t);return{chaincode:r.slice(13,45),pubkey:r.slice(r.length-33),version:r.readUInt32BE(0)}}function d(t){for(let e=t.length-1;e>=0;e--)if(t[e]>=2147483648)return t.slice(0,e+1);return[]}})),r.register("9UXyL",(function(t,e){const r=2147483648;var n=function(t){if(!Array.isArray(t))throw new Error("Input must be an Array");if(0===t.length)throw new Error("Path must contain at least one level");for(var e=0;e<t.length;e++)if("number"!=typeof t[e])throw new Error("Path element is not a number");this.path=t};n.validatePathArray=function(t){try{return n.fromPathArray(t),!0}catch(t){return!1}},n.validateString=function(t,e){try{return n.fromString(t,e),!0}catch(t){return!1}},n.fromPathArray=function(t){return new n(t)},n.fromString=function(t,e){if(/^m\//i.test(t))t=t.slice(2);else if(e)throw new Error("Root element is required");for(var i=t.split("/"),s=new Array(i.length),o=0;o<i.length;o++){var u=/(\d+)([hH\']?)/.exec(i[o]);if(null===u)throw new Error("Invalid input");if(s[o]=parseInt(u[1],10),s[o]>=r)throw new Error("Invalid child index");if("h"===u[2]||"H"===u[2]||"'"===u[2])s[o]+=r;else if(0!=u[2].length)throw new Error("Invalid modifier")}return new n(s)},n.prototype.toPathArray=function(){return this.path},n.prototype.toString=function(t,e){for(var n=new Array(this.path.length),i=0;i<this.path.length;i++){var s=this.path[i];n[i]=s&r?(2147483647&s)+(e?"h":"'"):s}return(t?"":"m/")+n.join("/")},n.prototype.inspect=function(){return"BIPPath <"+this.toString()+">"},t.exports=n})),r.register("gpQhj",(function(n,i){t(n.exports,"unsafeTo64bitLE",(function(){return u})),t(n.exports,"unsafeFrom64bitLE",(function(){return a})),t(n.exports,"BufferWriter",(function(){return h})),t(n.exports,"BufferReader",(function(){return p}));var s=r("jGIJA"),o=r("6rT8n").Buffer;function u(t){if(t>Number.MAX_SAFE_INTEGER)throw new Error("Can't convert numbers > MAX_SAFE_INT");const e=o.alloc(8,0);for(let r=0;r<e.length;r++){const n=255&t;e[r]=n,t=(t-n)/256}return e}function a(t){let e=0;if(8!=t.length)throw new Error("Expected Bufffer of lenght 8");if(0!=t[7])throw new Error("Can't encode numbers > MAX_SAFE_INT");if(t[6]>31)throw new Error("Can't encode numbers > MAX_SAFE_INT");for(let r=t.length-1;r>=0;r--)e=256*e+t[r];return e}class h{write(t,e){const r=o.alloc(t);e(r),this.bufs.push(r)}writeUInt8(t){this.write(1,(e=>e.writeUInt8(t,0)))}writeInt32(t){this.write(4,(e=>e.writeInt32LE(t,0)))}writeUInt32(t){this.write(4,(e=>e.writeUInt32LE(t,0)))}writeUInt64(t){const e=u(t);this.writeSlice(e)}writeVarInt(t){this.bufs.push(e(s).encode(t))}writeSlice(t){this.bufs.push(o.from(t))}writeVarSlice(t){this.writeVarInt(t.length),this.writeSlice(t)}buffer(){return o.concat(this.bufs)}constructor(){this.bufs=[]}}class p{available(){return this.buffer.length-this.offset}readUInt8(){const t=this.buffer.readUInt8(this.offset);return this.offset++,t}readInt32(){const t=this.buffer.readInt32LE(this.offset);return this.offset+=4,t}readUInt32(){const t=this.buffer.readUInt32LE(this.offset);return this.offset+=4,t}readUInt64(){return a(this.readSlice(8))}readVarInt(){const t=e(s).decode(this.buffer,this.offset);return this.offset+=e(s).decode.bytes,t}readSlice(t){if(this.buffer.length<this.offset+t)throw new Error("Cannot read slice out of bounds");const e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){const t=this.readVarInt(),e=[];for(let r=0;r<t;r++)e.push(this.readVarSlice());return e}constructor(t,e=0){this.buffer=t,this.offset=e}}})),r.register("4dqwp",(function(e,n){t(e.exports,"p2pkh",(function(){return l})),t(e.exports,"p2tr",(function(){return f})),t(e.exports,"p2wpkhWrapped",(function(){return d})),t(e.exports,"p2wpkh",(function(){return g}));var i=r("7yhlT"),s=r("noLW6"),o=r("gpQhj"),u=r("1hle7"),a=r("bKZ1C"),h=r("6rT8n").Buffer;class p{constructor(t,e){this.psbt=t,this.masterFp=e}}class c extends p{spendingCondition(t){if(1!=t.length)throw new Error("Expected single key, got "+t.length);return this.singleKeyCondition(t[0])}setInput(t,e,r,n,i){if(1!=n.length)throw new Error("Expected single key, got "+n.length);if(1!=i.length)throw new Error("Expected single path, got "+i.length);this.setSingleKeyInput(t,e,r,n[0],i[0])}setOwnOutput(t,e,r,n){if(1!=r.length)throw new Error("Expected single key, got "+r.length);if(1!=n.length)throw new Error("Expected single path, got "+n.length);this.setSingleKeyOutput(t,e,r[0],n[0])}}class l extends c{singleKeyCondition(t){const e=new(0,o.BufferWriter),r=(0,a.hashPublicKey)(t);return e.writeSlice(h.from([u.OP_DUP,u.OP_HASH160,u.HASH_SIZE])),e.writeSlice(r),e.writeSlice(h.from([u.OP_EQUALVERIFY,u.OP_CHECKSIG])),{scriptPubKey:e.buffer()}}setSingleKeyInput(t,e,r,n,i){if(!e)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(t,e),this.psbt.setInputBip32Derivation(t,n,this.masterFp,i)}setSingleKeyOutput(t,e,r,n){this.psbt.setOutputBip32Derivation(t,r,this.masterFp,n)}getDescriptorTemplate(){return"pkh(@0)"}}class f extends c{singleKeyCondition(t){const e=t.slice(1),r=new(0,o.BufferWriter),n=this.getTaprootOutputKey(e);return r.writeSlice(h.from([81,32])),r.writeSlice(n),{scriptPubKey:r.buffer()}}setSingleKeyInput(t,e,r,n,i){const s=n.slice(1);this.psbt.setInputTapBip32Derivation(t,s,[],this.masterFp,i),this.psbt.setInputWitnessUtxo(t,r.amount,r.cond.scriptPubKey)}setSingleKeyOutput(t,e,r,n){const i=r.slice(1);this.psbt.setOutputTapBip32Derivation(t,i,[],this.masterFp,n)}getDescriptorTemplate(){return"tr(@0)"}hashTapTweak(t){const e=i.crypto.sha256(h.from("TapTweak","utf-8"));return i.crypto.sha256(h.concat([e,e,t]))}getTaprootOutputKey(t){if(32!=t.length)throw new Error("Expected 32 byte pubkey. Got "+t.length);const e=h.concat([h.from([2]),t]),r=this.hashTapTweak(t);return h.from((0,s.pointAddScalar)(e,r)).slice(1)}}class d extends c{singleKeyCondition(t){const e=new(0,o.BufferWriter),r=this.createRedeemScript(t),n=(0,a.hashPublicKey)(r);return e.writeSlice(h.from([u.OP_HASH160,u.HASH_SIZE])),e.writeSlice(n),e.writeUInt8(u.OP_EQUAL),{scriptPubKey:e.buffer(),redeemScript:r}}setSingleKeyInput(t,e,r,n,i){if(!e)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(t,e),this.psbt.setInputBip32Derivation(t,n,this.masterFp,i);const s=r.cond.redeemScript,o=this.createRedeemScript(n);if(s&&!o.equals(s))throw new Error(`User-supplied redeemScript ${s.toString("hex")} doesn't\n       match expected ${o.toString("hex")} for input ${t}`);this.psbt.setInputRedeemScript(t,o),this.psbt.setInputWitnessUtxo(t,r.amount,r.cond.scriptPubKey)}setSingleKeyOutput(t,e,r,n){this.psbt.setOutputRedeemScript(t,e.redeemScript),this.psbt.setOutputBip32Derivation(t,r,this.masterFp,n)}getDescriptorTemplate(){return"sh(wpkh(@0))"}createRedeemScript(t){const e=(0,a.hashPublicKey)(t);return h.concat([h.from("0014","hex"),e])}}class g extends c{singleKeyCondition(t){const e=new(0,o.BufferWriter),r=(0,a.hashPublicKey)(t);return e.writeSlice(h.from([0,u.HASH_SIZE])),e.writeSlice(r),{scriptPubKey:e.buffer()}}setSingleKeyInput(t,e,r,n,i){if(!e)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(t,e),this.psbt.setInputBip32Derivation(t,n,this.masterFp,i),this.psbt.setInputWitnessUtxo(t,r.amount,r.cond.scriptPubKey)}setSingleKeyOutput(t,e,r,n){this.psbt.setOutputBip32Derivation(t,r,this.masterFp,n)}getDescriptorTemplate(){return"wpkh(@0)"}}})),r.register("1hle7",(function(e,r){t(e.exports,"MAX_SCRIPT_BLOCK",(function(){return n})),t(e.exports,"DEFAULT_VERSION",(function(){return i})),t(e.exports,"DEFAULT_LOCKTIME",(function(){return s})),t(e.exports,"DEFAULT_SEQUENCE",(function(){return o})),t(e.exports,"SIGHASH_ALL",(function(){return u})),t(e.exports,"OP_DUP",(function(){return a})),t(e.exports,"OP_HASH160",(function(){return h})),t(e.exports,"HASH_SIZE",(function(){return p})),t(e.exports,"OP_EQUAL",(function(){return c})),t(e.exports,"OP_EQUALVERIFY",(function(){return l})),t(e.exports,"OP_CHECKSIG",(function(){return f}));const n=50,i=1,s=0,o=4294967295,u=1,a=118,h=169,p=20,c=135,l=136,f=172})),r.register("bKZ1C",(function(n,i){t(n.exports,"hashPublicKey",(function(){return u}));var s=r("6Zmxr"),o=r("b63zp");function u(t){return(new(e(s))).update(e(o)("sha256").update(t).digest()).digest()}})),r.register("igter",(function(e,n){t(e.exports,"WalletPolicy",(function(){return h})),t(e.exports,"createKey",(function(){return p}));var i=r("7yhlT"),s=r("1UYdo"),o=r("gpQhj"),u=r("eIDCs"),a=r("6rT8n").Buffer;class h{getWalletId(){return i.crypto.sha256(this.serialize())}serialize(){const t=this.keys.map((t=>a.from(t,"ascii"))),e=new(0,u.Merkle)(t.map((t=>(0,u.hashLeaf)(t)))),r=new(0,o.BufferWriter);return r.writeUInt8(1),r.writeUInt8(0),r.writeVarSlice(a.from(this.descriptorTemplate,"ascii")),r.writeVarInt(this.keys.length),r.writeSlice(e.getRoot()),r.buffer()}constructor(t,e){this.descriptorTemplate=t,this.keys=[e]}}function p(t,e,r){const n=(0,s.pathArrayToString)(e);return`[${t.toString("hex")}${n.substring(1)}]${r}/**`}})),r.register("eIDCs",(function(e,n){t(e.exports,"Merkle",(function(){return o})),t(e.exports,"hashLeaf",(function(){return u}));var i=r("7yhlT"),s=r("6rT8n").Buffer;class o{getRoot(){return this.rootNode.hash}size(){return this.leaves.length}getLeaves(){return this.leaves}getLeafHash(t){return this.leafNodes[t].hash}getProof(t){if(t>=this.leaves.length)throw Error("Index out of bounds");return h(this.leafNodes[t])}calculateRoot(t){const e=t.length;if(0==e)return{root:new a(void 0,void 0,s.alloc(32,0)),leaves:[]};if(1==e){const e=new a(void 0,void 0,t[0]);return{root:e,leaves:[e]}}const r=function(t){if(t<2)throw Error("Expected n >= 2");return function(t){return 0==(t&t-1)}(t)?t/2:1<<Math.floor(Math.log2(t))}(e),n=this.calculateRoot(t.slice(0,r)),i=this.calculateRoot(t.slice(r)),o=n.root,u=i.root,h=this.hashNode(o.hash,u.hash),p=new a(o,u,h);return o.parent=p,u.parent=p,{root:p,leaves:n.leaves.concat(i.leaves)}}hashNode(t,e){return this.h(s.concat([s.from([1]),t,e]))}constructor(t,e=i.crypto.sha256){this.leaves=t,this.h=e;const r=this.calculateRoot(t);this.rootNode=r.root,this.leafNodes=r.leaves}}function u(t,e=i.crypto.sha256){return function(t,e,r){return r(s.concat([t,e]))}(s.from([0]),t,e)}class a{isLeaf(){return null==this.leftChild}constructor(t,e,r){this.leftChild=t,this.rightChild=e,this.hash=r}}function h(t){if(!t.parent)return[];if(t.parent.leftChild==t){if(!t.parent.rightChild)throw new Error("Expected right child to exist");return[t.parent.rightChild.hash,...h(t.parent)]}if(!t.parent.leftChild)throw new Error("Expected left child to exist");return[t.parent.leftChild.hash,...h(t.parent)]}})),r.register("fmsg1",(function(e,n){t(e.exports,"extract",(function(){return o}));var i=r("gpQhj"),s=r("6rT8n").Buffer;function o(t){var e,r;const n=new(0,i.BufferWriter);n.writeUInt32(t.getGlobalTxVersion());const o=!!t.getInputWitnessUtxo(0);o&&n.writeSlice(s.from([0,1]));const u=t.getGlobalInputCount();n.writeVarInt(u);const a=new(0,i.BufferWriter);for(let r=0;r<u;r++)n.writeSlice(t.getInputPreviousTxid(r)),n.writeUInt32(t.getInputOutputIndex(r)),n.writeVarSlice(null!==(e=t.getInputFinalScriptsig(r))&&void 0!==e?e:s.from([])),n.writeUInt32(t.getInputSequence(r)),o&&a.writeSlice(t.getInputFinalScriptwitness(r));const h=t.getGlobalOutputCount();n.writeVarInt(h);for(let e=0;e<h;e++)n.writeUInt64(t.getOutputAmount(e)),n.writeVarSlice(t.getOutputScript(e));return n.writeSlice(a.buffer()),n.writeUInt32(null!==(r=t.getGlobalFallbackLocktime())&&void 0!==r?r:0),n.buffer()}})),r.register("5qLu8",(function(e,n){t(e.exports,"finalize",(function(){return u}));var i=r("gpQhj"),s=r("ev3OL"),o=r("6rT8n").Buffer;function u(t){const e=t.getGlobalInputCount();for(let r=0;r<e;r++){const e=t.getInputKeyDatas(r,s.psbtIn.PARTIAL_SIG),n=t.getInputTapKeySig(r);if(0==e.length&&!n)throw Error(`No signature for input ${r} present`);if(e.length>0){if(e.length>1)throw Error(`Expected exactly one signature, got ${e.length}`);if(n)throw Error("Both taproot and non-taproot signatures present.");const s=!!t.getInputWitnessUtxo(r),o=t.getInputRedeemScript(r),u=!!o,a=t.getInputPartialSig(r,e[0]);if(!a)throw new Error("Expected partial signature for input "+r);if(s){const n=new(0,i.BufferWriter);if(n.writeVarInt(2),n.writeVarInt(a.length),n.writeSlice(a),n.writeVarInt(e[0].length),n.writeSlice(e[0]),t.setInputFinalScriptwitness(r,n.buffer()),u){if(!o||0==o.length)throw new Error("Expected non-empty redeemscript. Can't finalize intput "+r);const e=new(0,i.BufferWriter);e.writeUInt8(o.length),e.writeSlice(o),t.setInputFinalScriptsig(r,e.buffer())}}else{const n=new(0,i.BufferWriter);h(n,a),h(n,e[0]),t.setInputFinalScriptsig(r,n.buffer())}}else{const e=t.getInputTapKeySig(r);if(!e)throw Error("No taproot signature found");if(64!=e.length&&65!=e.length)throw Error("Unexpected length of schnorr signature.");const n=new(0,i.BufferWriter);n.writeVarInt(1),n.writeVarSlice(e),t.setInputFinalScriptwitness(r,n.buffer())}a(t,r)}}function a(t,e){const r=[s.psbtIn.BIP32_DERIVATION,s.psbtIn.PARTIAL_SIG,s.psbtIn.TAP_BIP32_DERIVATION,s.psbtIn.TAP_KEY_SIG],n=!!t.getInputWitnessUtxo(e),i=!!t.getInputNonWitnessUtxo(e);n&&i&&r.push(s.psbtIn.NON_WITNESS_UTXO),t.deleteInputEntries(e,r)}function h(t,e){if(e.length<=75)t.writeUInt8(e.length);else if(e.length<=256)t.writeUInt8(76),t.writeUInt8(e.length);else if(e.length<=65536){t.writeUInt8(77);const r=o.alloc(2);r.writeUInt16LE(e.length,0),t.writeSlice(r)}t.writeSlice(e)}})),r.register("ev3OL",(function(e,n){t(e.exports,"psbtIn",(function(){return o})),t(e.exports,"PsbtV2",(function(){return d}));var i,s,o,u,a,h,p=r("gpQhj"),c=r("6rT8n").Buffer;(s=i||(i={}))[s.TX_VERSION=2]="TX_VERSION",s[s.FALLBACK_LOCKTIME=3]="FALLBACK_LOCKTIME",s[s.INPUT_COUNT=4]="INPUT_COUNT",s[s.OUTPUT_COUNT=5]="OUTPUT_COUNT",s[s.TX_MODIFIABLE=6]="TX_MODIFIABLE",s[s.VERSION=251]="VERSION",(u=o||(o={}))[u.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",u[u.WITNESS_UTXO=1]="WITNESS_UTXO",u[u.PARTIAL_SIG=2]="PARTIAL_SIG",u[u.SIGHASH_TYPE=3]="SIGHASH_TYPE",u[u.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",u[u.BIP32_DERIVATION=6]="BIP32_DERIVATION",u[u.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",u[u.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",u[u.PREVIOUS_TXID=14]="PREVIOUS_TXID",u[u.OUTPUT_INDEX=15]="OUTPUT_INDEX",u[u.SEQUENCE=16]="SEQUENCE",u[u.TAP_KEY_SIG=19]="TAP_KEY_SIG",u[u.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION",(h=a||(a={}))[h.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",h[h.BIP_32_DERIVATION=2]="BIP_32_DERIVATION",h[h.AMOUNT=3]="AMOUNT",h[h.SCRIPT=4]="SCRIPT",h[h.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION";const l=c.from([112,115,98,116,255]);class f extends Error{}class d{setGlobalTxVersion(t){this.setGlobal(i.TX_VERSION,S(t))}getGlobalTxVersion(){return this.getGlobal(i.TX_VERSION).readUInt32LE(0)}setGlobalFallbackLocktime(t){this.setGlobal(i.FALLBACK_LOCKTIME,S(t))}getGlobalFallbackLocktime(){var t;return null===(t=this.getGlobalOptional(i.FALLBACK_LOCKTIME))||void 0===t?void 0:t.readUInt32LE(0)}setGlobalInputCount(t){this.setGlobal(i.INPUT_COUNT,b(t))}getGlobalInputCount(){return I(this.getGlobal(i.INPUT_COUNT))}setGlobalOutputCount(t){this.setGlobal(i.OUTPUT_COUNT,b(t))}getGlobalOutputCount(){return I(this.getGlobal(i.OUTPUT_COUNT))}setGlobalTxModifiable(t){this.setGlobal(i.TX_MODIFIABLE,t)}getGlobalTxModifiable(){return this.getGlobalOptional(i.TX_MODIFIABLE)}setGlobalPsbtVersion(t){this.setGlobal(i.VERSION,S(t))}getGlobalPsbtVersion(){return this.getGlobal(i.VERSION).readUInt32LE(0)}setInputNonWitnessUtxo(t,e){this.setInput(t,o.NON_WITNESS_UTXO,_(),e)}getInputNonWitnessUtxo(t){return this.getInputOptional(t,o.NON_WITNESS_UTXO,_())}setInputWitnessUtxo(t,e,r){const n=new(0,p.BufferWriter);n.writeSlice(e),n.writeVarSlice(r),this.setInput(t,o.WITNESS_UTXO,_(),n.buffer())}getInputWitnessUtxo(t){const e=this.getInputOptional(t,o.WITNESS_UTXO,_());if(!e)return;const r=new(0,p.BufferReader)(e);return{amount:r.readSlice(8),scriptPubKey:r.readVarSlice()}}setInputPartialSig(t,e,r){this.setInput(t,o.PARTIAL_SIG,e,r)}getInputPartialSig(t,e){return this.getInputOptional(t,o.PARTIAL_SIG,e)}setInputSighashType(t,e){this.setInput(t,o.SIGHASH_TYPE,_(),S(e))}getInputSighashType(t){const e=this.getInputOptional(t,o.SIGHASH_TYPE,_());if(e)return e.readUInt32LE(0)}setInputRedeemScript(t,e){this.setInput(t,o.REDEEM_SCRIPT,_(),e)}getInputRedeemScript(t){return this.getInputOptional(t,o.REDEEM_SCRIPT,_())}setInputBip32Derivation(t,e,r,n){if(33!=e.length)throw new Error("Invalid pubkey length: "+e.length);this.setInput(t,o.BIP32_DERIVATION,e,this.encodeBip32Derivation(r,n))}getInputBip32Derivation(t,e){const r=this.getInputOptional(t,o.BIP32_DERIVATION,e);if(r)return this.decodeBip32Derivation(r)}setInputFinalScriptsig(t,e){this.setInput(t,o.FINAL_SCRIPTSIG,_(),e)}getInputFinalScriptsig(t){return this.getInputOptional(t,o.FINAL_SCRIPTSIG,_())}setInputFinalScriptwitness(t,e){this.setInput(t,o.FINAL_SCRIPTWITNESS,_(),e)}getInputFinalScriptwitness(t){return this.getInput(t,o.FINAL_SCRIPTWITNESS,_())}setInputPreviousTxId(t,e){this.setInput(t,o.PREVIOUS_TXID,_(),e)}getInputPreviousTxid(t){return this.getInput(t,o.PREVIOUS_TXID,_())}setInputOutputIndex(t,e){this.setInput(t,o.OUTPUT_INDEX,_(),S(e))}getInputOutputIndex(t){return this.getInput(t,o.OUTPUT_INDEX,_()).readUInt32LE(0)}setInputSequence(t,e){this.setInput(t,o.SEQUENCE,_(),S(e))}getInputSequence(t){var e,r;return null!==(r=null===(e=this.getInputOptional(t,o.SEQUENCE,_()))||void 0===e?void 0:e.readUInt32LE(0))&&void 0!==r?r:4294967295}setInputTapKeySig(t,e){this.setInput(t,o.TAP_KEY_SIG,_(),e)}getInputTapKeySig(t){return this.getInputOptional(t,o.TAP_KEY_SIG,_())}setInputTapBip32Derivation(t,e,r,n,i){if(32!=e.length)throw new Error("Invalid pubkey length: "+e.length);const s=this.encodeTapBip32Derivation(r,n,i);this.setInput(t,o.TAP_BIP32_DERIVATION,e,s)}getInputTapBip32Derivation(t,e){const r=this.getInput(t,o.TAP_BIP32_DERIVATION,e);return this.decodeTapBip32Derivation(r)}getInputKeyDatas(t,e){return this.getKeyDatas(this.inputMaps[t],e)}setOutputRedeemScript(t,e){this.setOutput(t,a.REDEEM_SCRIPT,_(),e)}getOutputRedeemScript(t){return this.getOutput(t,a.REDEEM_SCRIPT,_())}setOutputBip32Derivation(t,e,r,n){this.setOutput(t,a.BIP_32_DERIVATION,e,this.encodeBip32Derivation(r,n))}getOutputBip32Derivation(t,e){const r=this.getOutput(t,a.BIP_32_DERIVATION,e);return this.decodeBip32Derivation(r)}setOutputAmount(t,e){var r;this.setOutput(t,a.AMOUNT,_(),(r=e,(0,p.unsafeTo64bitLE)(r)))}getOutputAmount(t){const e=this.getOutput(t,a.AMOUNT,_());return(0,p.unsafeFrom64bitLE)(e)}setOutputScript(t,e){this.setOutput(t,a.SCRIPT,_(),e)}getOutputScript(t){return this.getOutput(t,a.SCRIPT,_())}setOutputTapBip32Derivation(t,e,r,n,i){const s=this.encodeTapBip32Derivation(r,n,i);this.setOutput(t,a.TAP_BIP32_DERIVATION,e,s)}getOutputTapBip32Derivation(t,e){const r=this.getOutput(t,a.TAP_BIP32_DERIVATION,e);return this.decodeTapBip32Derivation(r)}deleteInputEntries(t,e){this.inputMaps[t].forEach(((t,r,n)=>{this.isKeyType(r,e)&&n.delete(r)}))}copy(t){this.copyMap(this.globalMap,t.globalMap),this.copyMaps(this.inputMaps,t.inputMaps),this.copyMaps(this.outputMaps,t.outputMaps)}copyMaps(t,e){t.forEach(((t,r)=>{const n=new Map;this.copyMap(t,n),e[r]=n}))}copyMap(t,e){t.forEach(((t,r)=>e.set(r,c.from(t))))}serialize(){const t=new(0,p.BufferWriter);return t.writeSlice(c.from([112,115,98,116,255])),v(t,this.globalMap),this.inputMaps.forEach((e=>{v(t,e)})),this.outputMaps.forEach((e=>{v(t,e)})),t.buffer()}deserialize(t){const e=new(0,p.BufferReader)(t);if(!e.readSlice(5).equals(l))throw new Error("Invalid magic bytes");for(;this.readKeyPair(this.globalMap,e););for(let t=0;t<this.getGlobalInputCount();t++)for(this.inputMaps[t]=new Map;this.readKeyPair(this.inputMaps[t],e););for(let t=0;t<this.getGlobalOutputCount();t++)for(this.outputMaps[t]=new Map;this.readKeyPair(this.outputMaps[t],e););}readKeyPair(t,e){const r=e.readVarInt();if(0==r)return!1;return E(t,e.readUInt8(),e.readSlice(r-1),e.readVarSlice()),!0}getKeyDatas(t,e){const r=[];return t.forEach(((t,n)=>{this.isKeyType(n,[e])&&r.push(c.from(n.substring(2),"hex"))})),r}isKeyType(t,e){const r=c.from(t.substring(0,2),"hex").readUInt8(0);return e.some((t=>t==r))}setGlobal(t,e){const r=new m(t,c.from([]));this.globalMap.set(r.toString(),e)}getGlobal(t){return g(this.globalMap,t,_(),!1)}getGlobalOptional(t){return g(this.globalMap,t,_(),!0)}setInput(t,e,r,n){E(this.getMap(t,this.inputMaps),e,r,n)}getInput(t,e,r){return g(this.inputMaps[t],e,r,!1)}getInputOptional(t,e,r){return g(this.inputMaps[t],e,r,!0)}setOutput(t,e,r,n){E(this.getMap(t,this.outputMaps),e,r,n)}getOutput(t,e,r){return g(this.outputMaps[t],e,r,!1)}getMap(t,e){return e[t]?e[t]:e[t]=new Map}encodeBip32Derivation(t,e){const r=new(0,p.BufferWriter);return this.writeBip32Derivation(r,t,e),r.buffer()}decodeBip32Derivation(t){const e=new(0,p.BufferReader)(t);return this.readBip32Derivation(e)}writeBip32Derivation(t,e,r){t.writeSlice(e),r.forEach((e=>{t.writeUInt32(e)}))}readBip32Derivation(t){const e=t.readSlice(4),r=[];for(;t.offset<t.buffer.length;)r.push(t.readUInt32());return{masterFingerprint:e,path:r}}encodeTapBip32Derivation(t,e,r){const n=new(0,p.BufferWriter);return n.writeVarInt(t.length),t.forEach((t=>{n.writeSlice(t)})),this.writeBip32Derivation(n,e,r),n.buffer()}decodeTapBip32Derivation(t){const e=new(0,p.BufferReader)(t),r=e.readVarInt(),n=[];for(let t=0;t<r;t++)n.push(e.readSlice(32));const i=this.readBip32Derivation(e);return Object.assign({hashes:n},i)}constructor(){this.globalMap=new Map,this.inputMaps=[],this.outputMaps=[]}}function g(t,e,r,n){if(!t)throw Error("No such map");const i=new m(e,r),s=t.get(i.toString());if(!s){if(n)return;throw new f(i.toString())}return c.from(s)}class m{toString(){const t=new(0,p.BufferWriter);return this.toBuffer(t),t.buffer().toString("hex")}serialize(t){t.writeVarInt(1+this.keyData.length),this.toBuffer(t)}toBuffer(t){t.writeUInt8(this.keyType),t.writeSlice(this.keyData)}constructor(t,e){this.keyType=t,this.keyData=e}}class w{serialize(t){this.key.serialize(t),t.writeVarSlice(this.value)}constructor(t,e){this.key=t,this.value=e}}function y(t){return new m(t.readUInt8(0),t.slice(1))}function v(t,e){for(const r of e.keys()){const n=e.get(r);new w(y(c.from(r,"hex")),n).serialize(t)}t.writeUInt8(0)}function _(){return c.from([])}function E(t,e,r,n){const i=new m(e,r);t.set(i.toString(),n)}function S(t){const e=c.alloc(4);return e.writeUInt32LE(t,0),e}function b(t){const e=new(0,p.BufferWriter);return e.writeVarInt(t),e.buffer()}function I(t){return new(0,p.BufferReader)(t).readVarInt()}})),r.register("amBTu",(function(e,n){t(e.exports,"serializeTransactionOutputs",(function(){return o})),t(e.exports,"serializeTransaction",(function(){return u}));var i=r("c2oKp"),s=r("6rT8n").Buffer;function o({outputs:t}){let e=s.alloc(0);return void 0!==t&&(e=s.concat([e,(0,i.createVarint)(t.length)]),t.forEach((t=>{e=s.concat([e,t.amount,(0,i.createVarint)(t.script.length),t.script])}))),e}function u(t,e,r,n=[]){const u=n.includes("decred"),a=n.includes("zcash"),h=n.includes("bech32");let p=s.alloc(0);const c=void 0!==t.witness&&!e;t.inputs.forEach((t=>{p=u||h?s.concat([p,t.prevout,s.from([0]),t.sequence]):s.concat([p,t.prevout,(0,i.createVarint)(t.script.length),t.script,t.sequence])}));let l=o(t);return void 0!==t.outputs&&void 0!==t.locktime&&(l=s.concat([l,c&&t.witness||s.alloc(0),t.locktime,t.nExpiryHeight||s.alloc(0),t.extraData||s.alloc(0)])),a?s.concat([t.version,t.nVersionGroupId||s.alloc(0),s.from([180,208,214,194]),t.locktime||s.from([0,0,0,0]),t.nExpiryHeight||s.from([0,0,0,0]),c?s.from("0001","hex"):s.alloc(0),(0,i.createVarint)(t.inputs.length),p,l]):s.concat([t.version,r||s.alloc(0),t.nVersionGroupId||s.alloc(0),c?s.from("0001","hex"):s.alloc(0),(0,i.createVarint)(t.inputs.length),p,l])}})),r.register("c2oKp",(function(e,n){t(e.exports,"getVarint",(function(){return s})),t(e.exports,"createVarint",(function(){return o}));var i=r("6rT8n").Buffer;function s(t,e){if(t[e]<253)return[t[e],1];if(253===t[e])return[(t[e+2]<<8)+t[e+1],3];if(254===t[e])return[(t[e+4]<<24)+(t[e+3]<<16)+(t[e+2]<<8)+t[e+1],5];throw new Error("getVarint called with unexpected parameters")}function o(t){if(t<253){const e=i.alloc(1);return e[0]=t,e}if(t<=65535){const e=i.alloc(3);return e[0]=253,e[1]=255&t,e[2]=t>>8&255,e}const e=i.alloc(5);return e[0]=254,e[1]=255&t,e[2]=t>>8&255,e[3]=t>>16&255,e[4]=t>>24&255,e}})),r.register("b7RTT",(function(n,i){t(n.exports,"default",(function(){return d}),(function(t){return d=t}));var s=r("13Nf3"),o=r("6Zmxr"),u=r("b63zp"),a=r("hK5ph"),h=r("3iLpf"),p=r("1UYdo"),c=r("kNfg6"),l=r("6rT8n").Buffer,f=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(t){s(t)}}function u(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};class d{derivatePath(t){return f(this,void 0,void 0,(function*(){if(this.derivationsCache[t])return this.derivationsCache[t];const e=yield(0,h.getWalletPublicKey)(this.transport,{path:t});return this.derivationsCache[t]=e,e}))}getWalletXpub({path:t,xpubVersion:r}){return f(this,void 0,void 0,(function*(){const n=(0,p.pathStringToArray)(t),i=n.slice(0,-1),u=yield this.derivatePath((0,p.pathArrayToString)(i)),a=yield this.derivatePath(t),h=(c=m(l.from(u.publicKey,"hex")),(f=c,function(t){return(new(e(o))).update(t).digest()}(w(f))).slice(0,4));var c,f;const d=function(t,r,n,i,o,u){const a=g(i);a[0]|=128;const h=l.concat([g(t),l.from([r]),n,a,o,u]),p=function(t){return w(w(t))}(h).slice(0,4);return e(s).encode(l.concat([h,p]))}(r,n.length,h,n[n.length-1],l.from(a.chainCode,"hex"),m(l.from(a.publicKey,"hex")));return d}))}getWalletPublicKey(t,e){if("bech32m"===(null==e?void 0:e.format))throw new Error("Unsupported address format bech32m");return(0,h.getWalletPublicKey)(this.transport,Object.assign(Object.assign({},e),{path:t}))}createPaymentTransaction(t){if(arguments.length>1)throw new Error("@ledgerhq/hw-app-btc: createPaymentTransaction multi argument signature is deprecated. please switch to named parameters.");return(0,a.createTransaction)(this.transport,t)}signMessage({path:t,messageHex:e}){return f(this,void 0,void 0,(function*(){return(0,c.signMessage)(this.transport,{path:t,messageHex:e})}))}constructor(t){this.transport=t,this.derivationsCache={}}}function g(t){const e=l.allocUnsafe(4);return e.writeUInt32BE(t,0),e}const m=t=>l.concat([l.from([2+(1&t[64])]),t.slice(1,33)]);function w(t){return e(u)("sha256").update(t).digest()}})),r.register("hK5ph",(function(e,n){t(e.exports,"createTransaction",(function(){return _}),(function(t){return _=t}));var i=r("krsE8"),s=r("bKZ1C"),o=r("3iLpf"),u=r("4EYNL"),a=r("1qqBa"),h=r("amBTu"),p=r("7c6Jb"),c=r("himsU"),l=r("dbidG"),f=r("dFxAf"),d=r("7tTKx"),g=r("1hle7"),m=r("5Z16Q"),w=r("6rT8n").Buffer,y=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(t){s(t)}}function u(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};const v={lockTime:g.DEFAULT_LOCKTIME,sigHashType:g.SIGHASH_ALL,segwit:!1,additionals:[],onDeviceStreaming:t=>{},onDeviceSignatureGranted:()=>{},onDeviceSignatureRequested:()=>{}};function _(t,e){return y(this,void 0,void 0,(function*(){const r=Object.assign(Object.assign({},v),e),{inputs:n,associatedKeysets:y,changePath:_,outputScriptHex:E,lockTime:S,sigHashType:b,segwit:I,initialTimestamp:T,additionals:P,expiryHeight:O,onDeviceStreaming:M,onDeviceSignatureGranted:x,onDeviceSignatureRequested:k}=r;let A=r.useTrustedInputForSegwit;if(void 0===A)try{const e=yield(0,d.getAppAndVersion)(t);A=(0,m.shouldUseTrustedInputForSegwit)(e)}catch(t){if(27904!==t.statusCode)throw t;A=!1}const U=(t,e)=>{const{length:r}=n;if(r<3)return;const i=r*t+e,s=2*r;M({progress:i/s,total:s,index:i})},N=P.includes("decred"),B=P.includes("zcash"),H=P.includes("stealthcoin"),R=Date.now(),C=P.includes("sapling"),L=I&&P.includes("bech32"),D=I||!!P&&(P.includes("abc")||P.includes("gold")||P.includes("bip143"))||!!O&&!N,K=w.alloc(4);K.writeUInt32LE(S,0);const q=w.alloc(0),W=w.alloc(0),F=w.alloc(4);O&&!N?F.writeUInt32LE(B?2147483653:C?2147483652:2147483651,0):H?F.writeUInt32LE(2,0):F.writeUInt32LE(1,0);const V=[],G=[],j=[],X=[];let $=!0;const z={inputs:[],version:F,timestamp:w.alloc(0)},Y=D&&!A?p.getTrustedInputBIP143:u.getTrustedInput,Q=w.from(E,"hex");U(0,0);for(const e of n){{const r=yield Y(t,e[1],e[0],P);(0,i.log)("hw","got trustedInput="+r);const n=w.alloc(4);n.writeUInt32LE(e.length>=4&&"number"==typeof e[3]?e[3]:g.DEFAULT_SEQUENCE,0),V.push({trustedInput:!0,value:w.from(r,"hex"),sequence:n})}const{outputs:r}=e[0],n=e[1];r&&n<=r.length-1&&G.push(r[n]),O&&!N?(z.nVersionGroupId=w.from(B?[10,39,167,38]:C?[133,32,47,137]:[112,130,196,3]),z.nExpiryHeight=O,z.extraData=w.from(C?[0,0,0,0,0,0,0,0,0,0,0]:[0])):N&&(z.nExpiryHeight=O)}z.inputs=n.map(((t,e)=>{const r=w.alloc(4);return r.writeUInt32LE(t.length>=4&&"number"==typeof t[3]?t[3]:g.DEFAULT_SEQUENCE,0),{script:B?G[e].script:q,prevout:W,sequence:r}}));{const e=[];for(let r=0;r<n.length;r++){const n=yield(0,o.getWalletPublicKey)(t,{path:y[r]});U(0,r+1),e.push(n)}for(let t=0;t<e.length;t++)X.push((0,c.compressPublicKey)(w.from(e[t].publicKey,"hex")))}void 0!==T&&(z.timestamp=w.alloc(4),z.timestamp.writeUInt32LE(Math.floor(T+(Date.now()-R)/1e3),0)),k(),D&&(yield(0,a.startUntrustedHashTransactionInput)(t,!0,z,V,!0,!!O,P,A),_&&(yield(0,f.provideOutputFullChangePath)(t,_)),yield(0,f.hashOutputFull)(t,Q)),O&&!N&&(yield(0,l.signTransaction)(t,"",S,g.SIGHASH_ALL,O));for(let e=0;e<n.length;e++){const r=n[e],i=n[e].length>=3&&"string"==typeof r[2]?w.from(r[2],"hex"):I?w.concat([w.from([g.OP_DUP,g.OP_HASH160,g.HASH_SIZE]),(0,s.hashPublicKey)(X[e]),w.from([g.OP_EQUALVERIFY,g.OP_CHECKSIG])]):G[e].script,o=Object.assign({},z),u=D?[V[e]]:V;D?o.inputs=[Object.assign(Object.assign({},o.inputs[e]),{script:i})]:o.inputs[e].script=i,yield(0,a.startUntrustedHashTransactionInput)(t,!D&&$,o,u,D,!!O&&!N,P,A),D||(_&&(yield(0,f.provideOutputFullChangePath)(t,_)),yield(0,f.hashOutputFull)(t,Q,P)),$&&(x(),U(1,0));const h=yield(0,l.signTransaction)(t,y[e],S,b,O,P);U(1,e+1),j.push(h),z.inputs[e].script=q,$&&($=!1)}for(let t=0;t<n.length;t++){if(I)z.witness=w.alloc(0),L||(z.inputs[t].script=w.concat([w.from("160014","hex"),(0,s.hashPublicKey)(X[t])]));else{const e=w.alloc(1),r=w.alloc(1);e[0]=j[t].length,r[0]=X[t].length,z.inputs[t].script=w.concat([e,j[t],r,X[t]])}const e=D&&!A?0:4;z.inputs[t].prevout=V[t].value.slice(e,e+36)}z.locktime=K;let J=w.concat([(0,h.serializeTransaction)(z,!1,z.timestamp,P),Q]);if(I&&!N){let t=w.alloc(0);for(let e=0;e<n.length;e++){const r=w.concat([w.from("02","hex"),w.from([j[e].length]),j[e],w.from([X[e].length]),X[e]]);t=w.concat([t,r])}J=w.concat([J,t])}if(B||(J=w.concat([J,K]),O&&(J=w.concat([J,z.nExpiryHeight||w.alloc(0),z.extraData||w.alloc(0)]))),N){let t=w.from([z.inputs.length]);n.forEach(((e,r)=>{t=w.concat([t,w.from([0,0,0,0,0,0,0,0]),w.from([0,0,0,0]),w.from([255,255,255,255]),w.from([z.inputs[r].script.length]),z.inputs[r].script])})),J=w.concat([J,t])}return B&&(J=w.concat([J,w.from([0,0,0])])),J.toString("hex")}))}})),r.register("krsE8",(function(e,r){t(e.exports,"log",(function(){return s}));var n=0,i=[],s=function(t,e,r){var s={type:t,id:String(++n),date:new Date};e&&(s.message=e),r&&(s.data=r),function(t){for(var e=0;e<i.length;e++)try{i[e](t)}catch(t){console.error(t)}}(s)};"undefined"!=typeof window&&(window.__ledgerLogsListen=function(t){return i.push(t),function(){var e=i.indexOf(t);-1!==e&&(i[e]=i[i.length-1],i.pop())}})})),r.register("3iLpf",(function(e,n){t(e.exports,"getWalletPublicKey",(function(){return u}),(function(t){return u=t}));var i=r("1UYdo"),s=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(t){s(t)}}function u(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};const o={legacy:0,p2sh:1,bech32:2,cashaddr:3};function u(t,e){return s(this,void 0,void 0,(function*(){const{path:r,verify:n,format:s}=Object.assign({verify:!1,format:"legacy"},e);if(!(s in o))throw new Error("btc.getWalletPublicKey invalid format="+s);const u=(0,i.bip32asBuffer)(r),a=n?1:0,h=o[s],p=yield t.send(224,64,a,h,u),c=p[0],l=p[1+c];return{publicKey:p.slice(1,1+c).toString("hex"),bitcoinAddress:p.slice(1+c+1,1+c+1+l).toString("ascii"),chainCode:p.slice(1+c+1+l,1+c+1+l+32).toString("hex")}}))}})),r.register("4EYNL",(function(n,i){t(n.exports,"getTrustedInput",(function(){return c}),(function(t){return c=t}));var s=r("4J41B"),o=r("1hle7"),u=r("c2oKp"),a=r("6rT8n").Buffer,h=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(t){s(t)}}function u(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};function p(t,e,r){return h(this,void 0,void 0,(function*(){let n,i=!1;if("number"==typeof r){i=!0;const t=a.alloc(4);t.writeUInt32BE(r,0),n=a.concat([t,e],e.length+4)}else n=e;const s=yield t.send(224,66,i?0:128,0,n);return s.slice(0,s.length-2).toString("hex")}))}function c(t,r,n,i=[]){return h(this,void 0,void 0,(function*(){const{version:c,inputs:l,outputs:f,locktime:d,nExpiryHeight:g,extraData:m}=n;if(!f||!d)throw new Error("getTrustedInput: locktime & outputs is expected");const w=i.includes("decred"),y=i.includes("stealthcoin"),v=(e,r)=>h(this,void 0,void 0,(function*(){const n=r||a.alloc(0),i=[];let s,u=0;for(;u!==e.length;){const t=e.length-u>o.MAX_SCRIPT_BLOCK?o.MAX_SCRIPT_BLOCK:e.length-u;u+t!==e.length?i.push(e.slice(u,u+t)):i.push(a.concat([e.slice(u,u+t),n])),u+=t}0===e.length&&i.push(n);for(const e of i)s=yield p(t,e);return s})),_=e=>p(t,e);yield p(t,a.concat([n.version,n.timestamp||a.alloc(0),n.nVersionGroupId||a.alloc(0),(0,u.createVarint)(l.length)]),r);for(const e of l){const r=y&&0===a.compare(c,a.from([2,0,0,0])),n=w?e.tree||a.from([0]):a.alloc(0),i=a.concat([e.prevout,n,r?a.from([0]):(0,u.createVarint)(e.script.length)]);yield p(t,i),yield w?_(a.concat([e.script,e.sequence])):r?_(e.sequence):v(e.script,e.sequence)}yield p(t,(0,u.createVarint)(f.length));for(const e of f){const r=a.concat([e.amount,w?a.from([0,0]):a.alloc(0),(0,u.createVarint)(e.script.length),e.script]);yield p(t,r)}const E=[];let S;if(g&&g.length>0&&E.push(g),m&&m.length>0&&E.push(m),E.length){const t=a.concat(E);S=w?t:a.concat([(0,u.createVarint)(t.length),t])}const b=yield v(a.concat([d,S||a.alloc(0)]));return e(s)(b,"missing result in processScriptBlocks"),b}))}})),r.register("4J41B",(function(t,e){t.exports=function(t,e,r,n,i,s,o,u){if(!t){var a;if(void 0===e)a=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var h=[r,n,i,s,o,u],p=0;(a=new Error(e.replace(/%s/g,(function(){return h[p++]})))).name="Invariant Violation"}throw a.framesToPop=1,a}}})),r.register("1qqBa",(function(e,n){t(e.exports,"startUntrustedHashTransactionInput",(function(){return h}),(function(t){return h=t}));var i=r("c2oKp"),s=r("1hle7"),o=r("6rT8n").Buffer,u=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(t){s(t)}}function u(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};function a(t,e,r,n,i=!1,s=!1,o=[]){const u=o.includes("cashaddr")?3:i?o.includes("sapling")?5:s?4:2:0;return t.send(224,68,r?0:128,e?u:128,n)}function h(t,e,r,n,h=!1,p=!1,c=[],l=!1){return u(this,void 0,void 0,(function*(){let u=o.concat([r.version,r.timestamp||o.alloc(0),r.nVersionGroupId||o.alloc(0),(0,i.createVarint)(r.inputs.length)]);yield a(t,e,!0,u,h,p,c);let f=0;const d=c.includes("decred");for(const g of r.inputs){let r;const m=n[f].value;r=h?l&&n[f].trustedInput?o.from([1,m.length]):o.from([2]):n[f].trustedInput?o.from([1,n[f].value.length]):o.from([0]),u=o.concat([r,m,d?o.from([0]):o.alloc(0),(0,i.createVarint)(g.script.length)]),yield a(t,e,!1,u,h,p,c);const w=[];let y=0;if(0===g.script.length)w.push(g.sequence);else for(;y!==g.script.length;){const t=g.script.length-y>s.MAX_SCRIPT_BLOCK?s.MAX_SCRIPT_BLOCK:g.script.length-y;y+t!==g.script.length?w.push(g.script.slice(y,y+t)):w.push(o.concat([g.script.slice(y,y+t),g.sequence])),y+=t}for(const r of w)yield a(t,e,!1,r,h,p,c);f++}}))}})),r.register("7c6Jb",(function(n,i){t(n.exports,"getTrustedInputBIP143",(function(){return a}));var s=r("b63zp"),o=r("amBTu"),u=r("6rT8n").Buffer;function a(t,r,n,i=[]){if(!n)throw new Error("getTrustedInputBIP143: missing tx");if(i.includes("decred"))throw new Error("Decred does not implement BIP143");let a=e(s)("sha256").update(e(s)("sha256").update((0,o.serializeTransaction)(n,!0)).digest()).digest();const h=u.alloc(4);h.writeUInt32LE(r,0);const{outputs:p,locktime:c}=n;if(!p||!c)throw new Error("getTrustedInputBIP143: locktime & outputs is expected");if(!p[r])throw new Error("getTrustedInputBIP143: wrong index");return a=u.concat([a,h,p[r].amount]),a.toString("hex")}})),r.register("himsU",(function(e,n){t(e.exports,"compressPublicKey",(function(){return s}));var i=r("6rT8n").Buffer;function s(t){const e=0!=(1&t[64])?3:2,r=i.alloc(1);return r[0]=e,i.concat([r,t.slice(1,33)])}})),r.register("dbidG",(function(e,n){t(e.exports,"signTransaction",(function(){return o}));var i=r("1UYdo"),s=r("6rT8n").Buffer;function o(t,e,r,n,o,u=[]){const a=u.includes("decred"),h=(0,i.bip32asBuffer)(e),p=s.alloc(4);p.writeUInt32BE(r,0);let c=a?s.concat([h,p,o||s.from([0,0,0,0]),s.from([n])]):s.concat([h,s.from([0]),p,s.from([n])]);return o&&!a&&(c=s.concat([c,o])),t.send(224,72,0,0,c).then((t=>t.length>0?(t[0]=48,t.slice(0,t.length-2)):t))}})),r.register("dFxAf",(function(e,n){t(e.exports,"provideOutputFullChangePath",(function(){return u}),(function(t){return u=t})),t(e.exports,"hashOutputFull",(function(){return a}),(function(t){return a=t}));var i=r("1UYdo"),s=r("1hle7"),o=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(t){s(t)}}function u(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};function u(t,e){const r=(0,i.bip32asBuffer)(e);return t.send(224,74,255,0,r)}function a(t,e,r=[]){return o(this,void 0,void 0,(function*(){let n=0;const i=Number(128);if(r.includes("decred"))return t.send(224,74,i,0,e);for(;n<e.length;){const r=n+s.MAX_SCRIPT_BLOCK>=e.length?e.length-n:s.MAX_SCRIPT_BLOCK,i=n+r===e.length?128:0,o=e.slice(n,n+r);yield t.send(224,74,i,0,o),n+=r}}))}})),r.register("7tTKx",(function(n,i){t(n.exports,"getAppAndVersion",(function(){return u}),(function(t){return u=t})),t(n.exports,"checkIsBtcLegacy",(function(){return a}),(function(t){return a=t}));var s=r("4J41B"),o=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(t){s(t)}}function u(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};const u=t=>o(void 0,void 0,void 0,(function*(){const r=yield t.send(176,1,0,0);let n=0;const i=r[n++];e(s)(1===i,"getAppAndVersion: format not supported");const o=r[n++],u=r.slice(n,n+=o).toString("ascii"),a=r[n++],h=r.slice(n,n+=a).toString("ascii"),p=r[n++];return{name:u,version:h,flags:r.slice(n,n+=p)}})),a=t=>o(void 0,void 0,void 0,(function*(){try{yield t.send(224,196,0,0)}catch(t){return!1}return!0}))})),r.register("5Z16Q",(function(n,i){t(n.exports,"shouldUseTrustedInputForSegwit",(function(){return o}));var s=r("3sixR");function o({version:t,name:r}){return"Decred"!==r&&("Exchange"===r||e(s).gte(t,"1.4.0"))}})),r.register("kNfg6",(function(n,i){t(n.exports,"signMessage",(function(){return h}),(function(t){return h=t}));var s=r("9UXyL"),o=r("1hle7"),u=r("6rT8n").Buffer,a=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(t){s(t)}}function u(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};function h(t,{path:r,messageHex:n}){return a(this,void 0,void 0,(function*(){const i=e(s).fromString(r).toPathArray(),a=u.from(n,"hex");let h=0;for(;h!==a.length;){const e=0===h?o.MAX_SCRIPT_BLOCK-1-4*i.length-4:o.MAX_SCRIPT_BLOCK,r=h+e>a.length?a.length-h:e,n=u.alloc(0===h?1+4*i.length+2+r:r);0===h?(n[0]=i.length,i.forEach(((t,e)=>{n.writeUInt32BE(t,1+4*e)})),n.writeUInt16BE(a.length,1+4*i.length),a.copy(n,1+4*i.length+2,h,h+r)):a.copy(n,0,h,h+r),yield t.send(224,78,0,0===h?1:128,n),h+=r}const p=yield t.send(224,78,128,0,u.from([0])),c=p[0]-48;let l=p.slice(4,4+p[3]);0===l[0]&&(l=l.slice(1)),l=l.toString("hex"),h=4+p[3]+2;let f=p.slice(h,h+p[h-1]);return 0===f[0]&&(f=f.slice(1)),f=f.toString("hex"),{v:c,r:l,s:f}}))}})),r.register("hYnBn",(function(e,n){t(e.exports,"AppClient",(function(){return g}),(function(t){return g=t}));var i=r("1UYdo"),s=r("hhRhE"),o=r("9RELh"),u=r("c2oKp"),a=r("eIDCs"),h=r("6rT8n").Buffer,p=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(t){s(t)}}function u(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};var c,l,f,d;(l=c||(c={}))[l.GET_PUBKEY=0]="GET_PUBKEY",l[l.REGISTER_WALLET=2]="REGISTER_WALLET",l[l.GET_WALLET_ADDRESS=3]="GET_WALLET_ADDRESS",l[l.SIGN_PSBT=4]="SIGN_PSBT",l[l.GET_MASTER_FINGERPRINT=5]="GET_MASTER_FINGERPRINT",l[l.SIGN_MESSAGE=16]="SIGN_MESSAGE",(d=f||(f={}))[d.CONTINUE_INTERRUPTED=1]="CONTINUE_INTERRUPTED";class g{makeRequest(t,e,r){return p(this,void 0,void 0,(function*(){let n=yield this.transport.send(225,t,0,0,e,[36864,57344]);for(;57344===n.readUInt16BE(n.length-2);){if(!r)throw new Error("Unexpected SW_INTERRUPTED_EXECUTION");const t=n.slice(0,-2),e=r.execute(t);n=yield this.transport.send(248,f.CONTINUE_INTERRUPTED,0,0,e,[36864,57344])}return n.slice(0,-2)}))}getExtendedPubkey(t,e){return p(this,void 0,void 0,(function*(){if(e.length>6)throw new Error("Path too long. At most 6 levels allowed.");return(yield this.makeRequest(c.GET_PUBKEY,h.concat([h.from(t?[1]:[0]),(0,i.pathElementsToBuffer)(e)]))).toString("ascii")}))}getWalletAddress(t,e,r,n,i){return p(this,void 0,void 0,(function*(){if(0!==r&&1!==r)throw new Error("Change can only be 0 or 1");if(n<0||!Number.isInteger(n))throw new Error("Invalid address index");if(null!=e&&32!=e.length)throw new Error("Invalid HMAC length");const s=new(0,o.ClientCommandInterpreter)((()=>{}));s.addKnownList(t.keys.map((t=>h.from(t,"ascii")))),s.addKnownPreimage(t.serialize());const u=h.alloc(4);u.writeUInt32BE(n,0);return(yield this.makeRequest(c.GET_WALLET_ADDRESS,h.concat([h.from(i?[1]:[0]),t.getWalletId(),e||h.alloc(32,0),h.from([r]),u]),s)).toString("ascii")}))}signPsbt(t,e,r,n){return p(this,void 0,void 0,(function*(){const i=new(0,s.MerkelizedPsbt)(t);if(null!=r&&32!=r.length)throw new Error("Invalid HMAC length");const p=new(0,o.ClientCommandInterpreter)(n);p.addKnownList(e.keys.map((t=>h.from(t,"ascii")))),p.addKnownPreimage(e.serialize()),p.addKnownMapping(i.globalMerkleMap);for(const t of i.inputMerkleMaps)p.addKnownMapping(t);for(const t of i.outputMerkleMaps)p.addKnownMapping(t);p.addKnownList(i.inputMapCommitments);const l=new(0,a.Merkle)(i.inputMapCommitments.map((t=>(0,a.hashLeaf)(t)))).getRoot();p.addKnownList(i.outputMapCommitments);const f=new(0,a.Merkle)(i.outputMapCommitments.map((t=>(0,a.hashLeaf)(t)))).getRoot();yield this.makeRequest(c.SIGN_PSBT,h.concat([i.getGlobalKeysValuesRoot(),(0,u.createVarint)(i.getGlobalInputCount()),l,(0,u.createVarint)(i.getGlobalOutputCount()),f,e.getWalletId(),r||h.alloc(32,0)]),p);const d=p.getYielded(),g=new Map;for(const t of d)g.set(t[0],t.slice(1));return g}))}getMasterFingerprint(){return p(this,void 0,void 0,(function*(){return this.makeRequest(c.GET_MASTER_FINGERPRINT,h.from([]))}))}signMessage(t,e){return p(this,void 0,void 0,(function*(){if(e.length>6)throw new Error("Path too long. At most 6 levels allowed.");const r=new(0,o.ClientCommandInterpreter)((()=>{})),n=Math.ceil(t.length/64),s=[];for(let e=0;e<n;e++)s.push(t.subarray(64*e,64*e+64));r.addKnownList(s);const p=new(0,a.Merkle)(s.map((t=>(0,a.hashLeaf)(t)))).getRoot();return(yield this.makeRequest(c.SIGN_MESSAGE,h.concat([(0,i.pathElementsToBuffer)(e),(0,u.createVarint)(t.length),p]),r)).toString("base64")}))}constructor(t){this.transport=t}}})),r.register("hhRhE",(function(e,n){t(e.exports,"MerkelizedPsbt",(function(){return u}));var i=r("4z4rn"),s=r("ev3OL"),o=r("6rT8n").Buffer;class u extends s.PsbtV2{getGlobalSize(){return this.globalMap.size}getGlobalKeysValuesRoot(){return this.globalMerkleMap.commitment()}static createMerkleMap(t){const e=[...t.keys()].sort(),r=e.map((e=>{const r=t.get(e);if(!r)throw new Error("No value for key "+e);return r})),n=e.map((t=>o.from(t,"hex")));return new(0,i.MerkleMap)(n,r)}constructor(t){super(),this.inputMerkleMaps=[],this.outputMerkleMaps=[],t.copy(this),this.globalMerkleMap=u.createMerkleMap(this.globalMap);for(let t=0;t<this.getGlobalInputCount();t++)this.inputMerkleMaps.push(u.createMerkleMap(this.inputMaps[t]));this.inputMapCommitments=[...this.inputMerkleMaps.values()].map((t=>t.commitment()));for(let t=0;t<this.getGlobalOutputCount();t++)this.outputMerkleMaps.push(u.createMerkleMap(this.outputMaps[t]));this.outputMapCommitments=[...this.outputMerkleMaps.values()].map((t=>t.commitment()))}}})),r.register("4z4rn",(function(e,n){t(e.exports,"MerkleMap",(function(){return u}));var i=r("c2oKp"),s=r("eIDCs"),o=r("6rT8n").Buffer;class u{commitment(){return o.concat([(0,i.createVarint)(this.keys.length),this.keysTree.getRoot(),this.valuesTree.getRoot()])}constructor(t,e){if(t.length!=e.length)throw new Error("keys and values should have the same length");for(let e=0;e<t.length-1;e++)if(t[e].toString("hex")>=t[e+1].toString("hex"))throw new Error("keys must be in strictly increasing order");this.keys=t,this.keysTree=new(0,s.Merkle)(t.map((t=>(0,s.hashLeaf)(t)))),this.values=e,this.valuesTree=new(0,s.Merkle)(e.map((t=>(0,s.hashLeaf)(t))))}}})),r.register("9RELh",(function(e,n){t(e.exports,"ClientCommandInterpreter",(function(){return w}));var i,s,o=r("7yhlT"),u=r("gpQhj"),a=r("c2oKp"),h=r("eIDCs"),p=r("6rT8n").Buffer;(s=i||(i={}))[s.YIELD=16]="YIELD",s[s.GET_PREIMAGE=64]="GET_PREIMAGE",s[s.GET_MERKLE_LEAF_PROOF=65]="GET_MERKLE_LEAF_PROOF",s[s.GET_MERKLE_LEAF_INDEX=66]="GET_MERKLE_LEAF_INDEX",s[s.GET_MORE_ELEMENTS=160]="GET_MORE_ELEMENTS";class c{}class l extends c{execute(t){return this.results.push(p.from(t.subarray(1))),this.progressCallback(),p.from("")}constructor(t,e){super(),this.progressCallback=e,this.code=i.YIELD,this.results=t}}class f extends c{execute(t){const e=p.from(t.subarray(1));if(33!=e.length)throw new Error("Invalid request, unexpected trailing data");if(0!=e[0])throw new Error("Unsupported request, the first byte should be 0");const r=p.alloc(32);for(let t=0;t<32;t++)r[t]=e[1+t];const n=r.toString("hex"),i=this.known_preimages.get(n);if(null!=i){const t=(0,a.createVarint)(i.length),e=255-t.length-1,r=Math.min(e,i.length);if(r<i.length)for(let t=r;t<i.length;t++)this.queue.push(p.from([i[t]]));return p.concat([t,p.from([r]),p.from(i.subarray(0,r))])}throw Error(`Requested unknown preimage for: ${n}`)}constructor(t,e){super(),this.code=i.GET_PREIMAGE,this.known_preimages=t,this.queue=e}}class d extends c{execute(t){const e=p.from(t.subarray(1));if(e.length<34)throw new Error("Invalid request, expected at least 34 bytes");const r=new(0,u.BufferReader)(e),n=r.readSlice(32).toString("hex");let i,s;try{i=r.readVarInt(),s=r.readVarInt()}catch(t){throw new Error("Invalid request, couldn't parse tree_size or leaf_index")}const o=this.known_trees.get(n);if(!o)throw Error(`Requested Merkle leaf proof for unknown tree: ${n}`);if(s>=i||o.size()!=i)throw Error("Invalid index or tree size.");if(0!=this.queue.length)throw Error("This command should not execute when the queue is not empty.");const a=o.getProof(s),h=Math.min(Math.floor(6.90625),a.length),c=a.length-h;return c>0&&this.queue.push(...a.slice(-c)),p.concat([o.getLeafHash(s),p.from([a.length]),p.from([h]),...a.slice(0,h)])}constructor(t,e){super(),this.code=i.GET_MERKLE_LEAF_PROOF,this.known_trees=t,this.queue=e}}class g extends c{execute(t){const e=p.from(t.subarray(1));if(64!=e.length)throw new Error("Invalid request, unexpected trailing data");const r=p.alloc(32);for(let t=0;t<32;t++)r[t]=e.readUInt8(t);const n=r.toString("hex"),i=p.alloc(32);for(let t=0;t<32;t++)i[t]=e.readUInt8(32+t);const s=i.toString("hex"),o=this.known_trees.get(n);if(!o)throw Error(`Requested Merkle leaf index for unknown root: ${n}`);let u=0,h=0;for(let t=0;t<o.size();t++)if(o.getLeafHash(t).toString("hex")==s){h=1,u=t;break}return p.concat([p.from([h]),(0,a.createVarint)(u)])}constructor(t){super(),this.code=i.GET_MERKLE_LEAF_INDEX,this.known_trees=t}}class m extends c{execute(t){if(1!=t.length)throw new Error("Invalid request, unexpected trailing data");if(0===this.queue.length)throw new Error("No elements to get");const e=this.queue[0].length;if(this.queue.some((t=>t.length!=e)))throw new Error("The queue contains elements with different byte length, which is not expected");const r=Math.floor(253/e),n=Math.min(r,this.queue.length),i=this.queue.splice(0,n);return p.concat([p.from([n]),p.from([e]),...i])}constructor(t){super(),this.code=i.GET_MORE_ELEMENTS,this.queue=t}}class w{getYielded(){return this.yielded}addKnownPreimage(t){this.preimages.set(o.crypto.sha256(t).toString("hex"),t)}addKnownList(t){for(const e of t){const t=p.concat([p.from([0]),e]);this.addKnownPreimage(t)}const e=new(0,h.Merkle)(t.map((t=>(0,h.hashLeaf)(t))));this.roots.set(e.getRoot().toString("hex"),e)}addKnownMapping(t){this.addKnownList(t.keys),this.addKnownList(t.values)}execute(t){if(0==t.length)throw new Error("Unexpected empty command");const e=t[0],r=this.commands.get(e);if(!r)throw new Error(`Unexpected command code ${e}`);return r.execute(t)}constructor(t){this.roots=new Map,this.preimages=new Map,this.yielded=[],this.queue=[],this.commands=new Map;const e=[new l(this.yielded,t),new f(this.preimages,this.queue),new g(this.roots),new d(this.roots,this.queue),new m(this.queue)];for(const t of e){if(this.commands.has(t.code))throw new Error(`Multiple commands with code ${t.code}`);this.commands.set(t.code,t)}}}})),r.register("hpTqp",(function(e,n){t(e.exports,"splitTransaction",(function(){return a}));var i=r("krsE8"),s=r("c2oKp"),o=r("aFWbh"),u=r("6rT8n").Buffer;function a(t,e=!1,r=!1,n=!1,a=[]){const h=[],p=[];let c,l,f=!1,d=0,g=u.alloc(0),m=u.alloc(0),w=u.alloc(0),y=u.alloc(0);const v=a.includes("decred"),_=a.includes("zencash"),E=a.includes("zcash"),S=u.from(t,"hex"),b=S.slice(d,d+4),I=b.equals(u.from([3,0,0,128]))||b.equals(u.from([4,0,0,128]))||b.equals(u.from([5,0,0,128])),T=E&&b.equals(u.from([5,0,0,128]));d+=4,r||!e||0!==S[d]||0===S[d+1]||_||(d+=2,f=!0),r&&(g=S.slice(d,4+d),d+=4),I&&(w=S.slice(d,4+d),d+=4),T&&(l=S.slice(d+4,d+8),m=S.slice(d+8,d+12),d+=12);let P=(0,s.getVarint)(S,d);const O=P[0];d+=P[1];for(let t=0;t<O;t++){const t=S.slice(d,d+36);d+=36;let e=u.alloc(0),r=u.alloc(0);v?(r=S.slice(d,d+1),d+=1):(P=(0,s.getVarint)(S,d),d+=P[1],e=S.slice(d,d+P[0]),d+=P[0]);const n=S.slice(d,d+4);d+=4,h.push({prevout:t,script:e,sequence:n,tree:r})}P=(0,s.getVarint)(S,d);const M=P[0];d+=P[1];for(let t=0;t<M;t++){const t=S.slice(d,d+8);d+=8,v&&(d+=2),P=(0,s.getVarint)(S,d),d+=P[1];const e=S.slice(d,d+P[0]);d+=P[0],p.push({amount:t,script:e})}if(f?(c=S.slice(d,-4),l=S.slice(S.length-4)):T||(l=S.slice(d,d+4)),d+=4,!I&&!v||T||(m=S.slice(d,d+4),d+=4),n&&(y=S.slice(d)),v){if(P=(0,s.getVarint)(S,d),d+=P[1],P[0]!==O)throw new Error("splitTransaction: incoherent number of witnesses");for(let t=0;t<O;t++){d+=8,d+=4,d+=4,P=(0,s.getVarint)(S,d),d+=P[1];const e=S.slice(d,d+P[0]);d+=P[0],h[t].script=e}}const x={version:b,inputs:h,outputs:p,locktime:l,witness:c,timestamp:g,nVersionGroupId:w,nExpiryHeight:m,extraData:y};return(0,i.log)("btc",`splitTransaction ${t}:\n${(0,o.formatTransactionDebug)(x)}`),x}})),r.register("aFWbh",(function(e,r){function n(t){let e="TX";return e+=" version "+t.version.toString("hex"),t.locktime&&(e+=" locktime "+t.locktime.toString("hex")),t.witness&&(e+=" witness "+t.witness.toString("hex")),t.timestamp&&(e+=" timestamp "+t.timestamp.toString("hex")),t.nVersionGroupId&&(e+=" nVersionGroupId "+t.nVersionGroupId.toString("hex")),t.nExpiryHeight&&(e+=" nExpiryHeight "+t.nExpiryHeight.toString("hex")),t.extraData&&(e+=" extraData "+t.extraData.toString("hex")),t.inputs.forEach((({prevout:t,script:r,sequence:n},i)=>{e+=`\ninput ${i}:`,e+=` prevout ${t.toString("hex")}`,e+=` script ${r.toString("hex")}`,e+=` sequence ${n.toString("hex")}`})),(t.outputs||[]).forEach((({amount:t,script:r},n)=>{e+=`\noutput ${n}:`,e+=` amount ${t.toString("hex")}`,e+=` script ${r.toString("hex")}`})),e}t(e.exports,"formatTransactionDebug",(function(){return n}))})),r.register("6cQM5",(function(e,n){t(e.exports,"signP2SHTransaction",(function(){return f}),(function(t){return f=t}));var i=r("4EYNL"),s=r("1qqBa"),o=r("7c6Jb"),u=r("dbidG"),a=r("dFxAf"),h=r("1hle7"),p=r("6rT8n").Buffer,c=function(t,e,r,n){return new(r||(r=Promise))((function(i,s){function o(t){try{a(n.next(t))}catch(t){s(t)}}function u(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,u)}a((n=n.apply(t,e||[])).next())}))};const l={lockTime:h.DEFAULT_LOCKTIME,sigHashType:h.SIGHASH_ALL,segwit:!1,transactionVersion:h.DEFAULT_VERSION};function f(t,e){return c(this,void 0,void 0,(function*(){const{inputs:r,associatedKeysets:n,outputScriptHex:c,lockTime:f,sigHashType:d,segwit:g,transactionVersion:m}=Object.assign(Object.assign({},l),e),w=p.alloc(0),y=p.alloc(0),v=p.alloc(4);v.writeUInt32LE(m,0);const _=[],E=[],S=[];let b=!0;const I={inputs:[],version:v},T=g?o.getTrustedInputBIP143:i.getTrustedInput,P=p.from(c,"hex");for(const e of r){{const r=yield T(t,e[1],e[0]),n=p.alloc(4);n.writeUInt32LE(e.length>=4&&"number"==typeof e[3]?e[3]:h.DEFAULT_SEQUENCE,0),_.push({trustedInput:!1,value:g?p.from(r,"hex"):p.from(r,"hex").slice(4,40),sequence:n})}const{outputs:r}=e[0],n=e[1];r&&n<=r.length-1&&E.push(r[n])}for(let t=0;t<r.length;t++){const e=p.alloc(4);e.writeUInt32LE(r[t].length>=4&&"number"==typeof r[t][3]?r[t][3]:h.DEFAULT_SEQUENCE,0),I.inputs.push({script:w,prevout:y,sequence:e})}g&&(yield(0,s.startUntrustedHashTransactionInput)(t,!0,I,_,!0),yield(0,a.hashOutputFull)(t,P));for(let e=0;e<r.length;e++){const i=r[e],o=r[e].length>=3&&"string"==typeof i[2]?p.from(i[2],"hex"):E[e].script,h=Object.assign({},I),c=g?[_[e]]:_;g?h.inputs=[Object.assign(Object.assign({},h.inputs[e]),{script:o})]:h.inputs[e].script=o,yield(0,s.startUntrustedHashTransactionInput)(t,!g&&b,h,c,g),g||(yield(0,a.hashOutputFull)(t,P));const l=yield(0,u.signTransaction)(t,n[e],f,d);S.push(g?l.toString("hex"):l.slice(0,l.length-1).toString("hex")),I.inputs[e].script=w,b&&(b=!1)}return S}))}}));
//# sourceMappingURL=Btc.f3633855.js.map
define=__define;})(window.define);